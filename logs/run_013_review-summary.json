{
  "timestamp" : "2025-11-03T13:01:54.2506065",
  "index" : 13,
  "file" : "review-summary",
  "prompt" : {
    "role" : "user",
    "content" : "===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\grid\\SettingParameterGrid.java =====\n```\npackage com.hom.ebmw.view.admin.setting.grid;\r\n\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.jpa.model.SettingParameter;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.vaadin.flow.component.grid.dnd.GridDropLocation;\r\nimport com.vaadin.flow.component.grid.dnd.GridDropMode;\r\nimport com.vaadin.flow.component.gridpro.GridPro;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\nimport lombok.Getter;\r\nimport lombok.Setter;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class SettingParameterGrid<E> extends GridPro<SettingParameter<E>> {\r\n\r\n    private @Getter\r\n    @Setter List<SettingParameter<E>> settingParams = new ArrayList<SettingParameter<E>>();\r\n\r\n    private SettingParameter<E> draggedItem = null;\r\n    private @Getter List<SettingParameter<E>> selectedParameters = null;\r\n\r\n    private final @Getter Context ctx;\r\n    private final @Getter Setting setting;\r\n\r\n    /**\r\n     * The SettingParameterGrid function is a constructor that creates the grid for the SettingParameter objects.\r\n     * It also adds drag and drop functionality to allow users to reorder their parameters.\r\n     *\r\n     * @param Context ctx Get the settingparameterservice from the context\r\n     * @param Setting setting Set the setting for which the parameters are being displayed\r\n     * @return A <E> grid\r\n     */\r\n    public SettingParameterGrid(Context ctx, Setting setting) {\r\n        this.ctx = ctx;\r\n        this.setting = setting;\r\n\r\n        List<SettingParameter<E>> params = ctx.getServices().getSettingParameterService().findAllBySettingOrderByDisplayOrder(setting);\r\n\r\n        if (Objects.nonNull(params) && !params.isEmpty()) {\r\n            settingParams.addAll(params);\r\n            setDataProvider(DataProvider.ofCollection(settingParams));\r\n        }\r\n\r\n        setRowsDraggable(true);\r\n\r\n        addDragStartListener(event -> {\r\n            draggedItem = event.getDraggedItems().get(0);\r\n            this.setDropMode(GridDropMode.BETWEEN);\r\n        });\r\n\r\n        addDragEndListener(event -> {\r\n            draggedItem = null;\r\n            this.setDropMode(null);\r\n        });\r\n\r\n        addDropListener(event -> {\r\n            SettingParameter<E> dropOverItem = event.getDropTargetItem().get();\r\n            if (!dropOverItem.equals(draggedItem)) {\r\n                settingParams.remove(draggedItem);\r\n                int dropIndex = settingParams.indexOf(dropOverItem)\r\n                        + (event.getDropLocation() == GridDropLocation.BELOW ? 1 : 0);\r\n                draggedItem.setDisplayOrder(dropIndex);\r\n                settingParams.add(dropIndex, draggedItem);\r\n                reorder();\r\n                saveAll();\r\n                this.setDataProvider(DataProvider.ofCollection(settingParams));\r\n            }\r\n        });\r\n\r\n        addSelectionListener(event -> {\r\n            selectedParameters = new ArrayList<SettingParameter<E>>();\r\n            event.getAllSelectedItems().forEach(item -> {\r\n                if (!item.getParam().isEmpty())\r\n                    selectedParameters.add(item);\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The getParamByValue function takes in a value of type E and returns the SettingParameter object that has that value.\r\n     *\r\n     * @param E value Get the settingparameter object that has a value equal to e value\r\n     * @return The setting parameter with the given value\r\n     */\r\n    public SettingParameter<E> getParamByValue(E value) {\r\n        SettingParameter<E> result = null;\r\n        for (SettingParameter<E> settingParameter : settingParams) {\r\n            if (settingParameter.getValue().equals(value)) {\r\n                result = settingParameter;\r\n                break;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The reorder function is used to reorder the rows of the table.\r\n     * It removes any null or - 1 values from the list, and then sets all display orders to their index in the list.\r\n     */\r\n    private void reorder() {\r\n        getSettingParams().removeIf(item -> Objects.isNull(item.getDisplayOrder()) || item.getDisplayOrder() == -1);\r\n        for (int i = 0; i < getSettingParams().size(); i++) {\r\n            SettingParameter<E> item = getSettingParams().get(i);\r\n            if (item.getDisplayOrder() == -1)\r\n                item.setDisplayOrder(i);\r\n            else {\r\n                item.setDisplayOrder(getSettingParams().indexOf(item));\r\n            }\r\n        }\r\n        setEmptyRow();\r\n    }\r\n\r\n    /**\r\n     * The save function saves the SettingParameter object to the database.\r\n     *\r\n     * @param SettingParameter&lt;E&gt; object Save the object to the database\r\n     */\r\n    public void save(SettingParameter<E> object) {\r\n        if (!object.getParam().isEmpty()) {\r\n            getCtx().getServices().getSettingParameterService().save(object);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The saveAll function saves all the setting parameters in the list of setting parameters.\r\n     * It removes any parameter that has a display order of - 1, which is used to indicate that it should be deleted.\r\n     */\r\n    public void saveAll() {\r\n        getSettingParams().removeIf(item -> item.getDisplayOrder() == -1);\r\n        getCtx().getServices().getSettingParameterService().saveAll(getSettingParams());\r\n        setEmptyRow();\r\n    }\r\n\r\n    /**\r\n     * The setEmptyRow function sets the row to be empty.\r\n     */\r\n    public void setEmptyRow() {\r\n    }\r\n\r\n    /**\r\n     * The onSave function is called when the user clicks on the &quot;Save&quot; button.\r\n     * It saves all of the data in a file, and then closes it.\r\n     */\r\n    public void onSave() {\r\n    }\r\n\r\n    /**\r\n     * The reload function is called when the user clicks on the &quot;Reload&quot; button.\r\n     * It refreshes the data in this grid by calling getSettingParams() and then\r\n     * setting that as a DataProvider for this grid. This function also calls setEmptyRow(), which adds an empty row to the bottom of this grid, allowing users to add new SettingParameters.\r\n     */\r\n    public void reload() {\r\n        setSettingParams(ctx.getServices().getSettingParameterService().findAllBySettingOrderByDisplayOrder(getSetting()));\r\n        settingParams.sort((o1, o2) -> o1.getParam().compareTo(o2.getParam()));\r\n        setEmptyRow();\r\n        this.setDataProvider(DataProvider.ofCollection(getSettingParams()));\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\grid\\SettingParameterGrid.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\grid\\Structure_SPGrid.java =====\n```\npackage com.hom.ebmw.view.admin.setting.grid;\r\n\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.jpa.model.SettingParameter;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.Structure;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.view.components.ImageButton;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Objects;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class Structure_SPGrid extends SettingParameterGrid<Structure> {\r\n    /**\r\n     * The Structure_SPGrid function is a constructor for the Structure_SPGrid class.\r\n     * It takes in two parameters: a Context object and a Setting object.\r\n     * The function calls the superclass's constructor, which initializes the context and setting fields of this class to be equal to ctx and setting respectively.\r\n     * Then, it adds an anonymous ComponentColumn component that contains an HorizontalLayout component with width set to 100%.  This layout has its margins removed by calling CompUtils' removeMSP method on it with &quot;MP&quot; as parameter (which removes all margins).  The layout contains three components: TextField name, ImageButton\r\n     *\r\n     * @param Context ctx Get the current context of the application\r\n     * @param Setting setting Set the setting type\r\n     * @return A structure\r\n     */\r\n    public Structure_SPGrid(Context ctx, Setting setting) {\r\n        super(ctx, setting);\r\n\r\n        addComponentColumn(item -> {\r\n            HorizontalLayout result = new HorizontalLayout();\r\n            result.setWidthFull();\r\n            CompUtils.removeMSP(result, \"MP\");\r\n\r\n            Structure object = item.getValue();\r\n\r\n            TextField name = new TextField();\r\n            name.setValue(item.getValue().getName());\r\n            name.addValueChangeListener(event -> {\r\n            });\r\n            name.setWidth(\"60%\");\r\n\r\n            if (item.getParam().isEmpty()) {\r\n                name.setPlaceholder(getTranslation(TMS.SETTING_PLACEHOLDER_TYPE, getLocale(), getCtx()));\r\n            }\r\n\r\n            ImageButton imgBtn = new ImageButton(CompUtils.getSaveFloppy(getCtx()), CompUtils.getDisableSaveFloppy(getCtx()));\r\n            imgBtn.addClickListener(event -> {\r\n                object.setName(name.getValue());\r\n                item.setValue(object);\r\n                item.setParam(object.getName());\r\n                if (item.getDisplayOrder() == -1) item.setDisplayOrder(getSettingParams().size());\r\n                save(item);\r\n                reload();\r\n            });\r\n            result.add(name, imgBtn);\r\n            return result;\r\n        }).setWidth(\"10%\");\r\n    }\r\n\r\n    /**\r\n     * The setEmptyRow function is used to add an empty row to the table.\r\n     * This allows for a user to add a new structure without having to reload the page.\r\n     */\r\n    @Override\r\n    public void setEmptyRow() {\r\n        SettingParameter<Structure> params = new SettingParameter<Structure>();\r\n        Structure structure = new Structure();\r\n        structure.setName(\"\");\r\n        params.setValue(structure);\r\n        params.setParam(structure.getName());\r\n        params.setSetting(getSetting());\r\n        params.setDisplayOrder(-1);\r\n        if (Objects.isNull(getSettingParams()) || getSettingParams().isEmpty()) {\r\n            setSettingParams(new ArrayList<SettingParameter<Structure>>());\r\n            getSettingParams().add(0, params);\r\n        } else if (!getSettingParams().get(0).getValue().getName().isEmpty()) {\r\n            getSettingParams().add(0, params);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The onSave function saves all the data in the program.\r\n     * It does this by calling saveAll() from the DataManager class.\r\n     */\r\n    @Override\r\n    public void onSave() {\r\n        saveAll();\r\n    }\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\grid\\Structure_SPGrid.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\grid\\Zinfo_SPGrid.java =====\n```\npackage com.hom.ebmw.view.admin.setting.grid;\r\n\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.jpa.model.SettingParameter;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.ZinfoTypeDetail;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.view.components.ImageButton;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Objects;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class Zinfo_SPGrid extends SettingParameterGrid<ZinfoTypeDetail> {\r\n    /**\r\n     * The Zinfo_SPGrid function is a constructor for the Zinfo_SPGrid class.\r\n     * It creates a grid that displays all of the zinfo types in the database, and allows users to edit them.\r\n     *\r\n     * @param Context ctx Get the current context of the application\r\n     * @param Setting setting Get the list of zinfotypedetail objects\r\n     * @return A grid with a column for each component\r\n     */\r\n    public Zinfo_SPGrid(Context ctx, Setting setting) {\r\n        super(ctx, setting);\r\n\r\n        addComponentColumn(item -> {\r\n            HorizontalLayout result = new HorizontalLayout();\r\n            result.setWidthFull();\r\n            CompUtils.removeMSP(result, \"MP\");\r\n            ZinfoTypeDetail object = item.getValue();\r\n\r\n            TextField type = new TextField();\r\n            type.setValue(object.getType());\r\n            type.setWidth(\"30%\");\r\n\r\n            TextField desc = new TextField();\r\n            desc.setValue(object.getDescription());\r\n            desc.setWidth(\"60%\");\r\n\r\n            if (item.getParam().isEmpty()) {\r\n                desc.setPlaceholder(getTranslation(TMS.SETTING_PLACEHOLDER_TYPE, getLocale(), getCtx()));\r\n                type.setPlaceholder(getTranslation(TMS.SETTING_PLACEHOLDER_TYPE, getLocale(), getCtx()));\r\n            }\r\n\r\n            ImageButton imgBtn = new ImageButton(CompUtils.getSaveFloppy(getCtx()), CompUtils.getDisableSaveFloppy(getCtx()));\r\n            imgBtn.addClickListener(event -> {\r\n                object.setDescription(desc.getValue());\r\n                object.setType(type.getValue());\r\n                item.setValue(object);\r\n                item.setParam(object.getType());\r\n                if (item.getDisplayOrder() == -1)\r\n                    item.setDisplayOrder(getSettingParams().size());\r\n                save(item);\r\n                reload();\r\n            });\r\n            imgBtn.setWidth(\"2em\");\r\n            result.add(type, desc, imgBtn);\r\n            return result;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The setEmptyRow function is used to add an empty row to the table.\r\n     * This allows the user to add a new entry without having to delete an existing one.\r\n     */\r\n    @Override\r\n    public void setEmptyRow() {\r\n        SettingParameter<ZinfoTypeDetail> params = new SettingParameter<ZinfoTypeDetail>();\r\n        ZinfoTypeDetail detail = new ZinfoTypeDetail();\r\n        detail.setType(\"\");\r\n        detail.setDescription(\"\");\r\n        params.setValue(detail);\r\n        params.setParam(detail.getType());\r\n        params.setSetting(getSetting());\r\n        params.setDisplayOrder(-1);\r\n        if (Objects.isNull(getSettingParams()) || getSettingParams().isEmpty()) {\r\n            setSettingParams(new ArrayList<SettingParameter<ZinfoTypeDetail>>());\r\n            getSettingParams().add(0, params);\r\n        } else if (!getSettingParams().get(0).getValue().getType().isEmpty()) {\r\n            getSettingParams().add(0, params);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The onSave function saves all the data in the program.\r\n     * It does this by calling saveAll() from the DataManager class.\r\n     */\r\n    @Override\r\n    public void onSave() {\r\n        saveAll();\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\grid\\Zinfo_SPGrid.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\GridConstruction.java =====\n```\npackage com.hom.ebmw.view.admin.setting;\r\n\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.interfaces.Command;\r\nimport com.hom.ebmw.view.admin.setting.grid.SettingParameterGrid;\r\nimport com.hom.ebmw.view.admin.setting.grid.service.LayoutService;\r\nimport com.hom.ebmw.view.components.DownloadButton;\r\nimport com.hom.ebmw.view.components.interfaces.FileInputLoader;\r\nimport com.hom.ebmw.view.dialogs.FileImportDialog;\r\nimport com.vaadin.flow.component.Composite;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.component.upload.Upload;\r\nimport com.vaadin.flow.component.upload.receivers.MultiFileMemoryBuffer;\r\n\r\nimport java.io.File;\r\nimport java.util.concurrent.Callable;\r\nimport java.util.function.Supplier;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class GridConstruction<E> extends Composite<VerticalLayout> {\r\n\r\n    private final Button saveAllBtn;\r\n    private final Button delBtn;\r\n    private final Button closeBtn;\r\n    private final Button cancelBtn;\r\n    private final Upload uploader;\r\n    private final DownloadButton downloadBtn;\r\n    private final MultiFileMemoryBuffer memoryFileBuffer;\r\n\r\n    /**\r\n     * The GridConstruction function is a constructor for the GridConstruction class.\r\n     * It takes in two parameters: a Context object and a SettingParameterGrid object.\r\n     * The function creates buttons, an uploader, and memoryFileBuffer objects that are used by the grid.\r\n     *\r\n     * @param Context                       ctx Get the current locale and to get a translation for the button labels\r\n     * @param SettingParameterGrid&lt;E&gt; grid Pass the grid to the gridconstruction class\r\n     * @return The following:\r\n     */\r\n    public GridConstruction(Context ctx, SettingParameterGrid<E> grid) {\r\n        saveAllBtn = new Button(getTranslation(TMS.GLB_BUTTON_SAVE_ALL, getLocale(), ctx));\r\n        delBtn = new Button(getTranslation(TMS.GLB_BUTTON_DELETE, getLocale(), ctx));\r\n        closeBtn = new Button(getTranslation(TMS.GLB_BUTTON_SAVE_CLOSE, getLocale(), ctx));\r\n        cancelBtn = new Button(getTranslation(TMS.GLB_BUTTON_CANCEL, getLocale(), ctx));\r\n        downloadBtn = new DownloadButton(ctx, \"\");\r\n\r\n        memoryFileBuffer = new MultiFileMemoryBuffer();\r\n        uploader = new Upload(memoryFileBuffer);\r\n\r\n        if (grid instanceof FileInputLoader) {\r\n            uploader.setVisible(true);\r\n            uploader.addSucceededListener(event -> {\r\n                FileImportDialog dialog = new FileImportDialog(ctx, event, memoryFileBuffer,\r\n                        (FileInputLoader) grid);\r\n                dialog.open();\r\n                dialog.execute();\r\n            });\r\n        } else {\r\n            uploader.setVisible(false);\r\n        }\r\n        if (grid instanceof LayoutService) {\r\n            LayoutService service = (LayoutService) grid;\r\n            HorizontalLayout layout = new HorizontalLayout();\r\n            service.extendContent(layout);\r\n            getContent().add(layout);\r\n        }\r\n\r\n        HorizontalLayout gridButtons = new HorizontalLayout();\r\n        gridButtons.add(saveAllBtn, delBtn, uploader);\r\n        CompUtils.removeMSP(gridButtons, \"MP\");\r\n        HorizontalLayout buttons = new HorizontalLayout();\r\n        buttons.add(closeBtn, cancelBtn);\r\n        CompUtils.removeMSP(buttons, \"MP\");\r\n\r\n        getContent().add(gridButtons, grid, buttons);\r\n        grid.setSizeFull();\r\n        getContent().setSizeFull();\r\n    }\r\n\r\n    /**\r\n     * The setSaveAllClickEvent function sets the click event for the save all button.\r\n     *\r\n     * @param Command com Set the command that will be executed when the saveallbtn is clicked\r\n     */\r\n    public void setSaveAllClickEvent(Command com) {\r\n        saveAllBtn.addClickListener(event -> com.execute());\r\n    }\r\n\r\n    /**\r\n     * The setDeleteClickEvent function sets the delete button's click event to a command.\r\n     *\r\n     * @param Command com Execute the command\r\n     */\r\n    public void setDeleteClickEvent(Command com) {\r\n        delBtn.addClickListener(event -> com.execute());\r\n    }\r\n\r\n    /**\r\n     * The setCloseClickEvent function sets the close button's click event to a command.\r\n     *\r\n     * @param Command com Execute the command that is passed in\r\n     */\r\n    public void setCloseClickEvent(Command com) {\r\n        closeBtn.addClickListener(event -> com.execute());\r\n    }\r\n\r\n    /**\r\n     * The setCancelClickEvent function sets the click event for the cancel button.\r\n     *\r\n     * @param Command com Execute the command when the cancel button is clicked\r\n     */\r\n    public void setCancelClickEvent(Command com) {\r\n        cancelBtn.addClickListener(event -> com.execute());\r\n    }\r\n\r\n    /**\r\n     * The setDownloadButton function is used to set the download button's functionality.\r\n     * It takes two parameters: a Supplier&lt;String&gt; fileNameCallback and a Callable&lt;File&gt; file.\r\n     * The first parameter, fileNameCallback, is used to determine what the name of the downloaded\r\n     * File will be when it is saved on your computer. The second parameter, file, determines what\r\n     * data will be in that File when you save it on your computer. This function can only be called once per instance of this class; if you call it more than once then an IllegalStateException will occur because there can only ever be\r\n     *\r\n     * @param Supplier&lt;String&gt; fileNameCallback Get the file name of the file that is being downloaded\r\n     * @param Callable&lt;File&gt;   file Download the file\r\n     */\r\n    public void setDownloadButton(Supplier<String> fileNameCallback, Callable<File> file) {\r\n        downloadBtn.reloadAsFile(fileNameCallback, file);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\GridConstruction.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\PathSelectDialog.java =====\n```\npackage com.hom.ebmw.view.admin.setting;\r\n\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.dialog.Dialog;\r\nimport com.vaadin.flow.component.icon.Icon;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.component.treegrid.TreeGrid;\r\nimport lombok.Data;\r\nimport lombok.extern.slf4j.Slf4j;\r\n\r\nimport java.io.File;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\nimport java.util.regex.Matcher;\r\nimport java.util.regex.Pattern;\r\n\r\n@Slf4j\r\n@SuppressWarnings(\"serial\")\r\npublic class PathSelectDialog\r\n        extends\r\n        Dialog {\r\n\r\n    private final TreeGrid<FolderContainer> treeGrid = new TreeGrid<FolderContainer>();\r\n\r\n    /**\r\n     * The PathSelectDialog function is a constructor for the PathSelectDialog class.\r\n     * It creates a dialog box that allows the user to select a path from their computer's file system.\r\n     * The selected path will be saved as an absolute path in the setting object passed into this function,\r\n     * and then displayed in the text field passed into this function.\r\n     *\r\n     * @param UI        ui Access the ui from a non-ui thread\r\n     * @param Context   ctx Get the current locale and to access the services\r\n     * @param Setting   setting Set the value of the setting\r\n     * @param TextField field Set the value of the field in the pathselectdialog function\r\n     * @return A path\r\n     */\r\n    public PathSelectDialog(\r\n            UI ui,\r\n            Context ctx,\r\n            Setting setting,\r\n            TextField field) {\r\n\r\n        /*\r\n         * : _ prompt path + --+ --+ --+ --+ save & close by Button save or cancel\r\n         */\r\n\r\n        TextField path = new TextField(getTranslation(TMS.SETTING_ROOT_DIRECTORY, getLocale(), ctx));\r\n        path.setValue(\"/\");\r\n\r\n\r\n        reloadTree(path.getValue());\r\n\r\n        treeGrid.addComponentColumn(item -> item.getIcon());\r\n        treeGrid.addColumn(FolderContainer::getName);\r\n\r\n        path.addValueChangeListener(event -> {\r\n            String source = event.getValue();\r\n            String pattern = \"^[A-Za-z]\";\r\n\r\n            Pattern pat = Pattern.compile(pattern);\r\n            Matcher mat = pat.matcher(source);\r\n            if (mat.find()) {\r\n                source = mat.group() + \":/\";\r\n            } else {\r\n                source = \"/\";\r\n            }\r\n\r\n            reloadTree(source);\r\n        });\r\n\r\n        VerticalLayout body = new VerticalLayout();\r\n\r\n        CompUtils.removeMSP(body, \"MSP\");\r\n        body.setSizeFull();\r\n\r\n        Button save = new Button();\r\n        save.setText(getTranslation(TMS.GLB_BUTTON_SAVE, getLocale(), ctx));\r\n        save.addClickListener(event -> {\r\n            List<File> selected = new ArrayList<File>();\r\n            setting.setValue(selected.get(0).getAbsolutePath());\r\n            ui.access(() -> {\r\n                field.setValue(setting.getValue());\r\n            });\r\n            ctx.getServices().getSettingServices().save(setting);\r\n            close();\r\n        });\r\n\r\n        Button cancel = new Button();\r\n        cancel.setText(getTranslation(TMS.GLB_BUTTON_CANCEL, getLocale(), ctx));\r\n        cancel.addClickListener(event -> {\r\n            close();\r\n        });\r\n\r\n        HorizontalLayout buttons = new HorizontalLayout();\r\n        CompUtils.removeMSP(buttons, \"MSP\");\r\n        buttons.add(save, cancel);\r\n\r\n        body.add(path, treeGrid, buttons);\r\n\r\n        setCloseOnEsc(false);\r\n        setCloseOnOutsideClick(false);\r\n\r\n        add(body);\r\n    }\r\n\r\n    /**\r\n     * The reloadTree function is used to reload the treeGrid with a new root path.\r\n     *\r\n     * @param String path Set the root path of the tree\r\n     */\r\n    private void reloadTree(String path) {\r\n        File rootPath = new File(path);\r\n        FolderContainer root = new FolderContainer(rootPath);\r\n        treeGrid.setItems(root.getChilds(), FolderContainer::getChilds);\r\n    }\r\n\r\n    private @Data class FolderContainer {\r\n        private String name;\r\n        private String path;\r\n        private Icon icon;\r\n        private File file;\r\n\r\n        /**\r\n         * The FolderContainer function is a constructor for the FolderContainer class.\r\n         * It creates an empty folder container object, which can be used to store and\r\n         * manipulate folders.\r\n         *\r\n         * @return A new foldercontainer object\r\n         */\r\n        public FolderContainer() {\r\n        }\r\n\r\n        /**\r\n         * The FolderContainer function is a constructor for the FolderContainer class.\r\n         * It takes in a File object and sets the name, path, icon, and file of the\r\n         * FolderContainer to be that of the inputted File object.\r\n         *\r\n         * @param File init Create a new file object\r\n         * @return A foldercontainer object\r\n         */\r\n        public FolderContainer(File init) {\r\n            setName(init.getName());\r\n            setPath(init.getAbsolutePath());\r\n            setIcon(VaadinIcon.FOLDER.create());\r\n            setFile(init);\r\n        }\r\n\r\n        /**\r\n         * The getChilds function returns a list of FolderContainer objects that are the childs of the current FolderContainer object.\r\n         *\r\n         * @return A list of foldercontainer objects\r\n         */\r\n        public List<FolderContainer> getChilds() {\r\n            List<FolderContainer> childs = new ArrayList<FolderContainer>();\r\n            for (File folder : file.listFiles()) {\r\n                FolderContainer child = setChild(folder);\r\n                if (Objects.nonNull(child)) {\r\n                    childs.add(child);\r\n                }\r\n            }\r\n            return childs;\r\n        }\r\n\r\n        /**\r\n         * The setChild function is a recursive function that takes in a File object and returns\r\n         * either null or an instance of the FolderContainer class. If the file passed into setChild\r\n         * is not a directory, then it will return null. Otherwise, it will create an instance of\r\n         * FolderContainer and populate its fields with information from the current file. It then\r\n         * calls itself on each child of this folder (if any) to populate its children field with instances\r\n         * of FolderContainer for each subfolder within this folder (if any). This process continues until all folders have been traversed.\r\n         *\r\n         * @param File current Get the name of the file and its path\r\n         * @return A foldercontainer object\r\n         */\r\n        private FolderContainer setChild(File current) {\r\n            FolderContainer result = null;\r\n            try {\r\n                log.debug(\"File \" + current.getAbsolutePath());\r\n                if (current.isDirectory()) {\r\n                    result = new FolderContainer();\r\n                    result.setName(current.getName());\r\n                    result.setPath(current.getAbsolutePath());\r\n                    result.setIcon(VaadinIcon.FOLDER.create());\r\n                    result.setFile(current);\r\n                }\r\n            } catch (Exception e) {\r\n            }\r\n            return result;\r\n        }\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\PathSelectDialog.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\SelectRoleDialog.java =====\n```\npackage com.hom.ebmw.view.admin.setting;\r\n\r\nimport com.hom.ebmw.configuration.security.Services;\r\nimport com.hom.ebmw.jpa.model.Role;\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.utilities.Parse;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.dialog.Dialog;\r\nimport com.vaadin.flow.component.listbox.MultiSelectListBox;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\nimport com.vaadin.flow.data.renderer.TextRenderer;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.HashSet;\r\nimport java.util.List;\r\nimport java.util.Set;\r\n\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class SelectRoleDialog\r\n        extends\r\n        Dialog {\r\n\r\n    private final Setting setting;\r\n    private final Services sessions;\r\n    private final TextField field;\r\n    private final UI ui;\r\n\r\n    /**\r\n     * The SelectRoleDialog function creates a dialog box that allows the user to select one or more roles.\r\n     *\r\n     * @param UI        ui Get the current ui\r\n     * @param Services  sessions Get the list of roles from the database\r\n     * @param Setting   setting Get the current setting of the application\r\n     * @param TextField field Set the value of the text field in the parent window\r\n     * @return A multiselect object\r\n     */\r\n    public SelectRoleDialog(UI ui, Services sessions, Setting setting, TextField field) {\r\n        this.sessions = sessions;\r\n        this.setting = setting;\r\n        this.field = field;\r\n        this.ui = ui;\r\n        add(createMultiBox());\r\n        setCloseOnOutsideClick(true);\r\n        setCloseOnEsc(true);\r\n    }\r\n\r\n    /**\r\n     * The createMultiBox function creates a MultiSelectListBox object, which is a Vaadin component that allows the user to select multiple items from a list.\r\n     * The function first creates an empty MultiSelectListBox object called valid. It then gets all of the roles in the database and stores them in an ArrayList called roles.\r\n     * Next, it sets up the data provider for valid by using DataProvider.ofCollection(roles). This means that when we call setDataProvider on our MultiSelectListBox later on,\r\n     * it will use this data provider to get its values from (in this case, all of our roles).\r\n     *\r\n     * @return A multiselectlistbox object\r\n     */\r\n    private MultiSelectListBox<Role> createMultiBox() {\r\n        MultiSelectListBox<Role> valid = new MultiSelectListBox<Role>();\r\n        List<Role> roles = sessions.getRoleService().findAll();\r\n\r\n        valid.setDataProvider(DataProvider.ofCollection(roles));\r\n        valid.setRenderer(new TextRenderer<Role>(item -> item.getName()));\r\n\r\n        Set<Role> active = new HashSet<Role>();\r\n        setting.getAllRoles().forEach(roleId -> roles.stream()\r\n                .filter(role -> role.getId() == Parse.toLong(roleId))\r\n                .findFirst()\r\n                .ifPresent(role -> active.add(role)));\r\n\r\n        valid.setValue(active);\r\n        valid.addSelectionListener(event -> {\r\n            Set<Role> values = event.getAllSelectedItems();\r\n            List<String> roleIds = new ArrayList<String>();\r\n            values.forEach(value -> roleIds.add(String.valueOf(value.getId())));\r\n            setting.setRoles(roleIds);\r\n            sessions.getSettingServices().save(setting);\r\n            ui.access(() -> {\r\n                List<Role> activeRoles = new ArrayList<Role>();\r\n                activeRoles.addAll(event.getAllSelectedItems());\r\n                String name = getRoleNames(activeRoles);\r\n                field.setValue(name);\r\n            });\r\n        });\r\n        valid.setSizeFull();\r\n        return valid;\r\n    }\r\n\r\n    /**\r\n     * The getRoleNames function takes a list of Role objects and returns a string containing the names of all the roles in that list.\r\n     * The function sorts the roles by their id, then iterates through them, adding each role's name to an empty string.\r\n     * If there is more than one role in the list, it adds &quot;, &quot; between each name.\r\n     *\r\n     * @param List&lt;Role&gt; roles Sort the roles by id\r\n     * @return A string of the role names separated by commas\r\n     */\r\n    private String getRoleNames(List<Role> roles) {\r\n        String result = \"\";\r\n        roles.sort((o1, o2) -> {\r\n            Integer id_1 = o1.getId();\r\n            Integer id_2 = o2.getId();\r\n\r\n            return id_1.compareTo(id_2);\r\n        });\r\n        for (Role role : roles) {\r\n            result += (!result.isEmpty() ? \", \" : \"\") + role.getName();\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\SelectRoleDialog.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\SettingGrid.java =====\n```\npackage com.hom.ebmw.view.admin.setting;\r\n\r\nimport com.hom.ebmw.ipim.model.Language;\r\nimport com.hom.ebmw.jpa.dao.SettingParameterDAO;\r\nimport com.hom.ebmw.jpa.model.Filter;\r\nimport com.hom.ebmw.jpa.model.Filterbase;\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.jpa.model.SettingParameter;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.*;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.SettingDataType;\r\nimport com.hom.ebmw.utilities.enums.SettingType;\r\nimport com.hom.ebmw.view.admin.setting.grid.*;\r\nimport com.hom.ebmw.view.components.ImageButton;\r\nimport com.vaadin.flow.component.Component;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.checkbox.Checkbox;\r\nimport com.vaadin.flow.component.combobox.ComboBox;\r\nimport com.vaadin.flow.component.confirmdialog.ConfirmDialog;\r\nimport com.vaadin.flow.component.datepicker.DatePicker;\r\nimport com.vaadin.flow.component.grid.FooterRow;\r\nimport com.vaadin.flow.component.gridpro.GridPro;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.notification.Notification;\r\nimport com.vaadin.flow.component.notification.Notification.Position;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.textfield.TextArea;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.component.upload.Upload;\r\nimport com.vaadin.flow.component.upload.receivers.MemoryBuffer;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\nimport com.vaadin.flow.data.provider.ListDataProvider;\r\nimport lombok.extern.slf4j.Slf4j;\r\nimport org.apache.commons.io.IOUtils;\r\n\r\nimport java.io.File;\r\nimport java.io.IOException;\r\nimport java.time.LocalDate;\r\nimport java.util.*;\r\n\r\n@Slf4j\r\n@SuppressWarnings(\"serial\")\r\npublic class SettingGrid extends GridPro<Setting> {\r\n\r\n    private final Column<Setting> first;\r\n    private final Column<Setting> second;\r\n    private final Column<Setting> third;\r\n    private final Context ctx;\r\n    private final SettingView view;\r\n\r\n    /**\r\n     * The SettingGrid function is used to create a grid that will be displayed on the SettingView.\r\n     * The grid contains three columns: Identifier, Type and Value.\r\n     *\r\n     * @param context ctx Get the current locale and to translate the text in the grid\r\n     * @param setting view Call the refreshgrid method in settingview\r\n     * @return An object of type settinggrid\r\n     */\r\n    public SettingGrid(Context ctx, SettingView view) {\r\n        this.view = view;\r\n        this.ctx = ctx;\r\n        first = addComponentColumn(this::createIdentifer).setHeader(getTranslation(TMS.SETTING_GRID_IDENTIFIER, getLocale(), ctx)).setFlexGrow(2);\r\n        second = addComponentColumn(this::createDataTyp).setHeader(getTranslation(TMS.SETTING_GRID_TYPE, getLocale(), ctx)).setFlexGrow(1);\r\n        third = addComponentColumn(this::getCompType).setHeader(getTranslation(TMS.SETTING_GRID_VALUE, getLocale(), ctx)).setFlexGrow(4);\r\n\r\n        FooterRow footerRow = this.appendFooterRow();\r\n        footerRow.getCell(first).setComponent(setSaveRows());\r\n        footerRow.getCell(second).setComponent(setNewRow());\r\n        footerRow.getCell(third).setComponent(setDeleteRow());\r\n    }\r\n\r\n    /**\r\n     * The createIdentifer function creates a ComboBox that allows the user to select from a list of SettingType values.\r\n     * The function takes in one parameter, setting, which is used to set the value of the ComboBox.\r\n     *\r\n     * @param final Setting setting Set the value of the setting\r\n     * @return A combobox with the values of settingtype\r\n     */\r\n    private ComboBox<SettingType> createIdentifer(final Setting setting) {\r\n        ComboBox<SettingType> identiferBox = new ComboBox<SettingType>();\r\n        identiferBox.setItems(SettingType.values());\r\n        identiferBox.setClearButtonVisible(true);\r\n        identiferBox.addValueChangeListener(event -> {\r\n            setting.setIdentifier(event.getValue().create());\r\n        });\r\n        identiferBox.setSizeFull();\r\n        if (!setting.getIdentifier().equals(\"identifier\")) {\r\n            SettingType type = SettingType.valueOf(setting.getIdentifier());\r\n            identiferBox.setValue(type);\r\n        } else {\r\n            identiferBox.setPlaceholder(setting.getIdentifier());\r\n        }\r\n        return identiferBox;\r\n    }\r\n\r\n    /**\r\n     * The getCompType function is used to determine which type of component should be displayed for a given setting.\r\n     *\r\n     * @param final Setting setting Set the value of a setting\r\n     * @return A component\r\n     */\r\n    private Component getCompType(final Setting setting) {\r\n        Component returnValue = null;\r\n\r\n        SettingDataType type = null;\r\n        try {\r\n            type = SettingDataType.valueOf(setting.getDatatype());\r\n        } catch (Exception e) {\r\n        }\r\n\r\n        if (Objects.isNull(type))\r\n            type = SettingDataType.TEXT;\r\n\r\n        switch (type) {\r\n            case DATE:\r\n                DatePicker picker = new DatePicker(setting.getValue().equals(\"Value\") ? LocalDate.now()\r\n                        : LocalDate.parse(setting.getValue()));\r\n                picker.addValueChangeListener(event -> {\r\n                    setting.setValue(event.getValue().toString());\r\n                });\r\n                returnValue = picker;\r\n                break;\r\n            case PATH:\r\n                TextField path = new TextField();\r\n                path.setSizeFull();\r\n                path.addFocusListener(event -> {\r\n                    view.setRightVisible(true);\r\n                    view.getRightSection().getChildren().findFirst().ifPresent(Comp -> {\r\n                        view.getRightSection().removeAll();\r\n                    });\r\n                    final MemoryBuffer fileBuffer = new MemoryBuffer();\r\n                    Upload uploader = new Upload(fileBuffer);\r\n\r\n                    Button saveNclose = new Button();\r\n                    saveNclose.setText(getTranslation(TMS.GLB_BUTTON_ACCEPT, getLocale(), ctx));\r\n                    saveNclose.addClickListener(eventBtn -> {\r\n                        try {\r\n                            String directory = SettingUtils.getSettingsFolder(ctx);\r\n                            File resultFile = new File(directory + File.separator + fileBuffer.getFileName());\r\n                            Blob.loadFromFile(IOUtils.toByteArray(fileBuffer.getInputStream()), resultFile);\r\n                            path.setValue(resultFile.getAbsolutePath().replace(\"\\\\\", \"/\"));\r\n                            setting.setValue(resultFile.getAbsolutePath().replace(\"\\\\\", \"/\"));\r\n                        } catch (IOException e) {\r\n                            log.error(e.getLocalizedMessage(), e);\r\n                        }\r\n                        view.getRightSection().removeAll();\r\n                        view.setRightVisible(false);\r\n                    });\r\n\r\n                    Button cancel = new Button();\r\n                    cancel.setText(getTranslation(TMS.GLB_BUTTON_CANCEL, getLocale(), ctx));\r\n                    cancel.addClickListener(eventBtn -> {\r\n                        view.getRightSection().removeAll();\r\n                        view.setRightVisible(false);\r\n                    });\r\n                    HorizontalLayout buttons = new HorizontalLayout();\r\n                    buttons.add(saveNclose, cancel);\r\n\r\n                    CompUtils.removeMSP(buttons, \"MP\");\r\n                    view.getRightSection().add(uploader, buttons);\r\n\r\n                });\r\n                path.setValue(setting.getValue());\r\n                returnValue = path;\r\n                break;\r\n            default:\r\n            case TEXT:\r\n                TextField text = new TextField();\r\n                text.setSizeFull();\r\n                text.addValueChangeListener(event -> setting.setValue(event.getValue()));\r\n                text.setValue(setting.getValue());\r\n                returnValue = text;\r\n                break;\r\n            case STRUCTURE_TREE:\r\n                HorizontalLayout box = new HorizontalLayout();\r\n                CompUtils.removeMSP(box, \"MP\");\r\n                ComboBox<Filterbase> structureBox = new ComboBox<>();\r\n                List<Filterbase> root = ctx.getServices().getIPIMService().getAllRootStructure();\r\n                structureBox.setSizeFull();\r\n                structureBox.setItems(root);\r\n                structureBox.setItemLabelGenerator(item -> \"(\" + item.getIdentifier() + \") \" + item.getLabel());\r\n                Optional<Filterbase> optValue = root.stream()\r\n                        .filter(item -> item.getIdentifier().equals(setting.getValue()))\r\n                        .findFirst();\r\n                optValue.ifPresent(item -> {\r\n                    structureBox.setValue(item);\r\n                });\r\n                structureBox.addValueChangeListener(event -> {\r\n                    setting.setValue(event.getValue().getIdentifier());\r\n                });\r\n                Button refreshBtn = new Button(VaadinIcon.REFRESH.create());\r\n                ConfirmDialog dialog = new ConfirmDialog(getTranslation(TMS.SETTING_STRUCTURE_CONFIRM_DIALOG_TITLE, getLocale(), ctx), getTranslation(TMS.SETTING_STRUCTURE_CONFIRM_DIALOG_TEXT, getLocale(), ctx), getTranslation(TMS.SETTING_STRUCTURE_CONFIRM_DIALOG_CONFIRM_TEXT, getLocale(), ctx), confirm -> {\r\n                    InitialUtils.setStructureName(ctx.getServices(), setting);\r\n                    Notification.show(getTranslation(TMS.STRUCTURE_RELOAD_SUCCESSFUL, getLocale(), ctx), 5000, Position.MIDDLE);\r\n                });\r\n                dialog.setCancelable(true);\r\n                dialog.setCancelText(getTranslation(TMS.GLB_BUTTON_CANCEL, getLocale(), ctx));\r\n                refreshBtn.addClickListener(event -> dialog.open());\r\n                box.add(structureBox, refreshBtn);\r\n                returnValue = box;\r\n                break;\r\n            case AREA:\r\n                TextArea area = new TextArea();\r\n                area.setSizeFull();\r\n                area.addValueChangeListener(event -> setting.setValue(event.getValue()));\r\n                area.setValue(setting.getValue());\r\n                returnValue = area;\r\n                break;\r\n            case BOOLEAN:\r\n                Checkbox check = new Checkbox();\r\n                check.addValueChangeListener(event -> setting.setValue(event.getValue() ? \"true\" : \"false\"));\r\n                check.setValue(Parse.toBoolean(setting.getValue()));\r\n                returnValue = check;\r\n                break;\r\n            case PROFIL:\r\n                final ComboBox<Filter> filterBox = new ComboBox<Filter>();\r\n                List<Filter> filters = ctx.getServices().getFilterService().findAll();\r\n                filterBox.setClearButtonVisible(true);\r\n                filters.removeIf(item -> Objects.nonNull(item.getDeleteBy()));\r\n                filters.removeIf(item -> Objects.nonNull(item.getPrivate()));\r\n                filters.removeIf(item -> item.getGlobal() == 1 && !item.getTeam().getName().equals(\"admin\"));\r\n\r\n                filterBox.setItems(filters);\r\n                filterBox.setItemLabelGenerator(Filter::getNameWithPrefix);\r\n                for (Filter item : filters) {\r\n                    if (setting.getValue().equals(String.valueOf(item.getId()))) {\r\n                        filterBox.setValue(item);\r\n                    }\r\n                }\r\n                filterBox.addValueChangeListener(event -> {\r\n                    if (Objects.nonNull(filterBox.getValue())) {\r\n                        setting.setValue(String.valueOf(filterBox.getValue().getId()));\r\n                    }\r\n                });\r\n                returnValue = filterBox;\r\n                break;\r\n\r\n            case LANGUAGE:\r\n                ComboBox<Language> langBox = new ComboBox<Language>();\r\n                List<Language> langs = new ArrayList<Language>();\r\n                langs.addAll(ctx.getServices().getEnumerationService().getAllLanguages());\r\n                langBox.setItems(langs);\r\n                langBox.setItemLabelGenerator(Language::getLabel);\r\n\r\n                if (Objects.nonNull(setting.getValue()) && !setting.getValue().isEmpty()) {\r\n                    Optional<Language> optLang = langs.stream().filter(item -> item.getLabel().equals(setting.getValue())).findFirst();\r\n                    optLang.ifPresent(langBox::setValue);\r\n                }\r\n\r\n                langBox.addValueChangeListener(event -> {\r\n                    if (Objects.nonNull(langBox.getValue())) {\r\n                        setting.setValue(langBox.getValue().getLabel());\r\n                    }\r\n                });\r\n                returnValue = langBox;\r\n                break;\r\n\r\n            case KATALOGVERSION:\r\n                returnValue = compGrid(setting, new KatalogVersionSPGrid(ctx, setting));\r\n                break;\r\n\r\n            case S3_CATALOG:\r\n                returnValue = compGrid(setting, new S3Catalog_SPGrid(ctx, setting));\r\n                break;\r\n\r\n            case STRUCTURE:\r\n                returnValue = compGrid(setting, new Structure_SPGrid(ctx, setting));\r\n                break;\r\n\r\n            case ZINFO:\r\n                returnValue = compGrid(setting, new Zinfo_SPGrid(ctx, setting));\r\n                break;\r\n\r\n            case PARTNERSHORT:\r\n                returnValue = compGrid(setting, new PartnerShort_SPGrid(ctx, setting));\r\n                break;\r\n\r\n            case CUSTOMER_LANGUAGE:\r\n                returnValue = compGrid(setting, new CustomerLanguage_SPGrid(ctx, setting));\r\n                break;\r\n\r\n            case CUSTOMER_PREFIX:\r\n                returnValue = compGrid(setting, new CustomerPrefix_SPGrid(ctx, setting));\r\n                break;\r\n\r\n            case HOLD_ON:\r\n                returnValue = compGrid(setting, new Delay_SPGrid(ctx, setting));\r\n                break;\r\n        }\r\n\r\n        return returnValue;\r\n    }\r\n\r\n    /**\r\n     * The createDataTyp function creates a ComboBox that allows the user to select\r\n     * the data type of a setting. The function takes in one parameter, which is an\r\n     * instance of Setting. It returns an instance of ComboBox&lt;SettingDataType&gt;.\r\n     *\r\n     * @param final Setting setting Set the value of the setting object\r\n     * @return A combobox&lt;settingdatatype&gt;\r\n     */\r\n    private ComboBox<SettingDataType> createDataTyp(final Setting setting) {\r\n        ComboBox<SettingDataType> dataTypeBox = new ComboBox<SettingDataType>();\r\n        dataTypeBox.setClearButtonVisible(true);\r\n        dataTypeBox.setItems(SettingDataType.values());\r\n        dataTypeBox.addValueChangeListener(event -> {\r\n            setting.setDatatype(event.getValue().name());\r\n            if (Objects.nonNull(event.getValue()) && Objects.nonNull(event.getOldValue())\r\n                    && !event.getOldValue().equals(event.getValue())) {\r\n                this.getDataProvider().refreshAll();\r\n            }\r\n        });\r\n        if (Objects.isNull(setting.getDatatype())) {\r\n            setting.setDatatype(SettingDataType.TEXT.name());\r\n        }\r\n        dataTypeBox.setValue(SettingDataType.valueOf(setting.getDatatype()));\r\n        dataTypeBox.setSizeFull();\r\n        return dataTypeBox;\r\n    }\r\n\r\n\r\n    /**\r\n     * The setSaveRows function creates a new ImageButton object, which is an extension of the Vaadin Button class.\r\n     * The ImageButton constructor takes two parameters: a normal image and a disabled image.\r\n     * The setSaveRows function then adds an event listener to the button that saves all settings in the grid when clicked.\r\n     *\r\n     * @return An imagebutton\r\n     */\r\n    private ImageButton setSaveRows() {\r\n        ImageButton saveBtn = new ImageButton(CompUtils.getSaveFloppy(ctx), CompUtils.getDisableSaveFloppy(ctx));\r\n        saveBtn.addClickListener(event -> {\r\n            Collection<Setting> all = getAllItems();\r\n            ctx.getServices().getSettingServices().saveAll(all);\r\n            reload();\r\n        });\r\n        return saveBtn;\r\n    }\r\n\r\n    /**\r\n     * The setNewRow function creates a new row in the grid.\r\n     *\r\n     * @return A button which is added to the grid\r\n     */\r\n    private Button setNewRow() {\r\n        Button createNewBtn = new Button(VaadinIcon.PLUS.create());\r\n        createNewBtn.addClickListener(event -> {\r\n            Setting newRow = new Setting();\r\n            newRow.setIdentifier(\"identifier\");\r\n            newRow.setValue(\"Value\");\r\n            newRow.setRoles(\"\");\r\n\r\n            addToList(newRow);\r\n            this.select(newRow);\r\n        });\r\n        return createNewBtn;\r\n    }\r\n\r\n    /**\r\n     * The setDeleteRow function creates a button that will delete the selected rows from the grid.\r\n     *\r\n     * @return A button that is supposed to delete the selected items\r\n     */\r\n    private Button setDeleteRow() {\r\n        Button deleteBtn = new Button(VaadinIcon.CLOSE_BIG.create());\r\n        deleteBtn.addClickListener(event -> {\r\n            List<Setting> items = new ArrayList<Setting>();\r\n            items.addAll(this.getSelectedItems());\r\n            if (!items.isEmpty()) {\r\n                items.forEach(this::removeFromList);\r\n            }\r\n        });\r\n        return deleteBtn;\r\n    }\r\n\r\n    /**\r\n     * The addToList function adds a new Setting to the list of Settings.\r\n     *\r\n     * @param Setting addSetting Add a new setting to the list\r\n     */\r\n    private void addToList(Setting addSetting) {\r\n        List<Setting> items = new ArrayList<Setting>();\r\n        items.addAll(getAllItems());\r\n        items.add(addSetting);\r\n        this.setDataProvider(DataProvider.ofCollection(items));\r\n    }\r\n\r\n    /**\r\n     * The removeFromList function removes a Setting from the list of Settings.\r\n     *\r\n     * @param Setting setting Remove the setting from the database\r\n     */\r\n    private void removeFromList(Setting setting) {\r\n        @SuppressWarnings(\"unchecked\")\r\n        ListDataProvider<Setting> dataProvider = (ListDataProvider<Setting>) this.getDataProvider();\r\n        ctx.getServices().getSettingCustomServices().remove(setting);\r\n\r\n        dataProvider.getItems().remove(setting);\r\n        dataProvider.refreshAll();\r\n    }\r\n\r\n    /**\r\n     * The getAllItems function returns a Collection of all the items in the grid.\r\n     * This is used to determine if there are any items in the grid, and if so,\r\n     * whether or not they have been changed. If there are no items in the grid, then\r\n     * we can assume that nothing has been changed since it was last saved. If there\r\n     * are one or more items present, then we need to check each item individually for\r\n     * changes before saving them all at once (or discarding them). The getAllItems function\r\n     * uses ListDataProvider's getItems() method to return a Collection of all\r\n     *\r\n     * @return A collection of setting objects\r\n     */\r\n    private Collection<Setting> getAllItems() {\r\n        @SuppressWarnings(\"unchecked\")\r\n        ListDataProvider<Setting> dataProvider = (ListDataProvider<Setting>) this.getDataProvider();\r\n        return dataProvider.getItems();\r\n    }\r\n\r\n    /**\r\n     * The reload function is used to refresh the grid with new data.\r\n     * It does this by getting all of the settings from the database and then setting them as a data provider for the grid.\r\n     */\r\n    public void reload() {\r\n        List<Setting> allSettings = ctx.getServices().getSettingServices().findAll();\r\n        setDataProvider(DataProvider.ofCollection(allSettings));\r\n    }\r\n\r\n    /**\r\n     * The compGrid function is used to create a grid for the setting parameter.\r\n     *\r\n     * @param setting                         setting Get the value of the setting and set it to the text field\r\n     * @param setting-parameter-grid&lt;E&gt; grid Create a grid with the setting-parameter&lt;string&gt; data type\r\n     * @return A textfield\r\n     */\r\n    public <E> TextField compGrid(Setting setting, SettingParameterGrid<E> grid) {\r\n        TextField textField = new TextField();\r\n        textField.setSizeFull();\r\n        textField.addFocusListener(event -> {\r\n\r\n            view.getRightSection().getChildren().findFirst().ifPresent(item -> {\r\n                view.getRightSection().removeAll();\r\n            });\r\n\r\n\r\n            GridConstruction<E> construction = new GridConstruction<E>(ctx, grid);\r\n\r\n            SettingParameterDAO sParamService = ctx.getServices().getSettingParameterService();\r\n\r\n            List<SettingParameter<E>> settingParameters = sParamService.findAllBySettingOrderByDisplayOrder(setting);\r\n            if (Objects.nonNull(settingParameters) && !settingParameters.isEmpty())\r\n                grid.setSettingParams(settingParameters);\r\n\r\n            grid.setEmptyRow();\r\n\r\n            grid.reload();\r\n\r\n            construction.setSaveAllClickEvent(() -> {\r\n                grid.saveAll();\r\n            });\r\n\r\n            construction.setDeleteClickEvent(() -> {\r\n                sParamService.deleteAll(grid.getSelectedItems());\r\n                grid.reload();\r\n            });\r\n\r\n            construction.setCloseClickEvent(() -> {\r\n                grid.onSave();\r\n                view.getRightSection().removeAll();\r\n                view.setRightVisible(false);\r\n                this.getDataProvider().refreshAll();\r\n            });\r\n\r\n            construction.setCancelClickEvent(() -> {\r\n                view.getRightSection().removeAll();\r\n                view.setRightVisible(false);\r\n            });\r\n\r\n            view.getRightSection().add(construction);\r\n            view.setRightVisible(true);\r\n        });\r\n        textField.setValue(setting.getValue());\r\n        return textField;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\SettingGrid.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\SettingView.java =====\n```\npackage com.hom.ebmw.view.admin.setting;\r\n\r\n\r\nimport com.hom.ebmw.configuration.security.Services;\r\nimport com.hom.ebmw.configuration.security.SessionUtils;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.UserSession;\r\nimport com.hom.ebmw.utilities.enums.CTXAttribute;\r\nimport com.hom.ebmw.utilities.enums.SectionVisible;\r\nimport com.hom.ebmw.view.BaseLayout;\r\nimport com.hom.ebmw.view.MainView;\r\nimport com.vaadin.flow.router.PageTitle;\r\nimport com.vaadin.flow.router.Route;\r\n\r\nimport static com.hom.ebmw.utilities.interfaces.PageConst.PAGE_SETTING;\r\nimport static com.hom.ebmw.utilities.interfaces.PageConst.TITLE_SETTING;\r\n\r\n@SuppressWarnings(\"serial\")\r\n@Route(value = PAGE_SETTING, layout = MainView.class)\r\n@PageTitle(TITLE_SETTING)\r\npublic class SettingView extends BaseLayout {\r\n\r\n    private final Context ctx = new Context();\r\n\r\n\r\n    /**\r\n     * The SettingView function is a constructor for the SettingView class.\r\n     * It creates a new instance of the SettingView class, and initializes it with\r\n     * an instance of Services as its parameter. The function then sets up the context\r\n     * by creating instances of SessionUtils, UserSession, and HttpSession using methods from Services.\r\n     * Then it creates an instance of SettingGrid called sGrid which is initialized with ctx and this (the current object).\r\n     * Finally, it adds sGrid to getMiddleSection(), sets leftVisible to false (hides left section), rightVisible to false (\r\n     *\r\n     * @param Services services Get the user services and session\r\n     * @return A settingview object\r\n     */\r\n    public SettingView(Services services) {\r\n        ctx.put(CTXAttribute.SESSION, new SessionUtils(services.getUserServices()));\r\n        ctx.put(CTXAttribute.SERVICES, services);\r\n        ctx.put(CTXAttribute.USER_SESSION, new UserSession());\r\n        ctx.put(CTXAttribute.HTTP_SESSION, ctx.getSession().getHttpSession());\r\n\r\n        SettingGrid sGrid = new SettingGrid(ctx, this);\r\n        sGrid.reload();\r\n        sGrid.setSizeFull();\r\n        getMiddleSection().add(sGrid);\r\n\r\n        setLeftVisible(false);\r\n        setRightVisible(false);\r\n        getRightSection().setWidth(\"70%\");\r\n        getRightSection().setMaxWidth(\"70%\");\r\n    }\r\n\r\n    /**\r\n     * The switchVisibility function is used to change the width of the middle section depending on whether or not\r\n     * either of the left and right sections are visible. If both are visible, then it will be 30%. If only one is\r\n     * visible, then it will be 50%. And if neither are visible, then it will take up 100% of the screen. This function\r\n     * also calls a helper function called valueOf which returns an enum that represents what combination of sections\r\n     * are currently being displayed. The switch statement uses this enum to determine how wide to make each section.\r\n     */\r\n    @Override\r\n    public void switchVisibility() {\r\n        boolean left = getLeftSection().isVisible();\r\n        boolean right = getRightSection().isVisible();\r\n\r\n        SectionVisible visible = SectionVisible.valueOf(left, right);\r\n\r\n        switch (visible) {\r\n            case LEFT_MIDDLE_RIGHT:\r\n            case MIDDLE_RIGHT:\r\n            case LEFT_MIDDLE:\r\n                getMiddleSection().setWidth(\"30%\");\r\n                break;\r\n            case MIDDLE:\r\n                getMiddleSection().setWidth(\"100%\");\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\setting\\SettingView.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\statistic\\components\\ChartVariant.java =====\n```\npackage com.hom.ebmw.view.admin.statistic.components;\r\n\r\nimport com.vaadin.flow.component.charts.Chart;\r\nimport com.vaadin.flow.component.charts.model.*;\r\n\r\nimport java.util.Map;\r\n\r\nimport static com.vaadin.flow.component.charts.model.ChartType.COLUMN;\r\nimport static com.vaadin.flow.component.charts.model.ChartType.PIE;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class ChartVariant extends Chart {\r\n\r\n    private final Configuration conf;\r\n\r\n    /**\r\n     * The ChartVariant function is a constructor for the ChartVariant class.\r\n     * It takes in a ChartType as an argument and sets the chart type to that value.\r\n     * The legend is disabled, and if the chart type is PIE or COLUMN, then it sets\r\n     * additional properties of those charts. Finally, it sets the height of all charts to 320px.\r\n     *\r\n     * @param ChartType type Set the type of chart to be displayed\r\n     * @return A chartvariant object\r\n     */\r\n    public ChartVariant(ChartType type) {\r\n        conf = getConfiguration();\r\n        conf.getChart().setType(type);\r\n        conf.getLegend().setEnabled(false);\r\n\r\n        if (type.equals(PIE)) {\r\n            PlotOptionsPie plot = new PlotOptionsPie();\r\n            plot.setSize(\"45%\");\r\n            conf.setPlotOptions(plot);\r\n        }\r\n\r\n        if (type.equals(COLUMN)) {\r\n            PlotOptionsColumn plot = new PlotOptionsColumn();\r\n            plot.setStacking(Stacking.NONE);\r\n            conf.setPlotOptions(plot);\r\n        }\r\n\r\n        setHeight(\"320px\");\r\n    }\r\n\r\n    /**\r\n     * The reload function takes a map of data and uses it to update the chart.\r\n     *\r\n     * @param Map&lt;String Pass in the data to be displayed on the chart\r\n     * @param Number&gt;    data Pass in the data to be displayed on the chart\r\n     */\r\n    public void reload(Map<String, Number> data) {\r\n        final DataSeries dataSeries = new DataSeries();\r\n\r\n        XAxis xAxis = new XAxis();\r\n        xAxis.setCrosshair(new Crosshair());\r\n        xAxis.setCategories(data.keySet().toArray(new String[data.keySet().size()]));\r\n        conf.addxAxis(xAxis);\r\n\r\n        data.forEach((k, v) -> {\r\n            DataSeriesItem item = new DataSeriesItem(k, v);\r\n            item.setName(k);\r\n            item.setY(v);\r\n\r\n            dataSeries.add(item);\r\n        });\r\n\r\n        conf.setSeries(dataSeries);\r\n\r\n        Tooltip tooltip = new Tooltip();\r\n        tooltip.setShared(true);\r\n        conf.setTooltip(tooltip);\r\n\r\n        drawChart();\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\statistic\\components\\ChartVariant.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\statistic\\components\\SQLTemplate.java =====\n```\npackage com.hom.ebmw.view.admin.statistic.components;\r\n\r\nimport com.hom.ebmw.jpa.model.ArticleBase;\r\nimport com.hom.ebmw.jpa.model.ArticleStatistic;\r\nimport com.hom.ebmw.jpa.model.TemplateData;\r\nimport com.hom.ebmw.jpa.model.User;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.*;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.view.components.DownloadButton;\r\nimport com.hom.ebmw.view.components.interfaces.FileInputLoader;\r\nimport com.hom.ebmw.view.dialogs.FileImportDialog;\r\nimport com.vaadin.flow.component.Text;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.charts.model.ChartType;\r\nimport com.vaadin.flow.component.combobox.ComboBox;\r\nimport com.vaadin.flow.component.dialog.Dialog;\r\nimport com.vaadin.flow.component.grid.Grid;\r\nimport com.vaadin.flow.component.html.Image;\r\nimport com.vaadin.flow.component.html.Label;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.orderedlayout.FlexComponent.Alignment;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.Scroller;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.component.textfield.TextArea;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.component.upload.Upload;\r\nimport com.vaadin.flow.component.upload.receivers.MultiFileMemoryBuffer;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\nimport com.vaadin.flow.data.value.ValueChangeMode;\r\nimport lombok.extern.slf4j.Slf4j;\r\n\r\nimport java.sql.Date;\r\nimport java.sql.SQLException;\r\nimport java.sql.Timestamp;\r\nimport java.util.*;\r\n\r\n@Slf4j\r\npublic class SQLTemplate extends Scroller implements FileInputLoader {\r\n\r\n    private static final long serialVersionUID = -233031847059089061L;\r\n    private TemplateData templateData;\r\n    private final VerticalLayout container = new VerticalLayout();\r\n\r\n    private final Grid<Map<String, Object>> customGrid;\r\n    private final Button sqlBtn = new Button(VaadinIcon.CODE.create());\r\n    private final Button tableBtn = new Button(VaadinIcon.TABLE.create());\r\n    private final DownloadButton downloadBtn;\r\n    private final Button refreshBtn = new Button(VaadinIcon.REFRESH.create());\r\n    private final Button saveBtn = new Button(VaadinIcon.FILE.create());\r\n    private final Button chartBtn = new Button(VaadinIcon.CHART.create());\r\n    private final Button uploadBtn = new Button(VaadinIcon.UPLOAD.create());\r\n    private TextField templateId = null;\r\n    private final VerticalLayout body = new VerticalLayout();\r\n    private String head = \"\";\r\n    private Number numb = 0;\r\n    private List<Map<String, Object>> table = new ArrayList<>();\r\n    private final Context ctx;\r\n    private Thread thread;\r\n    private final UI ui = UI.getCurrent();\r\n\r\n    /**\r\n     * The SQLTemplate function is a constructor for the SQLTemplate class.\r\n     * It takes in two parameters, a Context object and a TemplateData object.\r\n     * The function sets the context of this template to be equal to the context passed into it,\r\n     * and sets its template data to be equal to that which was passed into it as well.\r\n     * It then creates an empty grid called customGrid, an empty download button called downloadBtn,\r\n     * and calls setTemplateId(), setSqlBtn(), setTableBtn(), setRefreshBtn(), setSaveBtn() ,setChartButton() ,and\r\n     *\r\n     * @param Context      ctx Get the services and repositories\r\n     * @param TemplateData templateData Set the templatedata field\r\n     * @return A sqltemplate object\r\n     */\r\n    public SQLTemplate(Context ctx, TemplateData templateData) {\r\n        this.ctx = ctx;\r\n        this.templateData = templateData;\r\n\r\n        container.setId(\"vertical-container\");\r\n        customGrid = new Grid<>();\r\n        downloadBtn = new DownloadButton(ctx, TMS.DOWNLOAD_PREPARE_EXPORT);\r\n\r\n        setTemplateId();\r\n        setSqlBtn();\r\n        setTableBtn();\r\n        setRefreshBtn();\r\n        setSaveBtn();\r\n        setChartBtn();\r\n        setUploader();\r\n\r\n        TextField title = new TextField();\r\n        title.setValue(templateData.getTitle());\r\n\r\n        HorizontalLayout buttonBay = new HorizontalLayout();\r\n        buttonBay.setAlignItems(Alignment.CENTER);\r\n        CompUtils.removeMSP(buttonBay, \"MSP\");\r\n\r\n        HorizontalLayout headerBay = new HorizontalLayout();\r\n        headerBay.setAlignItems(Alignment.CENTER);\r\n        CompUtils.removeMSP(headerBay, \"MSP\");\r\n\r\n        buttonBay.add(sqlBtn, tableBtn, chartBtn, downloadBtn, refreshBtn, saveBtn, uploadBtn);\r\n        headerBay.add(templateId, title);\r\n\r\n        body.add(customGrid);\r\n        CompUtils.removeMSP(body, \"MSP\");\r\n\r\n        customGrid.setWidth(\"100%\");\r\n        customGrid.setHeight(\"309px\");\r\n\r\n        container.add(headerBay, buttonBay, body);\r\n\r\n        if (Objects.nonNull(templateData.getSqlQuery()) && !templateData.getSqlQuery().isEmpty()) {\r\n            try {\r\n                if (table.isEmpty()) {\r\n                    reloadThis();\r\n                }\r\n            } catch (Exception e) {\r\n                log.error(e.getLocalizedMessage(), e);\r\n            }\r\n        }\r\n        title.addValueChangeListener(event -> {\r\n            templateData.setTitle(event.getValue());\r\n            ctx.getServices().getTemplateDataRepository().save(templateData);\r\n        });\r\n\r\n        setWidth(\"400px\");\r\n        setHeight(\"430px\");\r\n\r\n        CompUtils.removeMSP(container, \"MS\");\r\n\r\n        setContent(container);\r\n\r\n        getStyle().set(\"border-style\", \"solid\");\r\n        getStyle().set(\"border-width\", \"3px\");\r\n    }\r\n\r\n    /**\r\n     * The configAnchor function is used to configure the download button.\r\n     * The function reloads the download button as a file, and then writes an excel file as a map.\r\n     *\r\n     * @param Context ctx Get the application context\r\n     */\r\n    private void configAnchor(Context ctx) {\r\n        downloadBtn.reloadAsFile(() -> templateData.getTitle().replace(\" \", \"_\") + \".xlsx\", () -> ExcelUtils\r\n                .writeExcelFileAsMap(ctx, table, SettingUtils.createTempFile(ctx, \"\"), templateData.getTitle()));\r\n    }\r\n\r\n    /**\r\n     * The setTemplateId function sets the templateId text field to the value of the id of a given TemplateData object.\r\n     */\r\n    private void setTemplateId() {\r\n        templateId = new TextField();\r\n        templateId.setValue(String.valueOf(templateData.getId()));\r\n        templateId.setWidth(\"40px\");\r\n        templateId.setValueChangeMode(ValueChangeMode.EAGER);\r\n        templateId.addValueChangeListener(event -> templateId.setValue(String.valueOf(templateData.getId())));\r\n    }\r\n\r\n    /**\r\n     * The setUploader function is responsible for setting up the uploader component.\r\n     * It creates a new MultiFileMemoryBuffer object, which will be used to store the uploaded files in memory.\r\n     * Then it creates a new Upload object and adds an event listener that listens for when an upload has succeeded.\r\n     * When this happens, it opens a FileImportDialog with the context of this class (the main view),\r\n     * passing along all necessary information to import data from uploaded files into our database tables.\r\n     */\r\n    private void setUploader() {\r\n        MultiFileMemoryBuffer memoryFileBuffer = new MultiFileMemoryBuffer();\r\n        Upload uploader = new Upload(memoryFileBuffer);\r\n        uploader.addSucceededListener(event -> {\r\n            FileImportDialog dialog = new FileImportDialog(ctx, event, memoryFileBuffer, this);\r\n            dialog.open();\r\n            dialog.execute();\r\n        });\r\n\r\n        uploadBtn.addClickListener(event -> {\r\n            Dialog cDialog = new Dialog();\r\n            cDialog.add(uploader);\r\n            cDialog.open();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The setSqlBtn function adds a click listener to the sqlBtn button.\r\n     * When clicked, it removes all components from the body component and then creates a new errorMessage label, an sqlInput text area, and a loadGrid button.\r\n     * If there is an SQL query in templateData's SQL query field (templateData.getSqlQuery()), then that value is set as the value of sqlInput's text area (sqlInput.setValue(templateData.getSqlQuery())).\r\n     * The loadGrid button has its own click listener which sets templateData's SQL query field to be equal to whatever was entered into\r\n     */\r\n    private void setSqlBtn() {\r\n        sqlBtn.addClickListener(event -> {\r\n            body.removeAll();\r\n            Label errorMessage = new Label();\r\n            errorMessage.setVisible(false);\r\n            final TextArea sqlInput = new TextArea();\r\n            sqlInput.setHeight(\"245px\");\r\n            sqlInput.setWidthFull();\r\n            if (Objects.nonNull(templateData.getSqlQuery()) && !templateData.getSqlQuery().isEmpty()) {\r\n                sqlInput.setValue(templateData.getSqlQuery());\r\n            }\r\n\r\n            Button loadGrid = new Button(getTranslation(TMS.GLB_BUTTON_SAVE, getLocale(), ctx));\r\n            loadGrid.addClickListener(internalEvent -> {\r\n                templateData.setSqlQuery(sqlInput.getValue());\r\n                try {\r\n                    reloadGrid();\r\n                    body.removeAll();\r\n                    body.add(customGrid);\r\n\r\n                    templateData = ctx.getServices().getTemplateDataRepository().save(templateData);\r\n\r\n                } catch (Exception e) {\r\n                    errorMessage.setVisible(true);\r\n                    errorMessage.setText(e.getLocalizedMessage());\r\n                }\r\n            });\r\n            body.add(errorMessage, sqlInput, loadGrid);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The setRefreshBtn function adds a click listener to the refresh button.\r\n     * When clicked, it reloads the page.\r\n     */\r\n    private void setRefreshBtn() {\r\n        refreshBtn.addClickListener(e -> this.reloadThis());\r\n    }\r\n\r\n    /**\r\n     * The setTableBtn function is a click listener that removes all components from the body,\r\n     * reloads the grid, and adds it to the body.\r\n     */\r\n    private void setTableBtn() {\r\n        tableBtn.addClickListener(e -> {\r\n            body.removeAll();\r\n            reloadGrid();\r\n            body.add(customGrid);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The setSaveBtn function adds a click listener to the saveBtn button.\r\n     * When the user clicks on this button, it will call the templateDataRepository's save function and pass in\r\n     * templateData as an argument. This will update any changes made to templateData in our database.\r\n     */\r\n    private void setSaveBtn() {\r\n        saveBtn.addClickListener(e -> templateData = ctx.getServices().getTemplateDataRepository().save(templateData));\r\n    }\r\n\r\n    /**\r\n     * The loadData function is responsible for loading the data from the database.\r\n     * It does this by first removing all components from the body component, then\r\n     * adding a loading icon to it. Then, it creates a new thread that will run in\r\n     * parallel with other threads and processes. This thread is responsible for\r\n     * querying the database using an SQL query stored in templateData (a variable\r\n     * of type TemplateData). The result of this query is stored as an ArrayList&lt;&gt;\r\n     * called table. Once this process has finished, we remove all components from\r\n     */\r\n    private void loadData() {\r\n        body.removeAll();\r\n        body.setSizeFull();\r\n        Image interDim = CompUtils.getInterDim(ctx);\r\n        interDim.setWidth(\"100px\");\r\n        interDim.setHeight(\"100px\");\r\n        final User user = ctx.getSession().getCurrentUser(ctx);\r\n        ui.access(() -> {\r\n            body.add(interDim);\r\n            body.setHorizontalComponentAlignment(Alignment.CENTER, interDim);\r\n            body.setAlignItems(Alignment.CENTER);\r\n        });\r\n        if (Objects.isNull(thread) || !thread.isAlive()) {\r\n            thread = new Thread(() -> {\r\n                try {\r\n                    table = ctx.getServices().getCustomRepository().findAllByCustom(templateData.getSqlQuery());\r\n                } catch (SQLException e) {\r\n                    log.error(\"[\" + user.getFullName() + \"] \" + e.getMessage());\r\n                    table = new ArrayList<>();\r\n                }\r\n                ui.access(() -> body.removeAll());\r\n            });\r\n            thread.start();\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * The getTypeOf function is a helper function that returns the type of an object.\r\n     *\r\n     * @param Object v Determine the type of object that is passed in\r\n     * @return The type of the value passed in\r\n     */\r\n    private String getTypeOf(Object v) {\r\n        /*\r\n         * Still looking for better Ways\r\n         */\r\n        String result = \"\";\r\n\r\n        if (Objects.nonNull(v)) {\r\n            if (v instanceof String)\r\n                result = Parse.toString(v);\r\n            if (v instanceof Integer)\r\n                result = String.valueOf(Parse.toInt(v));\r\n            if (v instanceof Double)\r\n                result = String.valueOf(Parse.toDouble(v));\r\n            if (v instanceof Float)\r\n                result = String.valueOf(Parse.toFloat(v));\r\n            if (v instanceof Long)\r\n                result = String.valueOf(Parse.toLong(v));\r\n            if (v instanceof Date)\r\n                result = v.toString();\r\n            if (v instanceof Timestamp)\r\n                result = v.toString();\r\n            if (v instanceof Boolean)\r\n                result = ((Boolean) v).toString();\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The setColumsSortAble function takes a List of Maps as an argument.\r\n     * The function then iterates through the first row of the table, and for each column in that row,\r\n     * it adds a column to the customGrid object with a header equal to k (the key) and sets its sortable property to true.\r\n     *\r\n     * @param List&lt;Map&lt;String Set the data in the grid\r\n     * @param Object&gt;&gt;        table Get the data from the table and then set it to a list&lt;map&lt;string, object&gt;&gt;\r\n     */\r\n    private void setColumsSortAble(List<Map<String, Object>> table) {\r\n        if (Objects.nonNull(table) && !table.isEmpty()) {\r\n            Map<String, Object> firstRow = table.get(0);\r\n            firstRow.forEach((k, x) -> customGrid.addColumn(map -> getTypeOf(map.get(k))).setHeader(k)\r\n                    .setResizable(true).setSortable(true));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The reloadGrid function is called when the user clicks on a column header to sort by that column.\r\n     * It removes all columns from the grid, then adds them back in sorted order.\r\n     */\r\n    private void reloadGrid() {\r\n        // setHeader\r\n        try {\r\n            customGrid.removeAllColumns();\r\n        } catch (Exception e) {\r\n            log.debug(e.getMessage(), e);\r\n        }\r\n        if (!table.isEmpty()) {\r\n            setColumsSortAble(table);\r\n            customGrid.setDataProvider(DataProvider.ofCollection(table));\r\n            ui.access(() -> {\r\n                body.removeAll();\r\n                body.add(customGrid);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The addTypoOfValue function takes in a list of headers, a list of numbers, and the key and value from the map.\r\n     * It then checks to see if the value is an instanceof Integer, Double, Float or Long. If it is one of these types\r\n     * then it adds that key to the numbers list. If not then it checks if its an instanceof String and adds that key\r\n     * to headers instead. This function helps us determine what type each column should be when we create our table later on\r\n     *\r\n     * @param List&lt;String&gt; headers Store the headers of the csv file\r\n     * @param List&lt;String&gt; numbers Store the keys of the values that are numbers\r\n     * @param String             key Add the key to the headers list\r\n     * @param Object             value Determine if the value is a number or string\r\n     */\r\n    private void addTypoOfValue(List<String> headers, List<String> numbers, String key, Object value) {\r\n        if (value instanceof Integer)\r\n            numbers.add(key);\r\n        if (value instanceof Double)\r\n            numbers.add(key);\r\n        if (value instanceof Float)\r\n            numbers.add(key);\r\n        if (value instanceof Long)\r\n            numbers.add(key);\r\n        if (value instanceof String)\r\n            headers.add(key);\r\n    }\r\n\r\n    private ComboBox<String> setChartCbx(String label, List<String> types) {\r\n        ComboBox<String> charts = new ComboBox<>(getTranslation(label, getLocale(), ctx), types);\r\n        if (!templateData.getChartType().isEmpty()) {\r\n            charts.setValue(templateData.getChartType());\r\n        }\r\n        return charts;\r\n    }\r\n\r\n    private Button setSaveChartBtn(final ComboBox<String> headCharts, final ComboBox<String> numbCharts,\r\n                                   ComboBox<String> charts) {\r\n        Button saveChartBtn = new Button(getTranslation(TMS.GLB_BUTTON_SAVE, getLocale(), ctx));\r\n        saveChartBtn.addClickListener(internalEvent -> {\r\n            String header = headCharts.getValue();\r\n            String number = numbCharts.getValue();\r\n\r\n            templateData.setChartSeriesName(header);\r\n            templateData.setChartSeriesValue(number);\r\n            templateData.setChartType(charts.getValue());\r\n\r\n            if (!header.isEmpty() && !number.isEmpty()) {\r\n                reloadThis();\r\n                templateData = ctx.getServices().getTemplateDataRepository().save(templateData);\r\n            }\r\n        });\r\n        return saveChartBtn;\r\n    }\r\n\r\n    private void setChartBtn() {\r\n        chartBtn.addClickListener(event -> {\r\n            body.removeAll();\r\n\r\n            List<String> headers = new ArrayList<>();\r\n            List<String> numbers = new ArrayList<>();\r\n\r\n            if (table.isEmpty()) {\r\n                loadData();\r\n            }\r\n\r\n            Map<String, Object> firstRow = table.get(0);\r\n\r\n            firstRow.forEach((k, v) -> addTypoOfValue(headers, numbers, k, v));\r\n\r\n            if (!numbers.isEmpty()) {\r\n                List<String> chartTypes = new ArrayList<>();\r\n                chartTypes.add(\"PIE\");\r\n                chartTypes.add(\"COLUMN\");\r\n                chartTypes.add(\"TABLE\");\r\n\r\n                ComboBox<String> charts = setChartCbx(TMS.SQL_TEMPLATE_SELECT, chartTypes);\r\n                ComboBox<String> headCharts = setChartCbx(TMS.SQL_TEMPLATE_X_HEADER, headers);\r\n                ComboBox<String> numbCharts = setChartCbx(TMS.SQL_TEMPLATE_Y_VALUE, numbers);\r\n\r\n                Button saveChartBtn = setSaveChartBtn(headCharts, numbCharts, numbCharts);\r\n\r\n                body.add(charts, headCharts, numbCharts, saveChartBtn);\r\n\r\n            } else {\r\n                Text text = new Text(getTranslation(TMS.ERROR_MSG_UNKNOWN_ERROR, getLocale(), ctx));\r\n                body.add(text);\r\n            }\r\n        });\r\n    }\r\n\r\n    private void reloadChart() {\r\n        ChartVariant variantChart = null;\r\n        if (!templateData.getChartType().isEmpty()) {\r\n            switch (templateData.getChartType()) {\r\n                default:\r\n                case \"PIE\":\r\n                    variantChart = new ChartVariant(ChartType.PIE);\r\n                    break;\r\n                case \"COLUMN\":\r\n                    variantChart = new ChartVariant(ChartType.COLUMN);\r\n                    break;\r\n            }\r\n\r\n            if (!templateData.getChartType().equals(\"TABLE\")) {\r\n                String header = templateData.getChartSeriesName();\r\n                String number = templateData.getChartSeriesValue();\r\n\r\n                Map<String, Number> dataSeries = new LinkedHashMap<>();\r\n                table.forEach(map -> {\r\n                    map.forEach((k, v) -> {\r\n                        if (k.equals(header)) {\r\n                            head = Parse.toString(v);\r\n                        }\r\n                        if (k.equals(number)) {\r\n                            numb = 0;\r\n                            if (v instanceof Integer)\r\n                                numb = (Integer) v;\r\n                            if (v instanceof Float)\r\n                                numb = (Float) v;\r\n                            if (v instanceof Double)\r\n                                numb = (Double) v;\r\n                            if (v instanceof Long)\r\n                                numb = (Long) v;\r\n                        }\r\n                    });\r\n                    dataSeries.put(head, numb);\r\n                });\r\n                final ChartVariant finalChart = variantChart;\r\n                ui.access(() -> {\r\n                    body.removeAll();\r\n                    body.add(finalChart);\r\n                    finalChart.reload(dataSeries);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    public TemplateData getData() {\r\n        return templateData;\r\n    }\r\n\r\n    public void reloadThis() {\r\n        loadData();\r\n        new Thread(() -> {\r\n            while (thread.isAlive()) {\r\n                InternalUtils.wait(1000);\r\n            }\r\n            if (!templateData.getChartType().isEmpty()) {\r\n                if (templateData.getChartType().equals(\"TABLE\")) {\r\n                    reloadGrid();\r\n                } else {\r\n                    reloadChart();\r\n                }\r\n            } else {\r\n                reloadGrid();\r\n            }\r\n            configAnchor(ctx);\r\n\r\n        }).start();\r\n    }\r\n\r\n    @Override\r\n    public void initLayout(FileImportDialog dialog) {\r\n        dialog.addValueCbx(TMS.FILE_IMPORTER_ARTICLE_NR, true);\r\n    }\r\n\r\n    @Override\r\n    public void doOnSave(FileImportDialog dialog) {\r\n        ctx.getServices().getArticleStatisticCustomRepository().removeByTemplate(templateData);\r\n        List<ArticleStatistic> stats = new ArrayList<>();\r\n        dialog.getTable().forEach(row -> stats.add(setStatistic(row, dialog)));\r\n        ctx.getServices().getArticleStatisticCustomRepository().insertList(ctx, stats);\r\n    }\r\n\r\n    private ArticleStatistic setStatistic(Map<Integer, String> colString, FileImportDialog dialog) {\r\n        ArticleStatistic statistic = new ArticleStatistic();\r\n        if (dialog.getColumns()[0] > -1) {\r\n            statistic.setIdentifier(dialog.getColumnsByIdx(colString, 0));\r\n        }\r\n        statistic.setTemplate(templateData);\r\n        return statistic;\r\n    }\r\n\r\n    @Override\r\n    public void directSave(FileImportDialog dialog, List<ArticleBase> articles) {\r\n        ctx.getServices().getArticleStatisticCustomRepository().removeByTemplate(templateData);\r\n        List<ArticleStatistic> stats = new ArrayList<>();\r\n        articles.forEach(item -> {\r\n            ArticleStatistic stat = new ArticleStatistic();\r\n            stat.setIdentifier(item.getArticleNr());\r\n            stat.setTemplate(templateData);\r\n            stats.add(stat);\r\n        });\r\n        ctx.getServices().getArticleStatisticCustomRepository().insertList(ctx, stats);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\statistic\\components\\SQLTemplate.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\statistic\\StatisticView.java =====\n```\npackage com.hom.ebmw.view.admin.statistic;\r\n\r\nimport com.hom.ebmw.configuration.security.Services;\r\nimport com.hom.ebmw.configuration.security.SessionUtils;\r\nimport com.hom.ebmw.jpa.model.TemplateData;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.UserSession;\r\nimport com.hom.ebmw.utilities.InternalUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.CTXAttribute;\r\nimport com.hom.ebmw.view.BaseLayout;\r\nimport com.hom.ebmw.view.MainView;\r\nimport com.hom.ebmw.view.admin.statistic.components.SQLTemplate;\r\nimport com.hom.ebmw.view.dialogs.CustomDialog;\r\nimport com.vaadin.flow.component.board.Board;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.checkbox.Checkbox;\r\nimport com.vaadin.flow.component.grid.Grid;\r\nimport com.vaadin.flow.component.grid.Grid.SelectionMode;\r\nimport com.vaadin.flow.component.html.Paragraph;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.data.binder.Binder;\r\nimport com.vaadin.flow.data.binder.ValidationResult;\r\nimport com.vaadin.flow.data.binder.Validator;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\nimport com.vaadin.flow.router.PageTitle;\r\nimport com.vaadin.flow.router.Route;\r\n\r\nimport java.util.List;\r\nimport java.util.Objects;\r\nimport java.util.Optional;\r\n\r\nimport static com.hom.ebmw.utilities.interfaces.PageConst.PAGE_STATISTIC;\r\nimport static com.hom.ebmw.utilities.interfaces.PageConst.TITLE_STATISTIC;\r\n\r\n@SuppressWarnings(\"serial\")\r\n@Route(value = PAGE_STATISTIC, layout = MainView.class)\r\n@PageTitle(TITLE_STATISTIC)\r\npublic class StatisticView extends BaseLayout {\r\n\r\n    private final Board viewBoard;\r\n    private VerticalLayout menu;\r\n\r\n    private Grid<TemplateData> templateGrid;\r\n    private final Context ctx = new Context();\r\n\r\n\r\n    /**\r\n     * The StatisticView function is a constructor for the StatisticView class.\r\n     * It creates a new Board object called viewBoard, and adds it to the middle section of the page.\r\n     * It also sets up a menu on the right side of this page, which will be used to navigate between different statistics pages.\r\n     *\r\n     * @param Services services Get the user services\r\n     */\r\n    public StatisticView(Services services) {\r\n        ctx.put(CTXAttribute.SESSION, new SessionUtils(services.getUserServices()));\r\n        ctx.put(CTXAttribute.USER_SESSION, new UserSession());\r\n        ctx.put(CTXAttribute.SERVICES, services);\r\n        ctx.put(CTXAttribute.HTTP_SESSION, ctx.getSession().getHttpSession());\r\n\r\n        viewBoard = new Board();\r\n\r\n        setMenu();\r\n\r\n        menu.setWidth(\"100%\");\r\n        viewBoard.setWidth(\"100%\");\r\n        viewBoard.add(new Paragraph(getTranslation(TMS.STATISTIC_PLEASE_RELOAD, getLocale(), ctx)));\r\n\r\n        getMiddleSection().add(viewBoard);\r\n        setLeftVisible(false);\r\n        getRightSection().setWidth(\"20%\");\r\n        getRightSection().add(menu);\r\n    }\r\n\r\n    /**\r\n     * The setMenu function is responsible for creating the menu that appears on the left side of the screen.\r\n     * It creates a vertical layout, which contains a horizontal layout with two buttons: refreshAll and deleteSelected.\r\n     * The refreshAll button refreshes all of the data in templateGrid, while deleteSelected deletes any selected items from templateGrid.\r\n     */\r\n    private void setMenu() {\r\n        Binder<TemplateData> binder = new Binder<>();\r\n        binder.setBean(new TemplateData());\r\n        menu = new VerticalLayout();\r\n        TextField newTemplaceName = new TextField();\r\n        binder.forField(newTemplaceName).withValidator((Validator<String>) (value, context) -> {\r\n            if (value.isEmpty() || value.trim().isEmpty()) {\r\n                return ValidationResult.error(getTranslation(TMS.ERROR_VALIDATION_NOT_EMPTY, getLocale(), ctx));\r\n            }\r\n            return ValidationResult.ok();\r\n        }).bind(TemplateData::getTitle, TemplateData::setTitle);\r\n        Button newBtn = new Button(VaadinIcon.PLUS.create());\r\n        newBtn.addClickListener(event -> {\r\n            if (binder.isValid()) {\r\n                TemplateData data = binder.getBean();\r\n                data.setId(0);\r\n                save(data);\r\n                binder.setBean(new TemplateData());\r\n                reloadGrid();\r\n            }\r\n        });\r\n\r\n        Button editBtn = new Button(VaadinIcon.PENCIL.create());\r\n        editBtn.addClickListener(event -> {\r\n            if (binder.isValid()) {\r\n                TemplateData data = binder.getBean();\r\n                if (data.getId() != 0) {\r\n                    save(data);\r\n                    reloadGrid();\r\n                }\r\n            }\r\n            String title = newTemplaceName.getValue();\r\n\r\n            TemplateData data = new TemplateData();\r\n            data.setTitle(title);\r\n            save(data);\r\n            reloadGrid();\r\n        });\r\n        HorizontalLayout addBay = new HorizontalLayout(newTemplaceName, editBtn, newBtn);\r\n\r\n        Button refreshAll = new Button(VaadinIcon.REFRESH.create());\r\n        refreshAll.addClickListener(event -> {\r\n            CustomDialog dialog = new CustomDialog(ctx);\r\n            dialog.setCom(() -> {\r\n                dialog.setLabel(TMS.STATISTIC_LOADING);\r\n                setViewBoard();\r\n            });\r\n            dialog.open();\r\n            dialog.run();\r\n        });\r\n\r\n        Button deleteSelected = new Button(VaadinIcon.CLOSE.create());\r\n        deleteSelected.addClickListener(event -> {\r\n            if (binder.getBean().getId() != 0) {\r\n                TemplateData data = binder.getBean();\r\n                data.setDeleted(true);\r\n                save(data);\r\n                reloadGrid();\r\n                setViewBoard();\r\n            } else {\r\n                binder.getBean().setTitle(\"\");\r\n            }\r\n        });\r\n\r\n        templateGrid = new Grid<>();\r\n\r\n        HorizontalLayout buttonBay = new HorizontalLayout();\r\n        buttonBay.add(refreshAll, deleteSelected);\r\n        buttonBay.setMargin(false);\r\n        buttonBay.setPadding(false);\r\n        menu.add(addBay, buttonBay, templateGrid);\r\n\r\n        templateGrid.addComponentColumn(this::getActive).setWidth(\"30px\");\r\n        templateGrid.addColumn(TemplateData::getTitle).setFlexGrow(4);\r\n        templateGrid.addSelectionListener(event ->\r\n                event.getFirstSelectedItem().ifPresent(item -> {\r\n                    if (item.getId() != 0) {\r\n                        Optional<TemplateData> optData = ctx.getServices().getTemplateDataRepository()\r\n                                .findById(item.getId());\r\n                        binder.setBean(optData.get());\r\n                    } else {\r\n                        binder.setBean(item);\r\n                    }\r\n                }));\r\n        templateGrid.setSelectionMode(SelectionMode.SINGLE);\r\n\r\n        reloadGrid();\r\n\r\n    }\r\n\r\n    /**\r\n     * The save function is used to save a TemplateData object into the database.\r\n     *\r\n     * @param TemplateData data Save the data to the database\r\n     * @return A templatedata object\r\n     */\r\n    private TemplateData save(TemplateData data) {\r\n        if (Objects.nonNull(data) && !data.getTitle().isEmpty()) {\r\n            return ctx.getServices().getTemplateDataRepository().save(data);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * The reloadGrid function is called when the user clicks on the &quot;Refresh&quot; button.\r\n     * It reloads all of the templates from the database and displays them in a grid.\r\n     */\r\n    private void reloadGrid() {\r\n        List<TemplateData> allTemplates = ctx.getServices().getTemplateDataRepository().findAllByDeleted(false);\r\n        templateGrid.setDataProvider(DataProvider.ofCollection(allTemplates));\r\n    }\r\n\r\n    /**\r\n     * The getActive function is a helper function that returns a Checkbox object.\r\n     * The value of the checkbox is set to the active status of the TemplateData object passed in as an argument.\r\n     * A listener is added to this checkbox, which will update the active status of its corresponding TemplateData object when it changes.\r\n     *\r\n     * @param TemplateData data Get the data from the database\r\n     */\r\n    private Checkbox getActive(TemplateData data) {\r\n        Checkbox activeBox = new Checkbox();\r\n        activeBox.setValue(data.isActive());\r\n\r\n        activeBox.addValueChangeListener(event -> {\r\n            final TemplateData fixData = ctx.getServices().getTemplateDataRepository().findById(data.getId()).get();\r\n            fixData.setActive(event.getValue());\r\n            save(fixData);\r\n        });\r\n        return activeBox;\r\n    }\r\n\r\n    /**\r\n     * The setViewBoard function is responsible for creating the grid of SQLTemplate objects that are displayed on the\r\n     * main page. It does this by first querying the database for all TemplateData objects, and then removing any that\r\n     * have been deleted or deactivated. Then it splits up these remaining templates into groups of 4 (or less if there\r\n     * are fewer than 4 left), and creates a new row in viewBoard for each group. Each row contains an array of SQLTemplate\r\n     * objects, one per template in its respective group. The function then adds each row to viewBoard using addRow(). If no\r\n     * templates remain after filtering\r\n     */\r\n    private void setViewBoard() {\r\n        final int iMaxRow = 4;\r\n        List<TemplateData> listTemplate = ctx.getServices().getTemplateDataRepository().findAllByDeleted(false);\r\n        listTemplate.removeIf(item -> !item.isActive());\r\n        viewBoard.removeAll();\r\n\r\n        List<List<TemplateData>> subLines = InternalUtils.listSplitter(listTemplate, iMaxRow);\r\n        if (!subLines.isEmpty()) {\r\n            subLines.forEach(list -> {\r\n                SQLTemplate[] comps = new SQLTemplate[list.size()];\r\n                for (TemplateData data : list) {\r\n                    comps[list.indexOf(data)] = new SQLTemplate(ctx, data);\r\n                }\r\n                viewBoard.addRow(comps);\r\n            });\r\n        } else {\r\n            viewBoard.add(new Paragraph(getTranslation(TMS.STATISTIC_PLEASE_RELOAD, getLocale(), ctx)));\r\n        }\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\statistic\\StatisticView.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\translations\\ConfigPresenter.java =====\n```\npackage com.hom.ebmw.view.admin.translations;\r\n\r\nimport com.hom.ebmw.configuration.ApplicationProperty;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.Translation;\r\nimport com.hom.ebmw.utilities.FileTranslatorRepository;\r\nimport com.vaadin.flow.component.gridpro.GridPro;\r\nimport com.vaadin.flow.data.provider.ListDataProvider;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\n\r\npublic class ConfigPresenter {\r\n\r\n    private final ApplicationProperty prop;\r\n    private final FileTranslatorRepository translationRepository;\r\n\r\n    /**\r\n     * The ConfigPresenter function is responsible for the following:\r\n     * 1. It creates a new ConfigView object and sets it as the view of this presenter.\r\n     * 2. It initializes all of the fields in its view with values from its property service, which is passed to it by context when it's created (see above).\r\n     * 3. It registers itself as an observer on each field in its view so that if any changes are made to those fields, they will be saved back into their corresponding properties in the property service (see below).\r\n     *\r\n     * @param Context ctx Get the services from the context object\r\n     * @return An object with the following properties:\r\n     */\r\n    public ConfigPresenter(Context ctx) {\r\n        this.prop = ctx.getServices().getProperty();\r\n        this.translationRepository = ctx.getServices().getFileTranslationRepository();\r\n    }\r\n\r\n    /**\r\n     * The fillGrid function is used to fill the grid with data.\r\n     * It takes a GridPro object as an argument and returns nothing.\r\n     * The function first calls reloadGrid, which loads all of the translations from the database into memory.\r\n     * Then it splits up the translationLang property (which contains a comma-separated list of language tags)\r\n     * into individual strings, and for each one it adds an editable column to our grid that displays that language's translation\r\n     * for each item in our list of translations (the &quot;value&quot; parameter). When we click on one of these cells, we can enter a new\r\n     *\r\n     * @param GridPro&lt;Translation&gt; grid Pass the grid to the function\r\n     */\r\n    public void fillGrid(GridPro<Translation> grid) {\r\n\r\n        reloadGrid(grid);\r\n\r\n        Arrays.asList(prop.getTranslationLang().split(\",\")).forEach(langTag -> {\r\n            grid.addEditColumn(value -> {\r\n                return value.getTranslations().get(langTag);\r\n            }).text((item, newValue) -> {\r\n                item.getTranslations().put(langTag, newValue);\r\n                save(item);\r\n            }).setHeader(langTag);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The save function takes a Translation object and saves it to the database.\r\n     *\r\n     * @param Translation translation Set the translator for the translationrepository\r\n     */\r\n    public void save(Translation translation) {\r\n        translationRepository.setTranslator(translation);\r\n    }\r\n\r\n    /**\r\n     * The reloadGrid function is used to refresh the grid with new data.\r\n     * It does this by first getting all of the translations from the database,\r\n     * then sorting them alphabetically by key, and finally setting a ListDataProvider\r\n     * as its data provider. The ListDataProvider is given a list of translations that it will use to populate the grid.\r\n     *\r\n     * @param GridPro&lt;Translation&gt; grid Set the data provider of the grid\r\n     */\r\n    private void reloadGrid(GridPro<Translation> grid) {\r\n        List<Translation> translations = getAll();\r\n\r\n        translations.sort((o1, o2) -> o1.getKey().compareTo(o2.getKey()));\r\n\r\n        ListDataProvider<Translation> dataProvider = new ListDataProvider<Translation>(translations);\r\n        grid.setDataProvider(dataProvider);\r\n    }\r\n\r\n    /**\r\n     * The getAll function returns a list of all translations in the database.\r\n     *\r\n     * @return A list of translation objects\r\n     */\r\n    private List<Translation> getAll() {\r\n        List<Translation> all = new ArrayList<Translation>();\r\n        all.addAll(translationRepository.getAllTranslations());\r\n        all.sort((t1, t2) -> t1.getKey().compareTo(t2.getKey()));\r\n        return all;\r\n    }\r\n\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\translations\\ConfigPresenter.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\translations\\TranslationView.java =====\n```\npackage com.hom.ebmw.view.admin.translations;\r\n\r\n\r\nimport com.hom.ebmw.configuration.security.Services;\r\nimport com.hom.ebmw.configuration.security.SessionUtils;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.Translation;\r\nimport com.hom.ebmw.pojo.UserSession;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.enums.CTXAttribute;\r\nimport com.hom.ebmw.view.MainView;\r\nimport com.vaadin.flow.component.Composite;\r\nimport com.vaadin.flow.component.gridpro.GridPro;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.data.provider.ListDataProvider;\r\nimport com.vaadin.flow.router.PageTitle;\r\nimport com.vaadin.flow.router.Route;\r\n\r\nimport java.util.Locale;\r\nimport java.util.UUID;\r\n\r\nimport static com.hom.ebmw.utilities.interfaces.PageConst.PAGE_CONFIG;\r\nimport static com.hom.ebmw.utilities.interfaces.PageConst.TITLE_CONFIG;\r\n\r\n@SuppressWarnings(\"serial\")\r\n@Route(value = PAGE_CONFIG, layout = MainView.class)\r\n@PageTitle(TITLE_CONFIG)\r\npublic class TranslationView extends Composite<VerticalLayout> {\r\n    private final Context ctx = new Context();\r\n\r\n    /**\r\n     * The TranslationView function is a constructor for the TranslationView class.\r\n     * It creates a new instance of the TranslationView class, and initializes it with\r\n     * an instance of Services as its parameter. The function then sets up the grid that will be used to display\r\n     * translations in this view, and adds it to the content area of this view. Finally, it removes any margins or padding from\r\n     * this view's content area so that there are no gaps between elements on screen when they are displayed by Vaadin Flow.\r\n     *\r\n     * @param Services services Get the userservices object\r\n     * @return A component\r\n     */\r\n    public TranslationView(Services services) {\r\n        ctx.setUuid(UUID.randomUUID());\r\n        ctx.put(CTXAttribute.SESSION, new SessionUtils(services.getUserServices()));\r\n        ctx.put(CTXAttribute.USER_SESSION, new UserSession());\r\n        ctx.put(CTXAttribute.SERVICES, services);\r\n        ConfigPresenter presenter = new ConfigPresenter(ctx);\r\n\r\n        GridPro<Translation> grid = new GridPro<Translation>();\r\n        grid.addColumn(item -> {\r\n                    return item.getKey();\r\n                }).setHeader(setSearchField(grid))\r\n                .setSortable(true);\r\n\r\n        presenter.fillGrid(grid);\r\n\r\n        getContent().add(grid);\r\n        getContent().setSizeFull();\r\n        CompUtils.removeMSP(getContent(), \"MP\");\r\n    }\r\n\r\n    /**\r\n     * The setSearchField function creates a TextField that is used to filter the GridPro.\r\n     * The function takes in a GridPro as an argument and returns the created TextField.\r\n     *\r\n     * @param GridPro&lt;Translation&gt; grid Create a grid\r\n     * @return A textfield\r\n     */\r\n    private TextField setSearchField(GridPro<Translation> grid) {\r\n        TextField searchFld = new TextField();\r\n        searchFld.setPlaceholder(\" ... \");\r\n        searchFld.setWidth(\"400px\");\r\n\r\n        searchFld.addValueChangeListener(event -> {\r\n            @SuppressWarnings({\r\n                    \"unchecked\", \"rawtypes\"})\r\n            ListDataProvider<Translation> listProvider = (ListDataProvider) grid.getDataProvider();\r\n            listProvider.setFilter(Translation::getKey, key -> {\r\n                String nameLower = key == null ? \"\" : key.toLowerCase(Locale.ENGLISH);\r\n                String filterLower = searchFld.getValue().toLowerCase(Locale.ENGLISH);\r\n                return nameLower.contains(filterLower);\r\n            });\r\n        });\r\n\r\n        return searchFld;\r\n    }\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\admin\\translations\\TranslationView.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\BaseLayout.java =====\n```\npackage com.hom.ebmw.view;\r\n\r\nimport com.hom.ebmw.utilities.enums.SectionVisible;\r\nimport com.vaadin.flow.component.Composite;\r\nimport com.vaadin.flow.component.html.Div;\r\nimport com.vaadin.flow.component.html.NativeButton;\r\nimport com.vaadin.flow.component.orderedlayout.FlexComponent.Alignment;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.dom.Style;\r\nimport lombok.Getter;\r\n\r\npublic class BaseLayout\r\n        extends\r\n        Composite<HorizontalLayout> {\r\n    /**\r\n     *\r\n     */\r\n    private static final long serialVersionUID = 2603247139693600034L;\r\n\r\n    private final @Getter Div leftSection = new Div();\r\n    private final @Getter Div middleSection = new Div();\r\n    private final @Getter Div rightSection = new Div();\r\n\r\n    private final @Getter NativeButton closeLeft = new NativeButton();\r\n    private final @Getter NativeButton closeRight = new NativeButton();\r\n    private final boolean RIGHT = true;\r\n    private final boolean LEFT = false;\r\n\r\n    /**\r\n     * The BaseLayout function is the constructor for the BaseLayout class.\r\n     * It sets up a basic layout with three sections: left, middle, and right.\r\n     * The left and right sections are 20% of the screen width each, while\r\n     * the middle section takes up 60%. This function also adds close buttons to\r\n     * both sides of this layout so that they can be closed if desired by clicking on them.\r\n     *\r\n     * @return The content of the baselayout, which is a verticallayout\r\n     * @docauthor Trelent\r\n     */\r\n    public BaseLayout() {\r\n\r\n        Style style = getContent().getStyle();\r\n        style.set(\"width\", \"100%\");\r\n        style.set(\"height\", \"100%\");\r\n        style.set(\"minHeight\", \"100%\");\r\n        style.set(\"maxHeight\", \"100%\");\r\n\r\n        leftSection.setWidth(\"20%\");\r\n        leftSection.setMaxWidth(\"20%\");\r\n        leftSection.setHeight(\"100%\");\r\n        rightSection.setWidth(\"20%\");\r\n        rightSection.setMaxWidth(\"20%\");\r\n        rightSection.setHeight(\"100%\");\r\n        middleSection.setWidth(\"60%\");\r\n        middleSection.setMaxWidth(\"100%\");\r\n        middleSection.setHeight(\"100%\");\r\n\r\n\r\n        setLeftCloseBtn();\r\n        setRightCloseBtn();\r\n\r\n        getContent().add(leftSection, closeLeft, middleSection, closeRight, rightSection);\r\n        getContent().setSpacing(false);\r\n        getContent().setDefaultVerticalComponentAlignment(Alignment.STRETCH);\r\n        getContent().setVerticalComponentAlignment(Alignment.CENTER, closeLeft, closeRight);\r\n        getContent().setId(\"base-layout\");\r\n    }\r\n\r\n    /**\r\n     * The setLeftVisible function sets the visibility of the left section to true or false.\r\n     *\r\n     * @param boolean visible Set the visibility of the closeleft button and leftsection\r\n     * @return Nothing\r\n     * @docauthor Trelent\r\n     */\r\n    public void setLeftVisible(boolean visible) {\r\n        closeLeft.setVisible(visible);\r\n        leftSection.setVisible(visible);\r\n        switchVisibility();\r\n    }\r\n\r\n    /**\r\n     * The setButtonStyle function sets the style of a button.\r\n     *\r\n     * @param Style style Set the style of the button\r\n     * @return A style object\r\n     * @docauthor Trelent\r\n     */\r\n    private void setButtonStyle(Style style) {\r\n        style.set(\"padding\", \"2px 0px\");\r\n        style.set(\"border-width\", \"0px\");\r\n        style.set(\"border-radius\", \"10px\");\r\n        style.set(\"margin-top\", \"2px\");\r\n    }\r\n\r\n    /**\r\n     * The setLeftCloseBtn function sets the left close button to be visible and\r\n     * adds a click listener that will toggle the visibility of the left section.\r\n     *\r\n     * @return A button with the text and style of the closeleft variable\r\n     * @docauthor Trelent\r\n     */\r\n    private void setLeftCloseBtn() {\r\n        closeLeft.setText(directionChange(LEFT));\r\n        closeLeft.setId(\"button-close-left\");\r\n        closeLeft.setHeightFull();\r\n        setButtonStyle(closeLeft.getStyle());\r\n\r\n        closeLeft.addClickListener(event -> {\r\n            leftSection.setVisible(!leftSection.isVisible());\r\n            closeLeft.setText(directionChange(!leftSection.isVisible()));\r\n            switchVisibility();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The switchVisibility function is used to change the width of the middle section depending on which sections are visible.\r\n     * If all three sections are visible, then the middle section will be 60% of its original size.\r\n     * If only two sections are visible, then it will be 80%.\r\n     * And if only one section is visible, it will be 100%.\r\n     *\r\n     * @return A value of type sectionvisible\r\n     * @docauthor Trelent\r\n     */\r\n    public void switchVisibility() {\r\n        boolean left = leftSection.isVisible();\r\n        boolean right = rightSection.isVisible();\r\n\r\n        SectionVisible visible = SectionVisible.valueOf(left, right);\r\n\r\n        switch (visible) {\r\n            case LEFT_MIDDLE_RIGHT:\r\n                getMiddleSection().setWidth(\"60%\");\r\n                break;\r\n            case MIDDLE_RIGHT:\r\n            case LEFT_MIDDLE:\r\n                getMiddleSection().setWidth(\"80%\");\r\n                break;\r\n            case MIDDLE:\r\n                getMiddleSection().setWidth(\"100%\");\r\n                break;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The setRightVisible function sets the visibility of the right section.\r\n     *\r\n     * @param boolean visible Determine whether the right section is visible or not\r\n     * @return Void\r\n     * @docauthor Trelent\r\n     */\r\n    public void setRightVisible(boolean visible) {\r\n        closeRight.setVisible(visible);\r\n        rightSection.setVisible(visible);\r\n        switchVisibility();\r\n    }\r\n\r\n    /**\r\n     * The setRightCloseBtn function sets the right close button.\r\n     * It sets the text of the button to be a direction change, which is determined by whether or not\r\n     * the right section is visible. If it's visible, then it will set the text to &quot;&lt;&lt;&quot; and if not, then &quot;&gt;&gt;&quot;.\r\n     * It also sets its height to full and calls setButtonStyle on its style so that it can have a custom style.\r\n     * Finally, when clicked on this function will switch visibility of both sections (left and right) as well as change\r\n     * the text of itself depending on whether or not either section\r\n     *\r\n     * @return A button with a text that is set to the value of directionchange(right), which returns &quot;&gt;&quot;\r\n     * @docauthor Trelent\r\n     */\r\n    private void setRightCloseBtn() {\r\n        closeRight.setText(directionChange(RIGHT));\r\n        closeRight.setId(\"button-close-right\");\r\n        closeRight.setHeightFull();\r\n        setButtonStyle(closeRight.getStyle());\r\n\r\n        closeRight.addClickListener(event -> {\r\n            rightSection.setVisible(!rightSection.isVisible());\r\n            closeRight.setText(directionChange(rightSection.isVisible()));\r\n            switchVisibility();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The directionChange function takes a boolean value and returns a string.\r\n     * If the boolean is true, it will return &quot;&quot;.\r\n     * If the boolean is false, it will return &quot;&quot;.\r\n     *\r\n     * @param boolean direction Determine the direction of the train\r\n     * @return A string\r\n     * @docauthor Trelent\r\n     */\r\n    public String directionChange(boolean direction) {\r\n        if (direction) // true = rechts\r\n            return \"\";\r\n        else // false = links\r\n            return \"\";\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\BaseLayout.java =====\n\n"
  },
  "response" : {
    "id" : "chatcmpl-7xQehku9oUtt50q81YRAF7MhGCJUSEAS",
    "created" : 1762171314,
    "model" : "gpt-oss:120b",
    "object" : "chat.completion",
    "system_fingerprint" : "b1-b0d5299",
    "choices" : [ {
      "finish_reason" : "stop",
      "index" : 0,
      "message" : {
        "content" : "{\n  \"file\": \"multiple\",\n  \"issues\": [\n    {\n      \"severity\": \"High\",\n      \"problem\": \"PathSelectDialog.save() uses an empty list to access selected.get(0) causing IndexOutOfBoundsException.\",\n      \"justification\": \"The button creates a new List<File> but never adds any selected file before accessing the first element, leading to a runtime crash when the save button is pressed.\",\n      \"action\": \"Populate the list with the selected file from the TreeGrid or directly use the selected File; add a null/empty check before accessing index 0; add unit test for save button with no selection.\",\n      \"source\": \"PathSelectDialog.save button click listener, lines 63-70\",\n      \"component\": \"setting-view\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"SQLTemplate accepts raw userprovided SQL queries and executes them via findAllByCustom, leading to SQL Injection.\",\n      \"justification\": \"User input is stored in TemplateData.sqlQuery and later executed without any sanitisation or prepared statements, exposing the database to arbitrary queries.\",\n      \"action\": \"Replace the custom repository call with a safe query builder or parameterised statements; validate/whitelist allowed SQL keywords; add integration tests ensuring malicious input is rejected.\",\n      \"source\": \"SQLTemplate.reloadGrid() / loadData() where templateData.getSqlQuery() is executed, lines 172185\",\n      \"component\": \"statistic\",\n      \"impact_scope\": \"securitycritical\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"SettingParameterGrid.getParamByValue() may throw NullPointerException when settingParameter.getValue() is null.\",\n      \"justification\": \"The method calls settingParameter.getValue().equals(value) without nullchecking the value field, causing NPE if a parameter has a null value.\",\n      \"action\": \"Add a null check before calling equals, e.g., Objects.equals(settingParameter.getValue(), value); add tests covering null values.\",\n      \"source\": \"SettingParameterGrid.getParamByValue, lines 8492\",\n      \"component\": \"adminsetting\",\n      \"impact_scope\": \"prodrelevant\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"SettingParameterGrid.draggedItem can be null in drop listener leading to NPE when comparing with dropOverItem.\",\n      \"justification\": \"If a drop event fires without a preceding drag start, draggedItem remains null; the code calls draggedItem.equals(...).\",\n      \"action\": \"Guard the drop handler with a null check: if (draggedItem == null) return; add defensive test for dragdrop edge case.\",\n      \"source\": \"SettingParameterGrid.addDropListener, lines 5666\",\n      \"component\": \"adminsetting\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"PathSelectDialog.reloadTree() does not verify that File.listFiles() returns nonnull, risking NullPointerException for nondirectory paths.\",\n      \"justification\": \"FolderContainer.getChilds() iterates over file.listFiles() assuming it is nonnull; if the path is a file or inaccessible, listFiles() returns null.\",\n      \"action\": \"Check for null before looping; skip or display error when path is not a directory; add unit test for invalid path handling.\",\n      \"source\": \"PathSelectDialog.FolderContainer.getChilds, lines 165173\",\n      \"component\": \"settingview\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"SQLTemplate.setChartBtn() passes the wrong ComboBox to setSaveChartBtn, causing chart type never to be saved.\",\n      \"justification\": \"The third argument should be the chart type ComboBox but the code passes numbCharts, resulting in missing chart configuration.\",\n      \"action\": \"Change the call to setSaveChartBtn(headCharts, numbCharts, charts); add a test verifying chart type persistence.\",\n      \"source\": \"SQLTemplate.setChartBtn, line 277\",\n      \"component\": \"statistic\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"SettingGrid.createIdentifer() may throw IllegalArgumentException if setting.getIdentifier() contains an unknown enum value.\",\n      \"justification\": \"The method directly calls SettingType.valueOf(setting.getIdentifier()) without handling invalid values.\",\n      \"action\": \"Wrap the call in try/catch and fallback to a default; add validation when persisting identifiers.\",\n      \"source\": \"SettingGrid.createIdentifer, lines 115124\",\n      \"component\": \"adminsetting\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"SQLTemplate.loadData() creates a new Thread without proper interruption handling, risking thread leakage.\",\n      \"justification\": \"If reloadThis() is called repeatedly, multiple threads may be spawned; they are never cancelled or joined.\",\n      \"action\": \"Use an ExecutorService with a singlethread executor; cancel previous task before starting a new one; add tests for concurrent reload calls.\",\n      \"source\": \"SQLTemplate.loadData, lines 140161\",\n      \"component\": \"statistic\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"StatisticView.editBtn click listener contains duplicated save logic and creates a new TemplateData regardless of validation state.\",\n      \"justification\": \"The code saves the bound bean, then creates a new TemplateData with the same title and saves again, leading to unintended duplicate entries.\",\n      \"action\": \"Refactor editBtn handler to only save when bean is valid and has an existing id; remove redundant creation of new TemplateData; add unit test for edit flow.\",\n      \"source\": \"StatisticView.editBtn listener, lines 87108\",\n      \"component\": \"statistic\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    }\n  ],\n  \"summary\": {\n    \"overall_rating\": \"3\",\n    \"top_todos\": [\n      \"Fix PathSelectDialog.save() to correctly handle selected file and add validation.\",\n      \"Mitigate SQL injection risk in SQLTemplate by using prepared statements or whitelist validation.\",\n      \"Add nullsafety checks in SettingParameterGrid.getParamByValue and dragdrop handlers.\"\n    ]\n  }\n}",
        "role" : "assistant",
        "reasoning_content" : "We need to produce a JSON with file and issues for each chunk? The instruction: \"Du analysierst jeweils einen Code-Chunk.\" Could produce one JSON per file? The required output format includes \"file\" field, issues array, summary. Probably need one JSON per file processed. Might combine all? The prompt includes many files; we must output for each? The spec says max 10 issues per file/chunk. Could produce multiple JSON objects? But must be a single JSON object. The instruction: \"Deine Antwort MUSS exakt dieses JSON-Schema haben\". That suggests one JSON object overall. But we have many files; we could combine analyses into one JSON with multiple entries? However schema only has single file field. Might need to output for each file separately; but then would violate single JSON. The typical approach in these tasks is to output a JSON per file, but they ask for only one object. Could choose to output for the first file only? Not sure.\n\nMaybe we need to produce one JSON that aggregates all issues across all files, with \"file\" maybe \"multiple\" or null. But schema expects file path string. Could set as \"multiple\". Might be acceptable.\n\nWe should list key issues across the codebase, up to 10 per file? If we treat each file separately, we'd exceed 10 total maybe. Could list up to 10 overall.\n\nBetter: Provide summary across all files, with file: \"multiple\". Provide issues list (max 10) that are the most important across all files.\n\nLet's identify issues:\n\n1. SettingParameterGrid: selectedParameters initialized as null, never set unless selection occurs, getter returns null -> possible NPE when used. Also drag-and-drop: drop listener assumes draggedItem non-null; if no drag start? Might be NPE. Also getParamByValue uses settingParameter.getValue().equals(value) without null check on getValue. Could NPE. Also reorder: uses getSettingParams().removeIf(item -> Objects.isNull(item.getDisplayOrder()) || item.getDisplayOrder() == -1); but later sets displayOrder using indexOf each time, inefficiency. Not major.\n\n2. Structure_SPGrid setEmptyRow: creates new SettingParameter<Structure>(); adds to list but may duplicate empty rows each reload; also getSettingParams may be null initially, setSettingParams called later? Not thread safe.\n\n3. PathSelectDialog: In save button, creates List<File> selected = new ArrayList<>(); then setting.setValue(selected.get(0).getAbsolutePath()); selected is empty -> IndexOutOfBoundsException. Also path field value change listener pattern.\n\n4. PathSelectDialog: reloadTree uses new FolderContainer(rootPath) where file may be null? rootPath may be invalid; getChilds loops over file.listFiles() without null check; could NPE if listFiles returns null (e.g., not a directory). Also setChild catches generic Exception but swallows.\n\n5. SQLTemplate: setTemplateId listener sets value to same id, but not needed. loadData: uses thread without proper interruption handling, may start multiple threads; UI access may cause concurrency issues. Also body.removeAll() then later ui.access adds components; but thread may still be running. Also getTypeOf uses instanceof checks but returns empty string for unknown types; may hide errors.\n\n6. SQLTemplate: setChartBtn uses saveChartBtn = setSaveChartBtn(headCharts, numbCharts, numbCharts); passes numbCharts twice, should be charts? bug leads to chart type not saved.\n\n7. SQLTemplate: setChartBtn's saveChartBtn uses setSaveChartBtn(headCharts, numbCharts, numbCharts) -> third param expected ComboBox<String> charts but passes numbCharts. This is bug.\n\n8. SQLTemplate: reloadChart builds dataSeries map where head may be overwritten for each row; uses last row's header value; maybe incorrect.\n\n9. StatisticView: editBtn click listener has duplicated logic: after save maybe reassign new TemplateData; also missing else for invalid case; also new TemplateData created always after saving causing duplicate.\n\n10. BaseLayout: directionChange returns \"\" for true (right) and \"\" for false (left). But setLeftCloseBtn sets text directionChange(LEFT) where LEFT = false, so initial left close button shows \"\" which is direction to left maybe confusing but not bug.\n\nMaybe also SettingGrid: createIdentifer sets placeholder if identifier equals \"identifier\" but also sets value if not; but if setting.getIdentifier() is null may NPE. Also createDataTyp: dataTypeBox.setValue(SettingDataType.valueOf(setting.getDatatype())) may throw IllegalArgumentException if datatype is invalid; but they set default earlier.\n\nSelectRoleDialog: In createMultiBox, roleId parsing uses Parse.toLong(roleId) but roleId may be null? but getAllRoles returns strings; fine.\n\nPotential security: no input validation for SQL queries (SQLTemplate) leads to SQL injection as user-provided query executed directly via custom repository findAllByCustom. That's high risk.\n\nAlso PathSelectDialog uses UI access from non-UI thread but they pass UI param; okay.\n\nNow produce JSON with file \"multiple\" and issues list.\n\nInclude severity levels: high for SQL injection, NPE, index OOB, thread safety.\n\nProvide actions.\n\nLet's craft up to 10 issues."
      },
      "provider_specific_fields" : { }
    } ],
    "usage" : {
      "completion_tokens" : 2593,
      "prompt_tokens" : 24123,
      "total_tokens" : 26716
    },
    "timings" : {
      "cache_n" : 527,
      "prompt_n" : 23596,
      "prompt_ms" : 17654.664,
      "prompt_per_token_ms" : 0.7482057975928124,
      "prompt_per_second" : 1336.5306754067933,
      "predicted_n" : 2593,
      "predicted_ms" : 31141.323,
      "predicted_per_token_ms" : 12.009765908214424,
      "predicted_per_second" : 83.2655696740951
    }
  }
}