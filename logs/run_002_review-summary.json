{
  "timestamp" : "2025-11-03T12:50:16.9891934",
  "index" : 2,
  "file" : "review-summary",
  "prompt" : {
    "role" : "user",
    "content" : "===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\configuration\\ThreadPoolTaskSchedulerConfig.java =====\n```\npackage com.hom.ebmw.configuration;\r\n\r\nimport org.springframework.context.annotation.Bean;\r\nimport org.springframework.context.annotation.Configuration;\r\nimport org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;\r\n\r\n@Configuration\r\npublic class ThreadPoolTaskSchedulerConfig {\r\n\r\n    /**\r\n     * The threadPoolTaskScheduler function creates a ThreadPoolTaskScheduler object, which is used to schedule tasks.\r\n     * The setPoolSize function sets the number of threads in the pool.\r\n     * The setThreadNamePrefix function sets the prefix for each thread name.\r\n     *\r\n     * @return A threadpooltaskscheduler\r\n     * @docauthor Trelent\r\n     */\r\n    @Bean\r\n    protected ThreadPoolTaskScheduler threadPoolTaskScheduler() {\r\n        ThreadPoolTaskScheduler threadPoolTaskScheduler = new ThreadPoolTaskScheduler();\r\n        threadPoolTaskScheduler.setPoolSize(5);\r\n        threadPoolTaskScheduler.setThreadNamePrefix(\"ThreadPoolTaskScheduler\");\r\n        return threadPoolTaskScheduler;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\configuration\\ThreadPoolTaskSchedulerConfig.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AccessDeniedException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class AccessDeniedException extends RuntimeException {\r\n    /**\r\n     *\r\n     */\r\n    public AccessDeniedException() {\r\n    }\r\n\r\n    /**\r\n     * @param message\r\n     */\r\n    public AccessDeniedException(String message) {\r\n        super(message);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AccessDeniedException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ArticleBaseQueueException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.Parse;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.SettingType;\r\n\r\nimport java.util.Optional;\r\n\r\npublic class ArticleBaseQueueException\r\n        extends\r\n        AstException {\r\n\r\n    private static final long serialVersionUID = -2628174058761644707L;\r\n\r\n    @Override\r\n    public String getLocalMessage(Context ctx) {\r\n        int timeOut = 1; //Default = 1\r\n        Optional<Setting> optSetting = ctx.getServices().getSettingCustomServices().findBySettingType(ctx, SettingType.ARTICLE_BASE_TIME_OUT);\r\n        if (optSetting.isPresent()) {\r\n            int buff = Parse.toInt(optSetting.get().getValue());\r\n            if (buff > 0) timeOut = buff;\r\n        }\r\n\r\n        String result = ctx.getServices().getTranslationService().getTranslation(TMS.ERROR_MSG_WAIT_N_HOURS, ctx.getSession().getLocale(ctx), ctx);\r\n\r\n        return String.format(result, timeOut);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ArticleBaseQueueException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AssortmentLockException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\npublic class AssortmentLockException\r\n        extends\r\n        Exception {\r\n\r\n    private static final long serialVersionUID = 266140856334335807L;\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AssortmentLockException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AstException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\n\r\npublic class AstException extends Exception {\r\n\r\n    private static final long serialVersionUID = -6931346327421724342L;\r\n\r\n    public String getLocalMessage(Context ctx) {\r\n\r\n        return ctx.getServices().getTranslationService().getTranslation(TMS.ERROR_MSG_BASE_FILE_NOT_EXISTS, ctx.getSession().getLocale(ctx), ctx);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AstException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AstFileNotExistsException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\n\r\npublic class AstFileNotExistsException extends Exception {\r\n\r\n    private static final long serialVersionUID = -2493224687198307940L;\r\n\r\n    @Override\r\n    public String getMessage() {\r\n        return TMS.ERROR_MSG_BASE_FILE_NOT_EXISTS;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\AstFileNotExistsException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ConvertException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class ConvertException extends Exception {\r\n\r\n    public ConvertException() {\r\n    }\r\n\r\n    public ConvertException(String message) {\r\n        super(message);\r\n    }\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ConvertException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\DoubleFoundException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.jpa.model.ArticleBase;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.enums.Params;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class DoubleFoundException\r\n        extends\r\n        Exception {\r\n    private String message;\r\n    private final List<String> articleNrs = new ArrayList<>();\r\n    private final Context ctx;\r\n\r\n    public DoubleFoundException(final Context ctx, List<ArticleBase> articles, String tms) {\r\n        this.ctx = ctx;\r\n        translate(tms);\r\n        message += \": \\n\";\r\n        for (ArticleBase item : articles) {\r\n            message = message.concat((message.isEmpty() ? \"\" : \", \") + \"'\" + item.getArticleNr() + \"'\");\r\n            articleNrs.add(item.getArticleNr());\r\n        }\r\n    }\r\n\r\n    private void translate(final String value) {\r\n        message = ctx.getServices().getTranslationService().getTranslation(value, ctx.getUserSession().get(Params.ACTIVE_LOCALE), ctx);\r\n    }\r\n\r\n    @Override\r\n    public final String getMessage() {\r\n        return message;\r\n    }\r\n\r\n    public List<String> getArticleNrs() {\r\n        return articleNrs;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\DoubleFoundException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\EntityNotFoundException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport lombok.AllArgsConstructor;\r\n\r\n@AllArgsConstructor\r\npublic class EntityNotFoundException extends Exception {\r\n\r\n    private static final long serialVersionUID = -4079322874347473651L;\r\n\r\n    private Class<?> clazz;\r\n\r\n    @Override\r\n    public String getMessage() {\r\n        return \"Entity \" + clazz.getSimpleName() + \" not Found\";\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\EntityNotFoundException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\FileCouldNotFoundException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class FileCouldNotFoundException extends java.io.FileNotFoundException {\r\n\r\n    public FileCouldNotFoundException() {\r\n    }\r\n\r\n    public FileCouldNotFoundException(String message) {\r\n        super(message);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\FileCouldNotFoundException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\FileEmptyException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class FileEmptyException extends Exception {\r\n\r\n    private String message = \"\";\r\n\r\n    public FileEmptyException(String message) {\r\n        this.message = message;\r\n    }\r\n\r\n    @Override\r\n    public String getLocalizedMessage() {\r\n        return message;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\FileEmptyException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ParameterException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\npublic class ParameterException extends Exception {\r\n\r\n    private static final long serialVersionUID = 4460269150225783168L;\r\n\r\n    private final String message;\r\n\r\n    public ParameterException(String message) {\r\n        this.message = message;\r\n    }\r\n\r\n    @Override\r\n    public String getMessage() {\r\n        return message;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ParameterException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ParamterNotValidException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\n\r\npublic class ParamterNotValidException\r\n        extends\r\n        Exception {\r\n\r\n    private static final long serialVersionUID = -5867770246563134724L;\r\n\r\n    @Override\r\n    public String getMessage() {\r\n        return TMS.ERROR_MSG_PARAMETER_NOT_VALID;\r\n    }\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ParamterNotValidException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\TokenNotValidException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\n\r\npublic class TokenNotValidException extends Exception {\r\n\r\n    private static final long serialVersionUID = -1201669337891811186L;\r\n\r\n    @Override\r\n    public String getMessage() {\r\n        return TMS.ERROR_MSG_TOKEN_NOT_VALID;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\TokenNotValidException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ZinfoToLongException.java =====\n```\npackage com.hom.ebmw.exceptions;\r\n\r\nimport com.hom.ebmw.jpa.model.Zinfo;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class ZinfoToLongException extends Exception {\r\n    private final String message;\r\n    private final List<String> items = new ArrayList<String>();\r\n\r\n    public ZinfoToLongException(List<Zinfo> items) {\r\n        String message = \"\";\r\n        for (Zinfo item : items) {\r\n            message += (message.isEmpty() ? \"\" : \", \") + \"'\" + item.getArticleNr() + \"'\";\r\n            this.items.add(item.getArticleNr());\r\n        }\r\n        this.message = message;\r\n    }\r\n\r\n    @Override\r\n    public String getMessage() {\r\n        return message;\r\n    }\r\n\r\n    public List<String> getZinfos() {\r\n        return items;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\exceptions\\ZinfoToLongException.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\graph\\model\\GraphUser.java =====\n```\npackage com.hom.ebmw.graph.model;\r\n\r\nimport lombok.Data;\r\n\r\nimport java.io.Serializable;\r\n\r\n\r\n@Data\r\npublic class GraphUser implements Serializable {\r\n\r\n    private static final long serialVersionUID = 6448057781128073500L;\r\n\r\n    private String id;\r\n    private String mail;\r\n    private String surname;\r\n    private String givenname;\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\graph\\model\\GraphUser.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\graph\\service\\MSgraphService.java =====\n```\npackage com.hom.ebmw.graph.service;\r\n\r\nimport com.hom.ebmw.configuration.ApplicationProperty;\r\nimport com.hom.ebmw.configuration.security.GraphAuthenticationProvider;\r\nimport com.hom.ebmw.exceptions.TokenNotValidException;\r\nimport com.hom.ebmw.graph.model.GraphUser;\r\nimport com.microsoft.graph.models.Group;\r\nimport com.microsoft.graph.models.User;\r\nimport com.microsoft.graph.requests.DirectoryObjectCollectionWithReferencesPage;\r\nimport com.microsoft.graph.requests.GraphServiceClient;\r\nimport com.microsoft.graph.requests.GroupCollectionPage;\r\nimport com.microsoft.graph.requests.UserCollectionPage;\r\nimport com.vaadin.flow.server.VaadinService;\r\nimport lombok.extern.slf4j.Slf4j;\r\nimport okhttp3.Request;\r\nimport org.springframework.security.core.context.SecurityContextHolder;\r\nimport org.springframework.security.oauth2.client.OAuth2AuthorizedClient;\r\nimport org.springframework.security.oauth2.client.authentication.OAuth2AuthenticationToken;\r\nimport org.springframework.security.oauth2.client.web.OAuth2AuthorizedClientRepository;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport javax.servlet.http.HttpServletRequest;\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\n\r\n@Slf4j\r\n@Service\r\npublic class MSgraphService {\r\n\r\n    private final OAuth2AuthorizedClientRepository oAuth2AuthorizedClientRepository;\r\n\r\n    private final ApplicationProperty appProperty;\r\n\r\n\r\n    /**\r\n     * The MSgraphService function is a function that allows the user to access their Microsoft Graph account.\r\n     *\r\n     * @param OAuth2AuthorizedClientRepository oAuth2AuthorizedClientRepository Get the access token from the session\r\n     * @param ApplicationProperty              appProperty Get the application properties from the application\r\n     * @return A new msgraphservice object\r\n     * @docauthor Trelent\r\n     */\r\n    public MSgraphService(OAuth2AuthorizedClientRepository oAuth2AuthorizedClientRepository, ApplicationProperty appProperty) {\r\n        this.oAuth2AuthorizedClientRepository = oAuth2AuthorizedClientRepository;\r\n        this.appProperty = appProperty;\r\n    }\r\n\r\n    /**\r\n     * The getMe function is used to retrieve the current user's information from Microsoft Graph.\r\n     *\r\n     * @return A graphuser object with the following fields:\r\n     * @docauthor Trelent\r\n     */\r\n    public GraphUser getMe() throws NullPointerException {\r\n        GraphUser graphUser = new GraphUser();\r\n        GraphServiceClient<Request> client = getGraphServiceClient();\r\n\r\n        log.debug(client.me().buildRequest().get().givenName);\r\n\r\n        User user = client.me().buildRequest().get();\r\n        graphUser.setId(user.id);\r\n        graphUser.setGivenname(user.givenName);\r\n        graphUser.setSurname(user.surname);\r\n        graphUser.setMail(user.mail);\r\n\r\n        return graphUser;\r\n    }\r\n\r\n    /**\r\n     * The getUsersByFilter function is used to retrieve a list of users from the Microsoft Graph API.\r\n     * The function takes in a String filter, which is used to filter the results returned by the API.\r\n     * For example, if you wanted to return all users with an email address that contains &quot;example&quot;,\r\n     * you would pass in &quot;mail eq '*example*'&quot;. If no filter was passed into this function, it would return all users.\r\n     *\r\n     * @param String filter Filter the results of the query\r\n     * @return A list of graphuser objects\r\n     * @docauthor Trelent\r\n     */\r\n    public List<GraphUser> getUsersByFilter(String filter) throws NullPointerException {\r\n        List<GraphUser> graphUsers = new ArrayList<>();\r\n        try {\r\n            if (filter.length() > 0) {\r\n                GraphServiceClient<Request> client = getGraphServiceClient();\r\n\r\n                UserCollectionPage users = client.users().buildRequest().filter(filter).get();\r\n\r\n                users.getCurrentPage().forEach(user -> {\r\n                    GraphUser gUser = new GraphUser();\r\n                    gUser.setId(user.id);\r\n                    gUser.setGivenname(user.givenName);\r\n                    gUser.setSurname(user.surname);\r\n                    gUser.setMail(user.mail);\r\n                    graphUsers.add(gUser);\r\n                });\r\n            }\r\n        } catch (IllegalArgumentException e) {\r\n            log.error(e.getLocalizedMessage());\r\n        }\r\n\r\n        return graphUsers;\r\n    }\r\n\r\n    /**\r\n     * The getGroupId function takes a group name as input and returns the corresponding group ID.\r\n     *\r\n     * @param String groupName Filter the groups by name\r\n     * @return The group id of the group with a given name\r\n     * @docauthor Trelent\r\n     */\r\n    public String getGroupId(String groupName) {\r\n        String groupId = \"\";\r\n\r\n        GraphServiceClient<Request> client = getGraphServiceClient();\r\n        try {\r\n            GroupCollectionPage collection = client.groups().buildRequest().count()\r\n                    .filter(\"startswith(displayName,'\" + groupName + \"')\").select(\"id\").get();\r\n            if (!collection.getCurrentPage().isEmpty()) {\r\n                Group group = collection.getCurrentPage().get(0);\r\n                groupId = group.id;\r\n            }\r\n        } catch (Exception e) {\r\n            log.error(e.getMessage(), e);\r\n        }\r\n\r\n        return groupId;\r\n    }\r\n\r\n    /**\r\n     * The isCurrentUserMemberOf function checks to see if the current user is a member of the group specified by groupId.\r\n     *\r\n     * @param String groupId Identify the group that you want to check if the user is a member of\r\n     * @return A boolean value that is true if the current user is a member of the group, and false otherwise\r\n     * @docauthor Trelent\r\n     */\r\n    public boolean isCurrentUserMemberOf(String groupId) {\r\n        boolean result = false;\r\n\r\n        try {\r\n            OAuth2AuthenticationToken token = getActiveToken();\r\n\r\n            String userId = token.getPrincipal().getAttribute(\"oid\");\r\n\r\n            GraphServiceClient<Request> client = getGraphServiceClient();\r\n            DirectoryObjectCollectionWithReferencesPage objectCollection = client.groups(groupId).members()\r\n                    .buildRequest().filter(\"id eq '\" + userId + \"'\").get();\r\n            result = !objectCollection.getCurrentPage().isEmpty();\r\n\r\n        } catch (Exception e) {\r\n            log.error(e.getMessage(), e);\r\n            result = false;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The hasGroup function checks to see if the user is a member of the group specified in application.properties\r\n     *\r\n     * @return True if the current user is a member of the specified group\r\n     * @docauthor Trelent\r\n     */\r\n    public boolean hasGroup() {\r\n\r\n        String group = appProperty.getSpecificGroup();\r\n\r\n        if (Objects.isNull(group) || group.isEmpty()) {\r\n            return true;\r\n        }\r\n\r\n        String groupId = getGroupId(group);\r\n\r\n        if (!groupId.isEmpty()) {\r\n            return isCurrentUserMemberOf(groupId);\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * The getUsersBySurNameAndGiveName function takes in a surname and givename as parameters,\r\n     * and returns a list of GraphUser objects that match the search criteria.\r\n     *\r\n     * @param String surname Filter the users by surname\r\n     * @param String givename Filter the users by their given name\r\n     * @return A list of users\r\n     * @docauthor Trelent\r\n     */\r\n    public List<GraphUser> getUsersBySurNameAndGiveName(String surname, String givename) throws NullPointerException {\r\n\r\n        String fSurName = \"startswith(surname,'\" + surname + \"')\";\r\n        String fgivenName = \"startswith(givenName,'\" + givename + \"')\";\r\n        String fOr = \" or \";\r\n\r\n        List<String> filters = new ArrayList<>();\r\n        if (!surname.isEmpty()) {\r\n            filters.add(fSurName);\r\n        }\r\n        if (!filters.isEmpty()) {\r\n            filters.add(fOr);\r\n        }\r\n        if (!givename.isEmpty()) {\r\n            filters.add(fgivenName);\r\n        }\r\n\r\n        StringBuilder sb = new StringBuilder();\r\n        filters.forEach(sb::append);\r\n\r\n        List<GraphUser> users = new ArrayList<>();\r\n        users = getUsersByFilter(sb.toString());\r\n\r\n        return users;\r\n    }\r\n\r\n    /**\r\n     * The getUsersById function takes in a String of user IDs and returns a list of GraphUser objects.\r\n     *\r\n     * @param String id Filter the results of the getusersbyid function\r\n     * @return A list of graphuser objects\r\n     * @docauthor Trelent\r\n     */\r\n    public List<GraphUser> getUsersById(String id) throws NullPointerException {\r\n\r\n        List<GraphUser> users = new ArrayList<>();\r\n        final StringBuilder buff = new StringBuilder();\r\n        String filter = \"\";\r\n        id = id.replace(\"[\", \"\").replace(\"]\", \"\");\r\n\r\n        if (id.length() > 0) {\r\n            if (id.contains(\",\")) {\r\n                List<String> ids = Arrays.asList(id.split(\",\"));\r\n                ids.forEach(userId -> {\r\n                    if (buff.length() > 0) {\r\n                        buff.append(\" or \");\r\n                    }\r\n                    buff.append(\"id eq '\" + userId.trim() + \"'\");\r\n                });\r\n                filter = buff.toString();\r\n\r\n            } else {\r\n                filter = \"id eq \" + id.trim() + \"'\";\r\n            }\r\n\r\n            users = getUsersByFilter(filter);\r\n        }\r\n\r\n        return users;\r\n    }\r\n\r\n    private OAuth2AuthenticationToken getActiveToken() throws TokenNotValidException {\r\n\r\n        OAuth2AuthenticationToken token;\r\n        try {\r\n            token = (OAuth2AuthenticationToken) SecurityContextHolder.getContext().getAuthentication();\r\n        } catch (ClassCastException e) {\r\n            throw new TokenNotValidException();\r\n        }\r\n        return token;\r\n    }\r\n\r\n    public GraphServiceClient<Request> getGraphServiceClient() {\r\n        try {\r\n            OAuth2AuthenticationToken token = getActiveToken();\r\n\r\n            if (token == null)\r\n                throw new TokenNotValidException();\r\n\r\n            OAuth2AuthorizedClient authorizedClient = this.oAuth2AuthorizedClientRepository.loadAuthorizedClient(\r\n                    token.getAuthorizedClientRegistrationId(), SecurityContextHolder.getContext().getAuthentication(),\r\n                    (HttpServletRequest) VaadinService.getCurrentRequest());\r\n\r\n            return GraphServiceClient.builder()\r\n                    .authenticationProvider(new GraphAuthenticationProvider(authorizedClient)).buildClient();\r\n        } catch (TokenNotValidException e) {\r\n            log.error(e.getMessage(), e);\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\graph\\service\\MSgraphService.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\AssignedMaterial.java =====\n```\npackage com.hom.ebmw.ipim.model;\r\n\r\npublic class AssignedMaterial extends Enumerator {\r\n    private static final long serialVersionUID = -6876087336142053120L;\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\AssignedMaterial.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\cons\\FilterType.java =====\n```\npackage com.hom.ebmw.ipim.model.cons;\r\n\r\nimport com.hom.ebmw.utilities.enums.PlannedType;\r\n\r\npublic interface FilterType {\r\n\r\n    /**\r\n     * Material Zuordnung\r\n     */\r\n    String ASSIGMEND = PlannedType.ZUORDNUNG_MATERIAL.name();\r\n\r\n    /**\r\n     * Artikel in PIM\r\n     */\r\n    String INPIM = \"IN_PIM\";\r\n\r\n    /**\r\n     * Freigabe durch P\r\n     */\r\n    String APPROVAL = \"APPROVAL\";\r\n\r\n    /**\r\n     * Artikel in Structure-?\r\n     */\r\n    String STRUCTURE = \"STRUCTURE-\";\r\n\r\n    /**\r\n     * Sperrland\r\n     */\r\n    String COUNTRYLOCK = \"COUNTRYLOCK\";\r\n\r\n    /**\r\n     * InfoType\r\n     */\r\n    String INFOTYPE = PlannedType.INFOTYPE.name();\r\n\r\n    /**\r\n     * GHS-Codes\r\n     */\r\n    String GHSCODES = \"GHSCODES\";\r\n\r\n    /**\r\n     * Artikelklasse\r\n     */\r\n    String ARTICLECLASS = PlannedType.ARTIKELKLASSE.name();\r\n\r\n    /**\r\n     * EigenMarke, Herstellermarke\r\n     */\r\n    String BRAND = \"BRAND\";\r\n\r\n    /**\r\n     *\r\n     */\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\cons\\FilterType.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Currency.java =====\n```\npackage com.hom.ebmw.ipim.model;\r\n\r\npublic class Currency extends Enumerator {\r\n    private static final long serialVersionUID = 3493932869647982645L;\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Currency.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Enumerator.java =====\n```\npackage com.hom.ebmw.ipim.model;\r\n\r\nimport lombok.Data;\r\n\r\nimport java.io.Serializable;\r\n\r\n@Data\r\npublic class Enumerator implements Serializable {\r\n\r\n    private static final long serialVersionUID = 6909939225265908989L;\r\n\r\n    private String label = \"\";\r\n    private String key = \"\";\r\n    private String externalCode = \"\";\r\n    private String[] synonyms;\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Enumerator.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Language.java =====\n```\npackage com.hom.ebmw.ipim.model;\r\n\r\npublic class Language extends Enumerator {\r\n    private static final long serialVersionUID = -1276530706621342554L;\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Language.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Territory.java =====\n```\npackage com.hom.ebmw.ipim.model;\r\n\r\npublic class Territory extends Enumerator {\r\n    private static final long serialVersionUID = -155595549275442155L;\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\model\\Territory.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\service\\EnumerationService.java =====\n```\npackage com.hom.ebmw.ipim.service;\r\n\r\nimport com.heiler.pim.webservice.client.RestClient;\r\nimport com.heiler.pim.webservice.client.enumeration.Enumeration;\r\nimport com.heiler.pim.webservice.client.enumeration.EnumerationEntry;\r\nimport com.heiler.pim.webservice.client.enumeration.EnumerationRequest;\r\nimport com.hom.ebmw.configuration.PIMRestManager;\r\nimport com.hom.ebmw.ipim.model.*;\r\nimport com.hom.ebmw.utilities.Parse;\r\nimport org.springframework.stereotype.Component;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Comparator;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\n\r\n@Component\r\npublic class EnumerationService {\r\n\r\n    private final PIMRestManager restMgr;\r\n\r\n    public EnumerationService(PIMRestManager restMgr) {\r\n        this.restMgr = restMgr;\r\n    }\r\n\r\n    /**\r\n     * The getAllEnumerationOfType function is used to retrieve all of the enumerations of a given type.\r\n     *\r\n     * @param String type Determine which enumeration to get\r\n     * @return A list of enumerator objects\r\n     */\r\n    public List<Enumerator> getAllEnumerationOfType(String type) {\r\n        List<Enumerator> enums = new ArrayList<>();\r\n\r\n        RestClient restClient = restMgr.getBasicClient();\r\n\r\n        EnumerationRequest enumRequest = restClient.createEnumerationRequest();\r\n\r\n        Enumeration enumeration = enumRequest.getEnumeration(\"Enum.\" + type);\r\n\r\n        List<EnumerationEntry> enumEntries = enumeration.getEntries();\r\n\r\n        for (EnumerationEntry row : enumEntries) {\r\n            final Enumerator e = new Enumerator();\r\n            e.setExternalCode(row.getExternalCode());\r\n            e.setKey(Parse.toString(row.getKey()));\r\n            e.setLabel(row.getLabel());\r\n\r\n            String[] dummy = new String[row.getSynonyms().size()];\r\n            for (int i = 0; i < dummy.length; i++) {\r\n                dummy[i] = row.getSynonyms().get(i);\r\n            }\r\n            e.setSynonyms(dummy);\r\n            enums.add(e);\r\n        }\r\n\r\n        return enums;\r\n    }\r\n\r\n    /**\r\n     * The getAllLanguages function returns a list of all languages that are available in the system.\r\n     * The function first creates an empty HashMap called map, which will be used to store the language objects.\r\n     * Next, it gets a list of all enumerations with type &quot;Language&quot; from the database and removes any unwanted items from this list (such as world or en-US).\r\n     * Then, for each item in this new filtered enumeration list, it adds an entry to our map using its external code as key and converts it into a Language object using convert().\r\n     * Finally, we create a new ArrayList containing only values from our\r\n     *\r\n     * @return A list of languages\r\n     */\r\n    public List<Language> getAllLanguages() {\r\n        HashMap<String, Language> map = new HashMap<>();\r\n        List<Enumerator> enums = getAllEnumerationOfType(\"Language\");\r\n        enums.removeIf(item -> item.getKey().equals(\"-1\")); // world\r\n        enums.removeIf(item -> item.getKey().equals(\"1033\")); // en-US\r\n        enums.removeIf(item -> item.getKey().equals(\"2058\")); // spa-MX\r\n        enums.forEach(item -> map.put(item.getExternalCode().split(\"-\")[0], convert(item, new Language())));\r\n        List<Language> languages = new ArrayList<>(map.values());\r\n\r\n        languages.sort(Comparator.comparing(Enumerator::getExternalCode));\r\n        return languages;\r\n    }\r\n\r\n    /**\r\n     * The getAllTerritories function returns a list of all the territories in the game.\r\n     *\r\n     * @return A list of all territories\r\n     */\r\n    public List<Territory> getAllTerritories() {\r\n        List<Territory> territories = new ArrayList<>();\r\n        getAllEnumerationOfType(\"Territory\").forEach(item -> territories.add(convert(item, new Territory())));\r\n        territories.sort(Comparator.comparing(Enumerator::getKey));\r\n        return territories;\r\n    }\r\n\r\n    /**\r\n     * The getAllCurrencies function returns a list of all the currencies in the database.\r\n     *\r\n     * @return A list of all the currencies that are in the database\r\n     */\r\n    public List<Currency> getAllCurrencies() {\r\n        List<Currency> currencies = new ArrayList<>();\r\n        getAllEnumerationOfType(\"Currency\").forEach(item -> currencies.add(convert(item, new Currency())));\r\n        currencies.sort(Comparator.comparing(Enumerator::getKey));\r\n        return currencies;\r\n    }\r\n\r\n    /**\r\n     * The getAllAssignedMaterials function returns a list of all the AssignedMaterials in the database.\r\n     *\r\n     * @return A list of all the assignedmaterial enumerations\r\n     */\r\n    public List<AssignedMaterial> getAllAssignedMaterials() {\r\n        List<AssignedMaterial> materials = new ArrayList<>();\r\n        getAllEnumerationOfType(\"HOAssignedMaterial\").forEach(item -> materials.add(convert(item, new AssignedMaterial())));\r\n        materials.sort(Comparator.comparing(Enumerator::getKey));\r\n        return materials;\r\n    }\r\n\r\n    /**\r\n     * The convert function takes an Enumerator object and converts it to a new\r\n     * enumerator object of type E. The function is generic, so the type of the\r\n     * returned enumerator can be specified when calling convert. This allows for\r\n     * conversion between different types of enumerators (e.g., from a CodedEnum to\r\n     * an Enum). The function also sets all fields in the new enum equal to those in\r\n     * the old one, so that no information is lost during conversion.  \t\t\t   &lt;br&gt; &lt;br&gt;\r\n     *\r\n     * @param Enumerator item Pass in the enumerator object that is to be converted\r\n     * @param E          obj Return the converted object\r\n     * @return A new object of the same type as the argument obj\r\n     */\r\n    private <E extends Enumerator> E convert(Enumerator item, E obj) {\r\n        obj.setExternalCode(item.getExternalCode());\r\n        obj.setKey(item.getKey());\r\n        obj.setLabel(item.getLabel());\r\n        obj.setSynonyms(item.getSynonyms());\r\n        return obj;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\service\\EnumerationService.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\service\\IPIMService.java =====\n```\npackage com.hom.ebmw.ipim.service;\r\n\r\nimport com.heiler.pim.webservice.client.EntityItemReference;\r\nimport com.heiler.pim.webservice.client.RestClient;\r\nimport com.heiler.pim.webservice.client.RestClientException;\r\nimport com.heiler.pim.webservice.client.list.EntityItemTable;\r\nimport com.heiler.pim.webservice.client.list.EntityItemTableRow;\r\nimport com.heiler.pim.webservice.client.list.ListReadRequest;\r\nimport com.heiler.pim.webservice.client.list.ReportQuery;\r\nimport com.hom.ebmw.configuration.PIMRestManager;\r\nimport com.hom.ebmw.ipim.model.Language;\r\nimport com.hom.ebmw.jpa.dao.FilterBaseDAO;\r\nimport com.hom.ebmw.jpa.model.ArticleBase;\r\nimport com.hom.ebmw.jpa.model.Filterbase;\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.utilities.InternalUtils;\r\nimport com.hom.ebmw.utilities.Parse;\r\nimport com.hom.ebmw.utilities.enums.FilterType;\r\nimport com.hom.ebmw.utilities.enums.PlannedType;\r\nimport com.hom.ebmw.utilities.enums.SettingType;\r\nimport org.springframework.stereotype.Service;\r\n\r\nimport java.util.*;\r\n\r\nimport static com.hom.ebmw.utilities.constans.ASTConst.IPIM_DELIMITER;\r\n\r\n@Service\r\npublic class IPIMService {\r\n\r\n    private final PIMRestManager restMgr;\r\n\r\n    private final FilterBaseDAO daoService;\r\n\r\n    /**\r\n     * The IPIMService function is used to retrieve the IPIM data from the PIM API.\r\n     * The function takes in a String of an IP address and returns a JSONObject containing all of the information about that IP address.\r\n     *\r\n     * @param PIMRestManager restMgr Access the pimrestmanager class\r\n     * @param FilterBaseDAO  daoService Access the database\r\n     * @return A pimrestmanager and a filterbasedao\r\n     */\r\n    public IPIMService(PIMRestManager restMgr, FilterBaseDAO daoService) {\r\n        this.restMgr = restMgr;\r\n        this.daoService = daoService;\r\n    }\r\n\r\n    /**\r\n     * The getArticleInPIMbyArticleNr function takes a list of ArticleBase objects and a territory as parameters.\r\n     * It then splits the list into parts of 2000 elements each, because that is the maximum number of elements\r\n     * that can be passed to PIM at once. Then it loops through all these lists and for each one creates an articleNr string,\r\n     * which contains all article numbers in this part separated by commas. If there are no articles in this part (which should not happen),\r\n     * it skips to the next part. Otherwise, it creates a parameter string containing &quot;Article.SupplierAID in (&quot; + articles +\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get a list of articles from the database\r\n     * @param String                  territory Get the correct language for the article name\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleInPIMbyArticleNr(List<ArticleBase> articleBase, String territory)\r\n            throws RestClientException {\r\n        List<Filterbase> result = new ArrayList<>();\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest\r\n                        .setFields(\"Article.SupplierAID, ArticleLang.ArticleName(\" + territory + \")\").setPageSize(-1)\r\n                        .setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    fObj.setLabel(Parse.toString(values.get(1)));\r\n                    result.add(fObj);\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListInPIMbyArticleNr function takes a list of articleBase objects and a territory as input.\r\n     * It then calls the getArticleInPIMbyArticleNr function, which returns a list of PIM articles that match the\r\n     * articleBase objects in the input list. The getArticleListInPIMbyArticleNr function then iterates through this\r\n     * returned list and adds each PIM article's identifier to its own result List&lt;String&gt;. This result is returned by\r\n     * the function at completion.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article number from\r\n     * @param String                  territory Filter the articles by territory\r\n     * @return A list of article numbers\r\n     */\r\n    public List<String> getArticleListInPIMbyArticleNr(List<ArticleBase> articleBase, String territory)\r\n            throws RestClientException {\r\n        final List<String> result = new ArrayList<>();\r\n        getArticleInPIMbyArticleNr(articleBase, territory).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleNotInPIMbyArticleNr function takes a list of ArticleBase objects and a territory as parameters.\r\n     * It then splits the list into parts of 2000 items each, and for each part it creates an article string containing all the articles in that part.\r\n     * If this article string is not empty, it creates a report query with the parameter &quot;Article.SupplierAID in (articleString)&quot;.\r\n     * Then it uses this report query to create a ListReadRequest object which returns all articles matching these criteria from PIM.\r\n     * The function then iterates through these results and adds them to foundList if they are present in PIM,\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the articlenr from the articlebase object\r\n     * @param String                  territory Get the name of the article in a specific language\r\n     * @return A list of articles that are not in pim\r\n     */\r\n    public List<Filterbase> getArticleNotInPIMbyArticleNr(List<ArticleBase> articleBase, String territory)\r\n            throws RestClientException {\r\n        List<Filterbase> result = new ArrayList<>();\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest\r\n                        .setFields(\"Article.SupplierAID, ArticleLang.ArticleName(\" + territory + \")\").setPageSize(-1)\r\n                        .setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n                List<String> found = new ArrayList<>();\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    found.add(Parse.toString(values.get(0)));\r\n                }\r\n                articleList.get(i).forEach(item -> {\r\n                    if (!found.contains(item.getArticleNr())) {\r\n                        Filterbase fObj = new Filterbase();\r\n                        fObj.setIdentifier(item.getArticleNr());\r\n                        result.add(fObj);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListNotInPIMbyArticleNr function takes a list of ArticleBase objects and a territory as parameters.\r\n     * It then calls the getArticleNotInPIMbyArticleNr function, which returns a list of ArticleBase objects that are not in PIM.\r\n     * The getArticleListNotInPIMbyArticleNr function then iterates through this returned list and adds each article's identifier to the result List&lt;String&gt;.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article number from each articlebase object in the list\r\n     * @param String                  territory Get the list of articles that are not in pim for a particular territory\r\n     * @return A list of article numbers that are not in the pim\r\n     */\r\n    public List<String> getArticleListNotInPIMbyArticleNr(List<ArticleBase> articleBase, String territory)\r\n            throws RestClientException {\r\n        final List<String> result = new ArrayList<>();\r\n        getArticleNotInPIMbyArticleNr(articleBase, territory).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByCountryLock function is used to retrieve a list of articles that are locked for a specific country.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article numbers\r\n     * @param String                  territory Determine the country for which the article is locked\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByCountryLock(List<ArticleBase> articleBase, String territory)\r\n            throws RestClientException {\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles\r\n                        + \") and ArticleBlockedCountries.Locked = true\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest\r\n                        .setFields(\"Article.SupplierAID,ArticleBlockedCountries.Country(\" + territory + \")\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    fObj.setLabel(Parse.toString(values.get(1)));\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.STRUCTURE.name()\r\n                            + IPIM_DELIMITER + territory);\r\n                    fObj.setLabel(FilterType.COUNTRY_LOCK.name() + IPIM_DELIMITER + territory);\r\n                    if (!Parse.toString(values.get(1)).isEmpty()) {\r\n                        cached.add(fObj);\r\n                    }\r\n                }\r\n                result.addAll(cached);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByCountryLock function takes in a list of ArticleBase objects and a territory string,\r\n     * and returns a list of strings containing the identifiers for all articles that are locked to the given territory.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the list of articles that are locked in a specific country\r\n     * @param String                  territory Filter the list of articles by country\r\n     * @return The list of articles that have the same territory as the one passed in parameter\r\n     */\r\n    public List<String> getAllArticleByCountryLock(List<ArticleBase> articleBase, String territory)\r\n            throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByCountryLock(articleBase, territory).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByStructure function is used to retrieve the structure group of a given article.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Filter the result\r\n     * @param String                  catalogStructure Determine the structure group to be used\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByStructure(List<ArticleBase> articleBase, String catalogStructure)\r\n            throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID,\r\n         * ArticleCatalogStructureMap.StructureGroup(eCat) &orderBy &formatData=false\r\n         * &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest.setFields(\r\n                                \"Article.SupplierAID, ArticleCatalogStructureMap.StructureGroup(\" + catalogStructure + \")\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n//\t\t\t\t\tfObj.setIdentifier(Parse.toString((values.get( 0 )));\r\n                    fObj.setLabel(Parse.toString(values.get(1)));\r\n//\t\t\t\t\tfObj.setStructureGroupId(row.getObject().getId());\r\n                    fObj.setEntityIdentifier(Parse.toString(values.get(0)) + IPIM_DELIMITER\r\n                            + FilterType.STRUCTURE_ARTICLE.name() + IPIM_DELIMITER + catalogStructure);\r\n                    fObj.setType(FilterType.STRUCTURE_ARTICLE.name() + IPIM_DELIMITER + catalogStructure);\r\n                    cached.add(fObj);\r\n                }\r\n                result.addAll(cached);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByStructure function takes in a list of ArticleBase objects and a string representing the catalog structure.\r\n     * It then returns a list of strings that represent the identifiers for all articles within the given catalog structure.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Pass the list of articles to be filtered\r\n     * @param String                  catalogStructure Identify the catalog structure that we want to get all articles from\r\n     * @return A list of articlebase objects that have the specified catalogstructure\r\n     */\r\n    public List<String> getAllArticleByStructure(List<ArticleBase> articleBase, String catalogStructure)\r\n            throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByStructure(articleBase, catalogStructure).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByAssigmend function takes a list of ArticleBase objects and returns a list of Filterbase objects.\r\n     * The function uses the getArticleListByValue function to return the Filterbase object, which is then added to the\r\n     * returned List&lt;Filterbase&gt; object.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the supplieraid from the articlebase object\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByAssigmend(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID,\r\n         * ArticleLogistic.AssignedMaterial(DE),\r\n         * ArticlePlannedChangesSAP.PlannedChange(DE, 2020-08-01, 4) &formatData=false\r\n         * &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n        return getArticleListByValue(articleBase, \"ArticleLogistic.AssignedMaterial(DE)\",\r\n                PlannedType.ZUORDNUNG_MATERIAL);\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByAssigmend function takes a list of ArticleBase objects and returns a list of strings.\r\n     * The function iterates through the articleBase object, calling the getArticleListByAssigmend function on each element in the articleBase object.\r\n     * It then adds each element's identifier to result, which is returned at the end of this function.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the articlebase list\r\n     *                                public list&lt;articlebase&gt; getarticlelistbyassigmend(list&lt;articlebase&gt; articlebase) throws restclientexception {\r\n     *                                <p>\r\n     *                                return articleservice\r\n     * @return A list of article identifiers\r\n     */\r\n    public List<String> getAllArticleByAssigmend(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByAssigmend(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByNotApproval function is used to get a list of articles that are not approved.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article number\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByNotApproval(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID, Article.CurrentStatus\r\n         * &formatData=false &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest.setFields(\"Article.SupplierAID, Article.CurrentStatus\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    String current = Parse.toString(values.get(1)); // Freigegeben\r\n                    fObj.setLabel(current);\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.NOTAPPROVAL.name());\r\n                    fObj.setType(FilterType.NOTAPPROVAL);\r\n                    if (!current.equals(\"Freigegeben\") && !current.isEmpty()) {\r\n                        result.add(fObj);\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByNotApproval function returns a list of all article identifiers that have not been approved.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get a list of articles that are not approved\r\n     * @return A list of article identifiers\r\n     */\r\n    public List<String> getAllArticleByNotApproval(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByNotApproval(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByGHSCode function is used to retrieve the GHS codes for a list of articles.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article numbers\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByGHSCode(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID, Article.CurrentStatus\r\n         * &formatData=false &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest.setFields(\"Article.SupplierAID,Article.GHSCode\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    String[] current = (String[]) values.get(1); // Freigegeben\r\n\r\n                    if (current[0] != \"\") {\r\n                        String value = \"\";\r\n                        for (int k = 0; k < current.length; k++) {\r\n                            value += (value.length() > 0 ? \",\" : \"\") + current[i];\r\n                        }\r\n\r\n                        fObj.setLabel(value);\r\n                        fObj.setEntityIdentifier(\r\n                                row.getObject().getId() + IPIM_DELIMITER + FilterType.GHS_CODES.name());\r\n                        fObj.setType(FilterType.GHS_CODES);\r\n                        cached.add(fObj);\r\n                    }\r\n                }\r\n                result.addAll(cached);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByGHSCode function takes a list of ArticleBase objects and returns a list of strings.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Pass the list of articles to be searched\r\n     *                                private list&lt;articlebase&gt; getarticlelistbyghscode(list&lt;articlebase&gt; articlebase) {\r\n     *                                return articlebase\r\n     * @return A list of article identifiers\r\n     */\r\n    public List<String> getAllArticleByGHSCode(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByGHSCode(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByUnfrei function is used to retrieve the article list by unfrei.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article numbers\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByUnfrei(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID, Article.CurrentStatus\r\n         * &formatData=false &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest\r\n                        .setFields(\"Article.SupplierAID,ArticleLogistic.NotFree(DE)\").setPageSize(-1).setStartIndex(0)\r\n                        .getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    String current = Parse.toString(values.get(1)); // Freigegeben\r\n                    fObj.setLabel(current);\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.NOTFREE.name());\r\n                    fObj.setType(FilterType.NOTFREE);\r\n                    cached.add(fObj);\r\n                }\r\n                result.addAll(cached);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByUnfrei function takes a list of ArticleBase objects and returns a list of strings.\r\n     * The function iterates through the articleBase object, calling getArticleListByUnfrei on each element in the list.\r\n     * It then adds each identifier to an empty string arraylist called result, which is returned at the end of the function.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the list of articles that are unfrei\r\n     * @return A list of article identifiers\r\n     */\r\n    public List<String> getAllArticleByUnfrei(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByUnfrei(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByIntraStat function is used to determine whether or not a given article has Intrastat data.\r\n     * The function takes in a list of ArticleBase objects, and returns a list of Filterbase objects.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article numbers of all articles that are to be checked for intrastat\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByIntraStat(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest.setFields(\r\n                                \"Article.SupplierAID, ArticleLogistic.HONetWeight(DE), ArticleLogistic.GrossWeight(DE), ArticleLogistic.CustomsTariffNumber(DE)\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n\r\n                    // Default Germany\r\n                    String netto = Parse.toString(values.get(1)); // Netto Gewicht\r\n                    String brutto = Parse.toString(values.get(2)); // Brutto Gewicht\r\n                    String number = Parse.toString(values.get(3)); // Zolltarifnummer\r\n\r\n                    if (netto.isEmpty() && brutto.isEmpty() && number.isEmpty()) {\r\n                        fObj.setLabel(\"no.intrastat\");\r\n                    } else {\r\n                        fObj.setLabel(\"intrastat\");\r\n                    }\r\n\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.INTRASTAT.name());\r\n                    fObj.setType(FilterType.INTRASTAT);\r\n                    cached.add(fObj);\r\n                }\r\n                result.addAll(cached);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByIntraStat function takes a list of ArticleBase objects and returns a list of strings.\r\n     * The function iterates through the articleBase parameter, which is a List&lt;ArticleBase&gt; object, and adds each Article's identifier to the result variable.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the list of articles\r\n     *                                private list&lt;articlebase&gt; getarticlelistbyintrastat(list&lt;articlebase&gt; articlebase) throws restclientexception {\r\n     *                                return articlerepository\r\n     * @return A list of articles that have the same intrastat code\r\n     */\r\n    public List<String> getAllArticleByIntraStat(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByIntraStat(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByInfoType function takes a list of ArticleBase objects and returns a list of Filterbase objects.\r\n     * The function uses the getArticleListByValue function to return the desired information from SAP.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the supplieraid from the articlebase object\r\n     * @return The following:\r\n     */\r\n    public List<Filterbase> getArticleListByInfoType(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID, ArticleLogistic.InfoType(DE),\r\n         * ArticlePlannedChangesSAP.PlannedChange(DE, 2020-08-01, 4) &formatData=false\r\n         * &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n\r\n        return getArticleListByValue(articleBase, \"ArticleLogistic.InfoType(DE)\", PlannedType.INFOTYPE);\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByInfoType function takes a list of ArticleBase objects and returns a list of strings.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the list of articles from the database\r\n     * @return A list of strings\r\n     */\r\n    public List<String> getAllArticleByInfoType(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByInfoType(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByArticleClass function takes a list of ArticleBase objects and returns a list of Filterbase objects.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Pass the list of articlebase objects to be used in the query\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByArticleClass(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID,\r\n         * ArticleLogistic.AssignedMaterial(DE),\r\n         * ArticlePlannedChangesSAP.PlannedChange(DE, 2020-08-01, 4) &formatData=false\r\n         * &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n        return getArticleListByValue(articleBase, \"Article.ArticleClass\", PlannedType.ZUORDNUNG_MATERIAL);\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByArticleClass function takes a list of ArticleBase objects and returns a list of strings.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the articlebase list\r\n     * @return A list of all the articles in a given article class\r\n     */\r\n    public List<String> getAllArticleByArticleClass(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByArticleClass(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByBrands function takes a list of ArticleBase objects and returns a list of Filterbase objects.\r\n     * The function uses the RestClient to query the IPIM database for all articles in the given articleBase list,\r\n     * then it creates Filterbase objects from each article's brand information. If an article has no brand,\r\n     * then its product number is used to find its corresponding product in IPIM and that product's brand is used instead.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the article numbers from\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getArticleListByBrands(List<ArticleBase> articleBase) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID, Article.CurrentStatus\r\n         * &formatData=false &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            String noBrands = \"\";\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest\r\n                        .setFields(\"Article.SupplierAID,Article.Brand,Article.BrandSupplier\").setPageSize(-1)\r\n                        .setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n\r\n                    String homBrand = Parse.toString(values.get(1)); // EigenMarke\r\n                    if (homBrand.length() > 0) {\r\n                        fObj.setLabel(homBrand);\r\n                    } else {\r\n                        if (values.get(2) instanceof String) {\r\n                            // Means its Empty\r\n                            fObj.setLabel(\"no.Brand\");\r\n                            noBrands += (noBrands.isEmpty() ? \"\" : \",\") + \"\\\"\"\r\n                                    + (Parse.toString(values.get(0))).substring(0, 6) + \"\\\"\";\r\n                        } else {\r\n                            EntityItemReference supplier = (EntityItemReference) values.get(2); // SupplierMarke\r\n                            fObj.setLabel(supplier.getLabel());\r\n                        }\r\n                    }\r\n\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.BRANDS.name());\r\n                    fObj.setType(FilterType.BRANDS);\r\n                    cached.add(fObj);\r\n                }\r\n            }\r\n            List<Filterbase> fProducts = new ArrayList<>();\r\n            if (noBrands.length() > 0) {\r\n                String parameter = \"Product2G.ProductNo in (\" + noBrands + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n                EntityItemTable resultTable = listReadRequest.setFields(\"Product2G.ProductNo,Product2G.Brand\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Product2G\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    if (values.get(1) instanceof String) {\r\n                        // Means its Empty\r\n                        fObj.setLabel(\"no.Brand\");\r\n                    } else {\r\n                        EntityItemReference supplier = (EntityItemReference) values.get(1); // SupplierMarke\r\n                        fObj.setLabel(supplier.getLabel());\r\n                    }\r\n\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.BRANDS.name());\r\n                    fObj.setType(FilterType.BRANDS);\r\n                    fProducts.add(fObj);\r\n                }\r\n\r\n                cached.forEach(fArticle -> fProducts.forEach(fProduct -> {\r\n                    if (fArticle.getIdentifier().startsWith(fProduct.getIdentifier())) {\r\n                        fArticle.setLabel(fProduct.getLabel());\r\n                    }\r\n                }));\r\n                result.addAll(cached);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByBrands function takes a list of ArticleBase objects and returns a list of strings.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the list of articles that are in the database\r\n     * @return A list of article identifiers\r\n     */\r\n    public List<String> getAllArticleByBrands(List<ArticleBase> articleBase) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getArticleListByBrands(articleBase).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleWithNoPrice function takes a list of ArticleBase objects and returns a list of strings.\r\n     * The function iterates through the articleBase parameter, checking if the priceFirst field is empty. If it is,\r\n     * then it adds that article's number to the result list.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the list of articles to be checked\r\n     * @return A list of article numbers\r\n     */\r\n    public List<String> getAllArticleWithNoPrice(List<ArticleBase> articleBase) {\r\n        List<String> result = new ArrayList<>();\r\n        articleBase.forEach(article -> {\r\n            if (article.getPriceFirst().isEmpty()) {\r\n                result.add(article.getArticleNr());\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getRestClient function returns a RestClient object that is used to make REST calls.\r\n     * The RestClient object returned by this function has been configured with the appropriate\r\n     * credentials for making requests against the target server.  This function uses the restMgr\r\n     * instance variable, which was initialized in init(), to get a basic client that can be used for making REST calls.\r\n     *\r\n     * @return A restclient object\r\n     */\r\n    private RestClient getRestClient() {\r\n        return restMgr.getBasicClient();\r\n    }\r\n\r\n    /**\r\n     * The getArticleListByValue function is used to retrieve the article list by value.\r\n     *\r\n     * @param List&lt;ArticleBase&gt; articleBase Get the territory and validfrom values\r\n     *                                private list&lt;filterbase&gt; getarticlelistbyvalue(list&lt;articlebase&gt; articlebase, string value)\r\n     *                                throws restclientexception {\r\n     *                                <p>\r\n     *                                string territory = articlebase\r\n     * @param String                  value Determine the field to be queried\r\n     * @param PlannedType             valueType Determine which value to return\r\n     * @return A list of filterbase objects\r\n     */\r\n    private List<Filterbase> getArticleListByValue(List<ArticleBase> articleBase, String value, PlannedType valueType)\r\n            throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/bySearch?query=Article.\r\n         * SupplierAID+in+() &fields=Article.SupplierAID,\r\n         * ArticleLogistic.AssignedMaterial(DE),\r\n         * ArticlePlannedChangesSAP.PlannedChange(DE, 2020-08-01, 4) &formatData=false\r\n         * &metaData=true &startIndex=0 &pageSize=-1\r\n         */\r\n        String territory = articleBase.get(0).getTerritory();\r\n        String validFrom = articleBase.get(0).getValidFrom();\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        int partSize = 2000;\r\n        List<List<ArticleBase>> articleList = InternalUtils.listSplitter(articleBase, partSize);\r\n        for (int i = 0; i < articleList.size(); i++) {\r\n            String articles = InternalUtils.listToString(articleList.get(i), ArticleBase::getArticleNr, \",\");\r\n            List<Filterbase> cached = new ArrayList<>();\r\n\r\n            if (!articles.isEmpty()) {\r\n                String parameter = \"Article.SupplierAID in (\" + articles + \")\";\r\n\r\n                ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n                reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n                ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n                String date = validFrom;\r\n                if (validFrom.length() == 8) {\r\n                    // yyyy = Year MM = Month dd = Day\r\n                    date = Parse.convertDate(validFrom, \"ddMMyyyy\", \"yyyy-MM-dd\");\r\n                }\r\n\r\n                EntityItemTable resultTable = listReadRequest\r\n                        .setFields(\"Article.SupplierAID, \" + value + \",  ArticlePlannedChangesSAP.PlannedChange(\"\r\n                                + territory + \", \" + date + \", \" + valueType.getValue() + \")\")\r\n                        .setPageSize(-1).setStartIndex(0).getRootItems(\"Article\", reportQuery);\r\n\r\n                for (EntityItemTableRow row : resultTable) {\r\n                    List<Object> values = row.getValues();\r\n                    Filterbase fObj = new Filterbase();\r\n                    fObj.setIdentifier(Parse.toString(values.get(0)));\r\n                    String current = Parse.toString(values.get(1));\r\n                    String planned = Parse.toString(values.get(2));\r\n\r\n                    fObj.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + valueType.getValue());\r\n                    fObj.setType(valueType.name());\r\n                    fObj.setLabel(planned.isEmpty() ? current.substring(0, 3) : planned.substring(0, 3));\r\n                    cached.add(fObj);\r\n                }\r\n                result.addAll(cached);\r\n\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAssortmentIdByAssortmentName function takes a String name as an argument and returns the assortmentId of that assortment.\r\n     *\r\n     * @param String name Get the assortment id by the name of an assortment\r\n     * @return The id of the assortment name\r\n     */\r\n    public int getAssortmentIdByAssortmentName(String name) throws RestClientException {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/ArticleAssortment/bySearch/?query=\r\n         * ArticleAssortment.Name+equals+\"90019030_STATISCH_eCat\"\r\n         */\r\n\r\n        String result = \"\";\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        String parameter = \"ArticleAssortment.Name equals \\\"\" + name + \"\\\"\";\r\n\r\n        ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n        reportQuery.addParameterValue(\"query\", parameter);\r\n\r\n        ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n        EntityItemTable resultTable = listReadRequest.setPageSize(-1).setStartIndex(0).getRootItems(\"ArticleAssortment\",\r\n                reportQuery);\r\n\r\n        for (EntityItemTableRow row : resultTable) {\r\n            result = row.getObject().getId();\r\n        }\r\n        return Parse.toInt(result);\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByAssortmentId function takes in an assortmentId and returns a list of Filterbase objects.\r\n     * The function uses the RestClient to create a ReportQuery object, which is then used to create a ListReadRequest object.\r\n     * The ListReadRequest object is then used to get the root items from the Article entity using reportQuery as its parameter.\r\n     * A for loop iterates through each row in resultTable, creating new Filterbase objects with their identifiers set as their labels,\r\n     * labels set as assortmentIds (as strings), entityIdentifiers set by concatenating row IDs with IPIM_DELIMITER\r\n     *\r\n     * @param int assortmentId Get the assortment id\r\n     *            public list&lt;filterbase&gt; getallarticlebyassortmentid(int assortmentid, string filter) {\r\n     *            /*\r\n     *            http:\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getAllArticleByAssortmentId(int assortmentId) {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/Article/byAssortment?assortment=7505\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        ReportQuery reportQuery = new ReportQuery(\"byAssortment\");\r\n        reportQuery.addParameterValue(\"assortment\", assortmentId);\r\n        ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n        EntityItemTable resultTable = listReadRequest.setPageSize(-1).setStartIndex(0).getRootItems(\"Article\",\r\n                reportQuery);\r\n\r\n        for (EntityItemTableRow row : resultTable) {\r\n            Filterbase base = new Filterbase();\r\n            base.setIdentifier(row.getObject().getLabel());\r\n            base.setLabel(String.valueOf(assortmentId));\r\n            base.setEntityIdentifier(row.getObject().getId() + IPIM_DELIMITER + FilterType.BASIC_ASSORTMENT.name());\r\n            base.setType(FilterType.BASIC_ASSORTMENT);\r\n            result.add(base);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleByAssortments function takes in an assortmentId and returns a list of all the articles that are associated with that assortment.\r\n     *\r\n     * @param int assortmentId Get all the articles in a specific assortment\r\n     * @return A list of article identifiers\r\n     */\r\n    public List<String> getAllArticleByAssortments(int assortmentId) throws RestClientException {\r\n        List<String> result = new ArrayList<>();\r\n        getAllArticleByAssortmentId(assortmentId).forEach(fObj -> result.add(fObj.getIdentifier()));\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllStructureOfCategoryToFileBase function is a function that takes in two parameters,\r\n     * the first being a Setting object and the second being a Language object. The function then calls\r\n     * on another function called getAllStructureOfCategory which returns an ArrayList of Category objects.\r\n     * This ArrayList is then passed into another method called saveAll which saves all of these categories to\r\n     * file base.\r\n     *\r\n     * @param Setting  setting Get the category of the structure\r\n     * @param Language lang Determine which language the structure should be in\r\n     * @return The list of all structureofcategory entities\r\n     */\r\n    public void getAllStructureOfCategoryToFileBase(Setting setting, Language lang) {\r\n        daoService.saveAll(getAllStructureOfCategory(setting, lang));\r\n    }\r\n\r\n    /**\r\n     * The getAllStructureOfCategory function is used to retrieve all the structure of a category.\r\n     *\r\n     * @param Setting  setting Get the structure type\r\n     * @param Language lang Get the name of the structure in that language\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getAllStructureOfCategory(Setting setting, Language lang) {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/StructureGroup/byStructure?structure=\r\n         * ecat &fields=StructureGroup.Id, StructureGroup.Identifier,\r\n         * StructureGroup.ParentId\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        SettingType type = SettingType.valueOf(setting.getIdentifier());\r\n\r\n        ReportQuery reportQuery = new ReportQuery(\"byStructure\");\r\n        reportQuery.addParameterValue(\"structure\", setting.getValue());\r\n\r\n        ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n        EntityItemTable resultTable = listReadRequest.setPageSize(-1).setStartIndex(0).setFields(\r\n                        \"StructureGroup.Id,StructureGroup.Identifier,StructureGroup.ParentId,StructureGroup.DisplayOrder,StructureGroupLang.Name(\"\r\n                                + lang.getKey() + \")\")\r\n                .getRootItems(\"StructureGroup\", reportQuery);\r\n\r\n        for (EntityItemTableRow row : resultTable) {\r\n            String structureGroupID = \"\";\r\n            String structureGroupName = \"\";\r\n            int structureGroupDisplayOrder = 0;\r\n\r\n            String structureGroupParentID = \"\";\r\n\r\n            structureGroupID = Parse.toString(row.getValues().get(0)); // STRUCTURE_GROUP_ID\r\n            // StructureGroup = STRUCTURE_GROUP_IDENTIFIER\r\n            // structureGroupName = row.getObject().getLabel(); // StructureGroupName\r\n            structureGroupName = Parse.toString(row.getValues().get(4)); // StructureGroupName\r\n            structureGroupParentID = Parse.toString(row.getValues().get(2)); // STRUCTURE_GROUP_PARENT_ID\r\n            structureGroupDisplayOrder = Parse.toInt(row.getValues().get(3)); // Sort\r\n\r\n            Filterbase base = new Filterbase();\r\n            base.setStructureGroupId(Parse.toInt(structureGroupID));\r\n            base.setIdentifier(base.getIdentifier());\r\n\r\n            if (Objects.isNull(base.getIdentifier())) {\r\n                base.setIdentifier((structureGroupParentID.isEmpty() ? \"\" : structureGroupParentID + \":\")\r\n                        + base.getStructureGroupId());\r\n            }\r\n\r\n            base.setLabel(structureGroupName);\r\n            base.setEntityIdentifier(\r\n                    base.getIdentifier() + IPIM_DELIMITER + FilterType.STRUCTURE + IPIM_DELIMITER + type.getOptional());\r\n            base.setType(FilterType.STRUCTURE);\r\n            base.setSort(structureGroupDisplayOrder);\r\n            base.setStructureType(type.getOptional());\r\n            result.add(base);\r\n        }\r\n\r\n\r\n        // set Structure\r\n        for (int i = 0; i < 8; i++) {\r\n            final int level = i;\r\n            result.forEach(item -> {\r\n                String[] levels = item.getIdentifier().split(\":\");\r\n                if (levels.length > level) {\r\n                    Optional<Filterbase> optParent = result.stream()\r\n                            .filter(filter -> filter.getStructureGroupId() == Parse.toInt(levels[0])).findFirst();\r\n                    optParent.ifPresent(parent -> item\r\n                            .setIdentifier(item.getIdentifier().replace(levels[0], parent.getIdentifier())));\r\n                }\r\n            });\r\n        }\r\n        //Set Parent\r\n        result.forEach(item -> {\r\n            String[] levels = item.getIdentifier().split(\":\");\r\n            if (levels.length > 1) {\r\n                int iParent = Parse.toInt(levels[levels.length - 2]);\r\n                Optional<Filterbase> optParent = result.stream()\r\n                        .filter(filter -> filter.getStructureGroupId() == iParent).findFirst();\r\n                optParent.ifPresent(item::setParent);\r\n            }\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllRootStructure function returns a list of all the root structures in the IPIM database.\r\n     *\r\n     * @return A list of filterbase objects\r\n     */\r\n    public List<Filterbase> getAllRootStructure() {\r\n        /*\r\n         * http://10.25.20.102:1501/rest/V1.0/list/StructureGroup/byStructure?structure=\r\n         * ecat &fields=StructureGroup.Id, StructureGroup.Identifier,\r\n         * StructureGroup.ParentId\r\n         */\r\n\r\n        List<Filterbase> result = new ArrayList<>();\r\n\r\n        RestClient restClient = getRestClient();\r\n\r\n        ReportQuery reportQuery = new ReportQuery(\"all\");\r\n\r\n        ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n        EntityItemTable resultTable = listReadRequest.setPageSize(-1).setStartIndex(0).getRootItems(\"Structure\",\r\n                reportQuery);\r\n\r\n        for (EntityItemTableRow row : resultTable) {\r\n            Filterbase base = new Filterbase();\r\n            base.setEntityIdentifier(base.getIdentifier() + IPIM_DELIMITER + \"ROOT-\" + FilterType.STRUCTURE);\r\n            base.setIdentifier(row.getObject().getId());\r\n            base.setLabel(row.getObject().getLabel());\r\n            result.add(base);\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getAllArticleAssortments function returns a map of maps. The outer map is keyed by the category name, and the inner\r\n     * map is keyed by the article assortment label. The value for each entry in both maps is an integer representing that\r\n     * particular article assortment's ID number. This function allows us to easily access all of our article assortments,\r\n     * which are used to categorize articles into different groups (e.g., &quot;Beverages&quot; or &quot;Dairy&quot;). We can use this information\r\n     * later on when we want to add new articles or update existing ones with new categories/article assortments\r\n     *\r\n     * @return A map with the following structure:\r\n     */\r\n    public Map<String, Map<String, Integer>> getAllArticleAssortments() throws RestClientException {\r\n        Map<String, Map<String, Integer>> result = new HashMap<String, Map<String, Integer>>();\r\n        RestClient restClient = getRestClient();\r\n\r\n        ReportQuery reportQuery = new ReportQuery(\"bySearch\");\r\n\r\n        ListReadRequest listReadRequest = restClient.createListReadRequest();\r\n\r\n        EntityItemTable resultTable = listReadRequest.setFields(\"ArticleAssortment.Category\").setPageSize(-1)\r\n                .setStartIndex(0).getRootItems(\"ArticleAssortment\", reportQuery);\r\n        for (EntityItemTableRow row : resultTable) {\r\n            List<Object> values = row.getValues();\r\n            String key = Parse.toString(values.get(0));\r\n            Map<String, Integer> value = result.get(key);\r\n            if (Objects.isNull(value)) {\r\n                value = new HashMap<String, Integer>();\r\n            }\r\n\r\n            value.put( /* VALUE */row.getObject().getLabel(), /* KEY */Parse.toInt(row.getObject().getId()));\r\n\r\n            result.put(key, value);\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\ipim\\service\\IPIMService.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\ArticleBaseDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.ArticleBase;\r\nimport com.hom.ebmw.jpa.model.Assortment;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport org.springframework.data.jpa.repository.Modifying;\r\nimport org.springframework.data.jpa.repository.Query;\r\nimport org.springframework.data.repository.query.Param;\r\nimport org.springframework.transaction.annotation.Transactional;\r\n\r\nimport java.util.List;\r\n\r\nimport static com.hom.ebmw.utilities.constans.ASTConst.DB_DELIMITER;\r\n\r\n@Transactional\r\npublic interface ArticleBaseDAO extends JpaRepository<ArticleBase, String> {\r\n\r\n    @Modifying\r\n    @Query(\"update ArticleBase a set a.basicassortment = :basicassortment where a.assortment = :assortment and a.articleNr in (:articleNrs)\")\r\n    int updateBasicAssortmentByAssortmentAndArticles(\r\n            @Param(value = \"basicassortment\") boolean basicassortment,\r\n            @Param(value = \"assortment\") Assortment assortment,\r\n            @Param(value = \"articleNrs\") List<String> articleNrs);\r\n\r\n    @Modifying\r\n    @Query(\"update ArticleBase a set a.basicassortment = :basicassortment \"\r\n            + \"where a.assortment = :assortment and a.articleNr \"\r\n            + \"in (Select f.identifier FROM Filterbase f WHERE f.type = :type AND f.label = :label)\")\r\n    int updateBasicAssortmentByAssortmentAndFilterbaseTypeAndLabel(\r\n            @Param(value = \"basicassortment\") boolean basicassortment,\r\n            @Param(value = \"assortment\") Assortment assortment,\r\n            @Param(value = \"type\") String type,\r\n            @Param(value = \"label\") String label);\r\n\r\n    @Modifying\r\n    @Query(\"update ArticleBase a set a.foundArticleStatus = :foundArticle, a.comment = concat(a.comment, '\" + DB_DELIMITER + \"', :comment) where a.assortment = :assortment and a.articleNr in (:articleNrs)\")\r\n    int updateFilterByAssortmentAndArticles(\r\n            @Param(value = \"foundArticle\") int foundArticle,\r\n            @Param(\"comment\") String comment,\r\n            @Param(value = \"assortment\") Assortment assortment,\r\n            @Param(value = \"articleNrs\") List<String> articleNrs);\r\n\r\n    @Modifying\r\n    @Query(\"update ArticleBase a set a.foundArticleStatus = :foundArticle, a.comment = concat(a.comment, '\" + DB_DELIMITER + \"', :comment) \"\r\n            + \"where a.assortment = :assortment and a.articleNr \"\r\n            + \"in (Select f.identifier FROM Filterbase f WHERE f.type = :type AND f.label = :label)\")\r\n    int updateFilterByAssortmentAndFilterbaseType(\r\n            @Param(value = \"foundArticle\") int foundArticle,\r\n            @Param(\"comment\") String comment,\r\n            @Param(value = \"assortment\") Assortment assortment,\r\n            @Param(value = \"type\") String type,\r\n            @Param(value = \"label\") String label);\r\n\r\n    List<ArticleBase> findAllByAssortment(Assortment assortment);\r\n\r\n    List<ArticleBase> findAllByAssortmentAndFoundArticleStatus(Assortment assortment, int foundArticleStatus);\r\n\r\n    Long deleteByAssortment(Assortment assortment);\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\ArticleBaseDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\ArticleBaseQueueDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.ArticleBaseQueue;\r\nimport com.hom.ebmw.jpa.model.User;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport org.springframework.data.jpa.repository.Query;\r\n\r\nimport java.util.List;\r\nimport java.util.Optional;\r\n\r\npublic interface ArticleBaseQueueDAO extends JpaRepository<ArticleBaseQueue, Integer> {\r\n\r\n    Optional<ArticleBaseQueue> findBySession(String session);\r\n\r\n    List<ArticleBaseQueue> findAllByUserAndSession(User user, String session);\r\n\r\n    @Query(\"SELECT a FROM ArticleBaseQueue a where a.user IS NULL\")\r\n    List<ArticleBaseQueue> findAllByUserIsNull();\r\n\r\n    void deleteBySession(String session);\r\n\r\n    void deleteByUserAndSession(User user, String session);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\ArticleBaseQueueDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\ArticleStatisticDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.ArticleStatistic;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\npublic interface ArticleStatisticDAO extends JpaRepository<ArticleStatistic, Long> {\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\ArticleStatisticDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AssortmentDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.Assortment;\r\nimport com.hom.ebmw.jpa.model.ProjectRole;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\nimport org.springframework.data.jpa.repository.Query;\r\nimport org.springframework.data.repository.query.Param;\r\n\r\nimport java.util.List;\r\nimport java.util.Optional;\r\n\r\npublic interface AssortmentDAO extends JpaRepository<Assortment, Integer> {\r\n\r\n\r\n    @Query(\"SELECT a FROM Assortment a WHERE a.projectRole = :projectRole and a.deleteBy is null\")\r\n    List<Assortment> findAllByProjectAndDeleteByIsNull(@Param(\"projectRole\") ProjectRole project);\r\n\r\n    List<Assortment> findAllByProjectRoleAndDeleteBy(ProjectRole project, String delete);\r\n\r\n    List<Assortment> findAllByProjectRole(ProjectRole project);\r\n\r\n\r\n    Optional<Assortment> findByName(String name);\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AssortmentDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AssortmentDataFileDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.Assortment;\r\nimport com.hom.ebmw.jpa.model.AssortmentDatafile;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\n\r\npublic interface AssortmentDataFileDAO extends JpaRepository<AssortmentDatafile, Integer> {\r\n\r\n    List<AssortmentDatafile> findAllByAssortment(Assortment assortment);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AssortmentDataFileDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AssortmentFilterDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.Assortment;\r\nimport com.hom.ebmw.jpa.model.AssortmentFilter;\r\nimport com.hom.ebmw.jpa.model.Filter;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\n\r\npublic interface AssortmentFilterDAO\r\n        extends\r\n        JpaRepository<AssortmentFilter, Integer> {\r\n\r\n\r\n    List<AssortmentFilter> findAllByAssortment(Assortment assortment);\r\n\r\n    List<AssortmentFilter> findAllByFilter(Filter filter);\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AssortmentFilterDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AstFileDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.AstFile;\r\nimport com.hom.ebmw.jpa.model.ProjectRole;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\nimport java.util.Optional;\r\n\r\npublic interface AstFileDAO extends JpaRepository<AstFile, Integer> {\r\n\r\n    List<AstFile> findAllByProjectRole(ProjectRole projectRole);\r\n\r\n    Optional<AstFile> findByName(String name);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\AstFileDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\CustomerDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.CustomerFile;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.Optional;\r\n\r\npublic interface CustomerDAO extends JpaRepository<CustomerFile, Integer> {\r\n    Optional<CustomerFile> findByName(String name);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\CustomerDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\CustomerFilterDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.CustomerFilter;\r\nimport com.hom.ebmw.jpa.model.Filter;\r\nimport com.hom.ebmw.jpa.model.Role;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\n\r\npublic interface CustomerFilterDAO extends JpaRepository<CustomerFilter, Long> {\r\n\r\n    List<CustomerFilter> findAllByCustomerNr(String customerNr);\r\n\r\n    List<CustomerFilter> findAllByCustomerNrAndRoleAndDeleteByIsNullAndType(String customerNr, Role role, String type);\r\n\r\n    List<CustomerFilter> findAllByFilter(Filter filter);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\CustomerFilterDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\DataFileDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.DataFile;\r\nimport com.hom.ebmw.jpa.model.ProjectRole;\r\nimport com.hom.ebmw.jpa.model.User;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\nimport java.util.Optional;\r\n\r\npublic interface DataFileDAO extends JpaRepository<DataFile, Integer> {\r\n    List<DataFile> findAllByProjectRoleAndDeleteBy(ProjectRole projectRole, User delete);\r\n\r\n    List<DataFile> findAllByProjectRole(ProjectRole projectRole);\r\n\r\n    Optional<DataFile> findByName(String name);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\DataFileDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\FilterBaseDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.Assortment;\r\nimport com.hom.ebmw.jpa.model.Filter;\r\nimport com.hom.ebmw.jpa.model.Filterbase;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\nimport java.util.Optional;\r\n\r\npublic interface FilterBaseDAO extends JpaRepository<Filterbase, Integer> {\r\n\r\n    List<Filterbase> findAllByAssortmentAndDelete(Assortment assortment, boolean isDelete);\r\n\r\n    List<Filterbase> findAllByAssortment(Assortment assortment);\r\n\r\n    List<Filterbase> findAllByAssortmentAndDirectionAndDelete(Assortment assortment, Integer direction, boolean isDelete);\r\n\r\n    List<Filterbase> findAllByAssortmentAndDirectionAndDeleteAndType(Assortment assortment, Integer direction, boolean isDelete, String type);\r\n\r\n    List<Filterbase> findAllByFilterAndDelete(Filter filter, boolean isDelete);\r\n\r\n    List<Filterbase> findAllByParentAndDelete(Filterbase parent, boolean isDelete);\r\n\r\n    List<Filterbase> findAllByStructureTypeAndParentIsNullAndAssortmentIsNullAndFilterIsNullAndDelete(String structureType, boolean isDelete);\r\n\r\n    List<Filterbase> findAllByStructureTypeAndDeleteAndAssortmentIsNullAndFilterIsNull(String structureType, boolean isDelete);\r\n\r\n    List<Filterbase> findAllByEntityIdentifierAndDelete(String entityIdentifier, boolean isDelete);\r\n\r\n    Optional<Filterbase> findByEntityIdentifierAndDelete(String entityIdentifier, boolean isDelete);\r\n\r\n    void deleteByAssortment(Assortment assortment);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\FilterBaseDAO.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\FilterDAO.java =====\n```\npackage com.hom.ebmw.jpa.dao;\r\n\r\nimport com.hom.ebmw.jpa.model.Filter;\r\nimport com.hom.ebmw.jpa.model.Role;\r\nimport org.springframework.data.jpa.repository.JpaRepository;\r\n\r\nimport java.util.List;\r\n\r\npublic interface FilterDAO extends JpaRepository<Filter, Integer> {\r\n    List<Filter> findAllByTeam(Role team);\r\n\r\n    List<Filter> findAllByTeamAndDeleteByIsNull(Role team);\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\jpa\\dao\\FilterDAO.java =====\n\n"
  },
  "response" : {
    "id" : "chatcmpl-EWZM1t8ZyUcO2Ored9F5bE6d7idI0Aiu",
    "created" : 1762170616,
    "model" : "gpt-oss:120b",
    "object" : "chat.completion",
    "system_fingerprint" : "b1-b0d5299",
    "choices" : [ {
      "finish_reason" : "stop",
      "index" : 0,
      "message" : {
        "content" : "{\n  \"file\": \"multiple\",\n  \"issues\": [\n    {\n      \"severity\": \"High\",\n      \"problem\": \"Incorrect OData filter string in MSgraphService.getUsersById() leads to malformed queries\",\n      \"justification\": \"The else branch builds `filter = \\\"id eq \\\" + id.trim() + \\\"'\\\";` missing opening quote and extra trailing quote, causing API errors and potential data leakage.\",\n      \"action\": \"Fix filter construction to `filter = \\\"id eq '\\\" + id.trim() + \\\"'\\\";` and add unit test verifying correct filter for single ID and multiple IDs.\",\n      \"source\": \"MSgraphService.getUsersById(String id), Zeile 251-261\",\n      \"component\": \"graph-service\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"Array index bug in IPIMService.getArticleListByGHSCode()\",\n      \"justification\": \"Uses `current[i]` inside a loop where `i` is the outer list index; should use `k`. This throws ArrayIndexOutOfBoundsException and returns wrong GHS codes.\",\n      \"action\": \"Replace `current[i]` with `current[k]`, add null/empty checks, and create tests for multiple GHS code values.\",\n      \"source\": \"IPIMService.getArticleListByGHSCode(List<ArticleBase>), Zeile 1042-1052\",\n      \"component\": \"ipim-service\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"Potential OData injection via string concatenation in MSgraphService filter methods\",\n      \"justification\": \"Methods like getGroupId, getUsersBySurNameAndGiveName, and getUsersByFilter build queries by directly inserting usersupplied strings, which can be exploited if inputs are not trusted.\",\n      \"action\": \"Introduce a safe parameterbinding utility or encode inputs before concatenation; add validation for allowed characters.\",\n      \"source\": \"MSgraphService.getGroupId(String), getUsersBySurNameAndGiveName(String,String), Zeilen 176, 199-208\",\n      \"component\": \"graph-service\",\n      \"impact_scope\": \"securitycritical\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"NullPointerException risk in MSgraphService.getMe() when token is missing\",\n      \"justification\": \"Method declares `throws NullPointerException` and calls `client.me().buildRequest().get()` without checking if `client` is null, which can crash the application.\",\n      \"action\": \"Check `client != null` before use, throw a custom checked exception (e.g., TokenNotValidException), and update callers to handle it.\",\n      \"source\": \"MSgraphService.getMe(), Zeile 92-103\",\n      \"component\": \"graph-service\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"Missing size check before accessing first element in IPIMService.getArticleListByValue()\",\n      \"justification\": \"Calls `articleBase.get(0)` without verifying the list is nonempty, leading to IndexOutOfBoundsException on empty input.\",\n      \"action\": \"Add `if (articleBase.isEmpty()) return Collections.emptyList();` at method start and write tests for empty list scenario.\",\n      \"source\": \"IPIMService.getArticleListByValue(List<ArticleBase>,String,PlannedType), Zeile 1585-1590\",\n      \"component\": \"ipim-service\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"Protected visibility for @Bean method in ThreadPoolTaskSchedulerConfig\",\n      \"justification\": \"Spring can still detect protected beans, but public is the conventional visibility and avoids accidental exclusion in some configurations.\",\n      \"action\": \"Change method visibility to `public` and verify bean loads in integration tests.\",\n      \"source\": \"ThreadPoolTaskSchedulerConfig.threadPoolTaskScheduler(), Zeile 24-33\",\n      \"component\": \"configuration\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"Exception classes lack constructors for cause chaining\",\n      \"justification\": \"Without `Throwable cause` constructors, stack traces of underlying issues are lost, making debugging harder.\",\n      \"action\": \"Add constructors accepting `Throwable cause` to all custom exceptions and update usages if needed.\",\n      \"source\": \"AccessDeniedException, ConvertException, ParameterException, etc., Zeilen 4-20\",\n      \"component\": \"exceptions\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"Redundant/incorrect assignment in IPIMService.getAllStructureOfCategory()\",\n      \"justification\": \"Line `base.setIdentifier(base.getIdentifier());` does nothing and may hide a missing proper identifier assignment, leading to null identifiers later.\",\n      \"action\": \"Remove the redundant line and ensure identifier is set from parsed data before use; add unit test verifying identifier population.\",\n      \"source\": \"IPIMService.getAllStructureOfCategory(), Zeile 1250-1252\",\n      \"component\": \"ipim-service\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": null\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"Missing @Transactional on @Modifying repository methods\",\n      \"justification\": \"Spring Data JPA requires a transactional context for modifying queries; without it, updates may not be flushed, causing silent failures.\",\n      \"action\": \"Annotate all `@Modifying` methods in `ArticleBaseDAO` with `@Transactional` (or move transaction management to service layer) and add integration tests confirming updates.\",\n      \"source\": \"ArticleBaseDAO.updateBasicAssortmentByAssortmentAndArticles, Zeile 14-23\",\n      \"component\": \"jpa-dao\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": null\n    }\n  ],\n  \"summary\": {\n    \"overall_rating\": \"2\",\n    \"top_todos\": [\n      \"Fix malformed OData filter in MSgraphService.getUsersById and add tests\",\n      \"Correct array index bug in IPIMService.getArticleListByGHSCode\",\n      \"Add input validation / safe binding for OData filters in MSgraphService\"\n    ]\n  }\n}",
        "role" : "assistant",
        "reasoning_content" : "We need to produce JSON review for each file? The instructions: \"analysierst jeweils einen Code-Chunk.\" Could be per file. Probably we need one JSON output per chunk? But only one JSON allowed. Could combine issues across all files? The schema includes \"file\" path. Probably we need separate JSON for each file? But only one JSON object allowed. Could list issues for each file? The schema has single file field, not array. So we need to output for one file at a time. The prompt includes many files; maybe we should produce combined review for each file? However rule: \"Deine Antwort MUSS exakt dieses JSON-Objekt\" singular. So likely we need to pick one chunk? But user gave many files. Perhaps we need to output one JSON per file, but we can't. Could combine all issues into one file field \"multiple\"? Might set file to \"multiple\". Could list issues with source referencing each file. Probably acceptable.\n\nWe'll produce file: \"multiple\" and include issues across the code base, up to 10 issues total. Need prioritize.\n\nIdentify issues:\n\n1. ThreadPoolTaskSchedulerConfig: Bean method is protected, should be public for @Bean detection. Also missing @Bean method name default bean id? not major. But protected may still work? Actually Spring requires @Bean method can be any visibility, but usually public. Not critical.\n\n2. AccessDeniedException extends RuntimeException but no constructors for cause. Acceptable.\n\n3. ArticleBaseQueueException extends AstException (which extends Exception) but getLocalMessage overrides but AstException defines getLocalMessage; fine. However ArticleBaseQueueException's getLocalMessage uses ctx.getServices().getTranslationService().getTranslation(TMS.ERROR_MSG_WAIT_N_HOURS, ctx.getSession().getLocale(ctx), ctx); Might have NPE if ctx null. Not a big.\n\n4. Several exception classes lack serialVersionUID but okay.\n\n5. In MSgraphService: getMe throws NullPointerException but should handle token null; returning null GraphServiceClient leads to NPE. Also method declares throws NullPointerException (unchecked) not needed. Should handle missing token gracefully.\n\n6. MSgraphService getUsersByFilter catches IllegalArgumentException but logs error, returns empty list. Fine.\n\n7. getGroupId builds filter with string concatenation -> potential injection if groupName from user; but likely internal.\n\n8. getUsersBySurNameAndGiveName builds filter string without sanitization; risk of injection.\n\n9. getUsersById has bug: in else case filter = \"id eq \" + id.trim() + \"'\"; missing opening quote before id and extra trailing quote; also uses variable i in loop incorrectly: in building GHS code uses current[i] (should be k). That's a bug.\n\n10. getArticleListByGHSCode: uses current[i] inside loop where i is outer loop index, should use k. Also comparison current[0] != \"\" should use !current[0].isEmpty().\n\n11. Many methods use string concatenation for OData filter leading to injection risk.\n\n12. In IPIMService getAllStructureOfCategory: base.setIdentifier(base.getIdentifier()); seems redundant; also base.getIdentifier() may be null causing later NPE.\n\n13. In getArticleListByValue: uses articleBase.get(0) without check size leads to IndexOutOfBounds if empty list.\n\n14. In many DAO methods: @Modifying queries without @Transactional on methods may need.\n\nBut we limit to 10 issues.\n\nWe'll produce JSON with file \"multiple\" and list issues.\n\nProvide summary rating maybe 2 stars.\n\nTop todos: fix getUsersById filter bug, sanitize filter strings, add null checks for empty lists, correct GHS code loop index, improve token handling in MSgraphService, add proper @Transactional on modifying queries, avoid string concatenation for OData, add validation for inputs, ensure proper exception constructors, add unit tests for edge cases.\n\nLet's craft JSON."
      },
      "provider_specific_fields" : { }
    } ],
    "usage" : {
      "completion_tokens" : 2299,
      "prompt_tokens" : 24410,
      "total_tokens" : 26709
    },
    "timings" : {
      "cache_n" : 62,
      "prompt_n" : 24348,
      "prompt_ms" : 18148.826,
      "prompt_per_token_ms" : 0.7453928864793823,
      "prompt_per_second" : 1341.5743806238486,
      "predicted_n" : 2299,
      "predicted_ms" : 27610.358,
      "predicted_per_token_ms" : 12.009725097868639,
      "predicted_per_second" : 83.26585261951331
    }
  }
}