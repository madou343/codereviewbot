{
  "timestamp" : "2025-11-03T13:02:44.1499338",
  "index" : 14,
  "file" : "review-summary",
  "prompt" : {
    "role" : "user",
    "content" : "===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\BreadBox.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.annotations.BreadCrumb;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.Params;\r\nimport com.vaadin.flow.component.Component;\r\nimport com.vaadin.flow.component.Composite;\r\nimport com.vaadin.flow.component.Key;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.dom.Style;\r\nimport lombok.extern.slf4j.Slf4j;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Arrays;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\n\r\n@Slf4j\r\n@SuppressWarnings(\"serial\")\r\npublic class BreadBox\r\n        extends\r\n        Composite<VerticalLayout> {\r\n\r\n    private final List<Crumb> crumbs = new ArrayList<>();\r\n    private Crumb defaultCrumb;\r\n    private final List<Button> buttonCrumbs = new ArrayList<>();\r\n    private HorizontalLayout breadCrumb = new HorizontalLayout();\r\n    private final VerticalLayout content = new VerticalLayout();\r\n    private Component activeComp = null;\r\n\r\n    private Context ctx = new Context();\r\n    private Button exit;\r\n    private Button next;\r\n    private Button last;\r\n    private ImageButton finish;\r\n    private int prellCount = 0;\r\n\r\n    /**\r\n     * The BreadBox function is a constructor for the BreadBox class.\r\n     * It takes in a Context and an array of Crumbs, and sets the context to ctx,\r\n     * adds all of the crumbs to this.crumbs, then calls initial().\r\n     *\r\n     * @param Context  ctx Get the context of the current activity\r\n     * @param Crumb... crumps Pass a variable number of arguments to the function\r\n     * @return A list of crumbs\r\n     */\r\n    public BreadBox(\r\n            Context ctx,\r\n            Crumb... crumps) {\r\n        this.ctx = ctx;\r\n        this.crumbs.addAll(Arrays.asList(crumps));\r\n        initial();\r\n    }\r\n\r\n    /**\r\n     * The BreadBox function is a constructor for the BreadBox class.\r\n     * It takes in a Context object and sets it to the ctx variable.\r\n     *\r\n     * @param Context ctx Access the application's resources\r\n     * @return A new breadbox object\r\n     */\r\n    public BreadBox(Context ctx) {\r\n        this.ctx = ctx;\r\n    }\r\n\r\n    /**\r\n     * The initial function is used to set up the breadbox.\r\n     * It sets up the buttons and adds them to a horizontal layout,\r\n     * which is then added to the content of this class.\r\n     */\r\n    public void initial() {\r\n        HorizontalLayout controle = new HorizontalLayout();\r\n        CompUtils.reloadToolTips(ctx);\r\n        breadCrumb = new HorizontalLayout();\r\n        breadCrumb.setId(\"bread-crumb\");\r\n        breadCrumb.setWidthFull();\r\n        breadCrumb.setSpacing(false);\r\n        controle = new HorizontalLayout();\r\n        controle.setId(\"bread-crumb\");\r\n        controle.setWidthFull();\r\n\r\n        exit = new Button(VaadinIcon.CLOSE.create());\r\n        exit.setId(TMS.BREAD_BOX_EXIT);\r\n        CompUtils.addToolTip(ctx, exit, TMS.BREAD_BOX_EXIT_TOOLTIP);\r\n        exit.addClickListener(event -> {\r\n            if (prellCount == 0) {\r\n                prellCount++;\r\n                ctx.getUserSession().put(Params.ACTIVE_BREADBOX, this);\r\n                getCurrent().exit();\r\n                reset();\r\n            }\r\n        });\r\n        exit.addClickShortcut(Key.ESCAPE);\r\n\r\n        next = new Button(VaadinIcon.ANGLE_RIGHT.create());\r\n        next.setId(TMS.BREAD_BOX_NEXT);\r\n        CompUtils.addToolTip(ctx, next, TMS.BREAD_BOX_NEXT_TOOLTIP);\r\n        next.addClickShortcut(Key.ARROW_RIGHT);\r\n        next.addClickListener(event -> {\r\n            if (prellCount == 0) {\r\n                prellCount++;\r\n                ctx.getUserSession().put(Params.ACTIVE_BREADBOX, this);\r\n                getCurrent().goToNext();\r\n            }\r\n        });\r\n\r\n        last = new Button(VaadinIcon.ANGLE_DOUBLE_RIGHT.create());\r\n        last.setId(TMS.BREAD_BOX_LAST);\r\n        CompUtils.addToolTip(ctx, last, TMS.BREAD_BOX_LAST_TOOLTIP);\r\n        last.addClickListener(event -> {\r\n            if (prellCount == 0) {\r\n                prellCount++;\r\n                ctx.getUserSession().put(Params.ACTIVE_BREADBOX, this);\r\n                getCurrent().goToLast();\r\n            }\r\n        });\r\n        finish = new ImageButton(CompUtils.getSaveFloppy(ctx), CompUtils.getDisableSaveFloppy(ctx));\r\n        finish.setId(TMS.BREAD_BOX_FINISH);\r\n        CompUtils.addToolTip(ctx, finish, TMS.BREAD_BOX_FINISH_TOOLTIP);\r\n        finish.addClickListener(event -> {\r\n            if (prellCount == 0) {\r\n                prellCount++;\r\n                getCurrent().goFinish();\r\n            }\r\n        });\r\n        controle.removeAll();\r\n        controle.add(exit, breadCrumb, next, last, finish);\r\n        controle.setSpacing(false);\r\n        buttonCrumbs.clear();\r\n        crumbs.forEach(this::addCrump);\r\n        buttonCrumbs.forEach(breadCrumb::add);\r\n\r\n        content.setSizeFull();\r\n\r\n        getContent().removeAll();\r\n        getContent().add(controle, content);\r\n\r\n        CompUtils.removeMSP(getContent(), \"MSP\");\r\n        getContent().setSizeFull();\r\n    }\r\n\r\n    /**\r\n     * The resetBreadCrumps function removes all the buttons from the breadCrumb\r\n     * and then adds them back in. This is done to ensure that when a new file is\r\n     * opened, the breadcrumbs are reset to their original state.\r\n     */\r\n    public void resetBreadCrumps() {\r\n        breadCrumb.removeAll();\r\n        buttonCrumbs.forEach(breadCrumb::add);\r\n    }\r\n\r\n    /**\r\n     * The getCrumbs function returns the list of crumbs that have been added to the trail.\r\n     *\r\n     * @return The list of crumbs\r\n     */\r\n    public List<Crumb> getCrumbs() {\r\n        return crumbs;\r\n    }\r\n\r\n    /**\r\n     * The getButtonCrumbs function returns the list of buttons that are used to navigate back through the directory tree.\r\n     *\r\n     * @return A list of buttons\r\n     */\r\n    public List<Button> getButtonCrumbs() {\r\n        return buttonCrumbs;\r\n    }\r\n\r\n    /**\r\n     * @param comp\r\n     * @author Felix Roberg\r\n     * <p>\r\n     * HinzufÃ¼ge der Brotkrumen (BreadCrumbs) zur Internen Liste.\r\n     */\r\n    private void addCrump(Crumb comp) {\r\n        Button crump = comp.getCrumpHeader();\r\n        BreadCrumb innerBreadCrumb = comp.getClass().getAnnotation(BreadCrumb.class);\r\n        comp.getCrumpHeader().setText(getTranslation(TMS.setCrumb(innerBreadCrumb), getLocale(), ctx));\r\n        CompUtils.addToolTip(ctx, crump, TMS.setCrumb(innerBreadCrumb) + \"-tooltip\");\r\n        crump.setId(TMS.setCrumb(innerBreadCrumb));\r\n        if (!buttonCrumbs.isEmpty())\r\n            crump.setEnabled(false);\r\n\r\n        crump.addClickListener(event -> {\r\n            setContent(comp);\r\n            comp.reloadButtons();\r\n        });\r\n\r\n        buttonCrumbs.add(crump);\r\n        buttonCrumbs.forEach(crumpy -> crump.setWidth((100 / crumbs.size()) + \"%\"));\r\n    }\r\n\r\n    /**\r\n     * The setContent function is used to set the content of a BreadBox.\r\n     * It takes in a Component as an argument and sets it as the active component.\r\n     * The function also removes all components from the content panel, adds the new active component, and then sets this BreadBox as\r\n     * being currently active in its user session.\r\n     *\r\n     * @param Component comp Set the active component\r\n     */\r\n    public void setContent(Component comp) {\r\n        activeComp = comp;\r\n        crumbs.forEach(this::setActive);\r\n        CompUtils.removeMSP(content, \"MP\");\r\n        content.setSizeFull();\r\n        content.removeAll();\r\n        content.add(activeComp);\r\n        ctx.getUserSession().put(Params.ACTIVE_BREADBOX, this);\r\n    }\r\n\r\n    /**\r\n     * The getActive function returns the active component of the CrumbBar.\r\n     *\r\n     * @return The active component\r\n     */\r\n    public Crumb getActive() {\r\n        return (Crumb) activeComp;\r\n    }\r\n\r\n    public void next() {\r\n        Crumb crumb = getNext();\r\n        if (Objects.nonNull(crumb)) {\r\n            setContent(crumb);\r\n            crumb.reloadButtons();\r\n            crumb.reloadCrumb();\r\n        }\r\n    }\r\n\r\n    public void gotoNext(Crumb crumb) {\r\n        if (Objects.nonNull(crumb)) {\r\n            int index = crumbs.indexOf(crumb);\r\n            buttonCrumbs.get(index).setEnabled(true);\r\n            setContent(crumb);\r\n            crumb.reloadButtons();\r\n            crumb.reloadCrumb();\r\n        }\r\n    }\r\n\r\n    public Crumb getCurrent() {\r\n        Crumb result = null;\r\n        int index = crumbs.indexOf(activeComp);\r\n        if (index < crumbs.size()) {\r\n            result = crumbs.get(index);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public Crumb getNext() {\r\n        Crumb result = null;\r\n        int index = crumbs.indexOf(activeComp);\r\n        if (index < crumbs.size()) {\r\n            result = crumbs.get(index + 1);\r\n            buttonCrumbs.get(index + 1).setEnabled(true);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public void before() {\r\n        Crumb crumb = getBefore();\r\n        if (Objects.nonNull(crumb)) {\r\n            setContent(crumb);\r\n            crumb.reloadButtons();\r\n            crumb.reloadCrumb();\r\n        }\r\n    }\r\n\r\n    public Crumb getBefore() {\r\n        Crumb result = null;\r\n        int index = crumbs.indexOf(activeComp);\r\n        if (index < crumbs.size()) {\r\n            result = crumbs.get(index - 1);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public Crumb getLast() {\r\n        Crumb result = null;\r\n        int index = crumbs.indexOf(activeComp);\r\n        if (index < crumbs.size()) {\r\n            result = crumbs.get(crumbs.size() - 1);\r\n            buttonCrumbs.get(crumbs.size() - 1).setEnabled(true);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public void last() {\r\n        Crumb crumb = getLast();\r\n        if (Objects.nonNull(crumb)) {\r\n            setContent(crumb);\r\n            crumb.reloadButtons();\r\n            crumb.reloadCrumb();\r\n        }\r\n    }\r\n\r\n    public Crumb getFirst() {\r\n        return crumbs.get(0);\r\n    }\r\n\r\n    public void first() {\r\n        Crumb crumb = defaultCrumb;\r\n        try {\r\n            Crumb current = getCurrent();\r\n            if (!getFirst().equals(current)) crumb = getFirst();\r\n        } catch (Exception e) {\r\n            log.debug(e.getMessage(), e);\r\n        }\r\n        setContent(crumb);\r\n        crumb.reloadButtons();\r\n        crumb.reloadCrumb();\r\n    }\r\n\r\n    private void setActive(Crumb crumb) {\r\n        Style style = crumb.getCrumpHeader().getStyle();\r\n        if (crumb.equals(activeComp)) { // true\r\n            style.set(\"background\", ctx.getServices().getProperty().getColorButton());\r\n            style.set(\"color\", \"white\");\r\n        } else {\r\n            style.set(\"background\", \"white\");\r\n            style.set(\"color\", \"var(--lumo-primary-color)\");\r\n        }\r\n    }\r\n\r\n    public void setExitEnable(boolean enable) {\r\n        exit.setEnabled(enable);\r\n        exit.setVisible(enable);\r\n    }\r\n\r\n    public void setLastEnable(boolean enable) {\r\n        last.setEnabled(enable);\r\n        last.setVisible(enable);\r\n    }\r\n\r\n    public void setNextEnable(boolean enable) {\r\n        next.setEnabled(enable);\r\n        next.setVisible(enable);\r\n    }\r\n\r\n    public void setFinishEnable(boolean enable) {\r\n        finish.setEnabled(enable);\r\n        finish.setVisible(enable);\r\n    }\r\n\r\n    public void setDefaultCrumb(Crumb defaultCrumb) {\r\n        this.defaultCrumb = defaultCrumb;\r\n    }\r\n\r\n    public void resetPrellCount() {\r\n        prellCount = 0;\r\n    }\r\n\r\n    public void reset() {\r\n        reset(UI.getCurrent());\r\n    }\r\n\r\n    public void reset(UI ui) {\r\n        ui.access(() -> {\r\n            crumbs.clear();\r\n            buttonCrumbs.clear();\r\n            crumbs.add(defaultCrumb);\r\n            initial();\r\n        });\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\BreadBox.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\Crumb.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.configuration.security.Services;\r\nimport com.hom.ebmw.configuration.security.SessionUtils;\r\nimport com.hom.ebmw.ipim.model.Language;\r\nimport com.hom.ebmw.jpa.dao.impl.ArticleBaseRepository;\r\nimport com.hom.ebmw.jpa.model.*;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.pojo.CustomerLanguage;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.FilterRunUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.FileParam;\r\nimport com.hom.ebmw.utilities.enums.Params;\r\nimport com.hom.ebmw.utilities.enums.SessionParams;\r\nimport com.hom.ebmw.utilities.enums.SettingType;\r\nimport com.hom.ebmw.utilities.interfaces.Command;\r\nimport com.hom.ebmw.view.components.interfaces.BreadCrumble;\r\nimport com.hom.ebmw.view.sortment.subview.InfoBox;\r\nimport com.vaadin.flow.component.Component;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.confirmdialog.ConfirmDialog;\r\nimport com.vaadin.flow.component.html.Paragraph;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport lombok.extern.slf4j.Slf4j;\r\n\r\nimport java.io.File;\r\nimport java.time.LocalDate;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\nimport java.util.Optional;\r\n\r\n@Slf4j\r\n@SuppressWarnings(\"serial\")\r\npublic abstract class Crumb extends VerticalLayout implements BreadCrumble {\r\n\r\n    private final Button crump = new Button();\r\n    private Context ctx = new Context();\r\n\r\n    /**\r\n     * The Crumb function is a constructor for the Crumb class.\r\n     * It takes in a Context object and sets the height and width of the crumb to 100%.\r\n     * It also sets padding to 0em 0.2em, which means that there will be no top or bottom padding, but there will be left and right padding of .2 ems each.\r\n     *\r\n     * @param Context ctx Get the current context of the application\r\n     * @return A crumb object\r\n     */\r\n    protected Crumb(Context ctx) {\r\n        this.ctx = ctx;\r\n        setHeight(\"100%\");\r\n        setWidth(\"100%\");\r\n        getStyle().set(\"padding\", \"0em 0.2em\");\r\n    }\r\n\r\n    /**\r\n     * The getSetting function is used to retrieve a setting from the database.\r\n     *\r\n     * @param SettingType type Determine the type of setting that is being looked for\r\n     * @return A string\r\n     */\r\n    protected String getSetting(SettingType type) {\r\n        String result = \"\";\r\n        Optional<Setting> optSetting = getServices().getSettingCustomServices().findBySettingType(ctx, type);\r\n        if (optSetting.isPresent()) {\r\n            result = optSetting.get().getValue();\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The getArticles function returns a list of all articles in the database.\r\n     *\r\n     * @return A list of articlebase objects\r\n     */\r\n    public List<ArticleBase> getArticles() {\r\n        final ArticleBaseRepository articleService = getCtx().getServices().getArticleBaseService();\r\n        return articleService.findAll(ctx);\r\n    }\r\n\r\n    /**\r\n     * The getCrumpHeader function returns the crump header button.\r\n     *\r\n     * @return The crump header\r\n     */\r\n    public Button getCrumpHeader() {\r\n        return crump;\r\n    }\r\n\r\n    /**\r\n     * The getServices function returns the Services object that is used to access\r\n     * all of the services provided by this application.\r\n     *\r\n     * @return The services object that is associated with the current context\r\n     */\r\n    public Services getServices() {\r\n        return ctx.getServices();\r\n    }\r\n\r\n    /**\r\n     * The getSession function returns the session object for this context.\r\n     *\r\n     * @return The session object which is a sessionutils\r\n     */\r\n    public SessionUtils getSession() {\r\n        return ctx.getSession();\r\n    }\r\n\r\n    /**\r\n     * The getCtx function returns the context of the application.\r\n     *\r\n     * @return The context of the activity\r\n     */\r\n    public Context getCtx() {\r\n        return ctx;\r\n    }\r\n\r\n    /**\r\n     * The setLastEnable function is used to enable or disable the last button in the breadbox.\r\n     *\r\n     * @param boolean enable Determine whether the next button is enabled or not\r\n     */\r\n    public void setLastEnable(boolean enable) {\r\n        BreadBox box = ctx.getUserSession().get(Params.ACTIVE_BREADBOX);\r\n        if (enable) {\r\n            Crumb current = box.getCurrent();\r\n            int nextIdx = box.getCrumbs().indexOf(current) + 1;\r\n            Button nextBtn = box.getButtonCrumbs().get(nextIdx);\r\n            if (nextBtn.isEnabled()) {\r\n                enable = false;\r\n            }\r\n        }\r\n        box.setLastEnable(enable);\r\n    }\r\n\r\n    /**\r\n     * The setNextEnable function is used to set the next button's enable state.\r\n     *\r\n     * @param boolean enable Enable or disable the next button\r\n     */\r\n    public void setNextEnable(boolean enable) {\r\n        BreadBox box = ctx.getUserSession().get(Params.ACTIVE_BREADBOX);\r\n        box.setNextEnable(enable);\r\n    }\r\n\r\n    /**\r\n     * The setFinishEnable function sets the finishEnable variable in the BreadBox class to true or false.\r\n     *\r\n     * @param boolean enable Enable or disable the finish button\r\n     */\r\n    public void setFinishEnable(boolean enable) {\r\n        BreadBox box = ctx.getUserSession().get(Params.ACTIVE_BREADBOX);\r\n        box.setFinishEnable(enable);\r\n    }\r\n\r\n    /**\r\n     * The setExitEnable function sets the exitEnable boolean to true or false.\r\n     *\r\n     * @param boolean enable Enable or disable the exit button\r\n     */\r\n    public void setExitEnable(boolean enable) {\r\n        BreadBox box = ctx.getUserSession().get(Params.ACTIVE_BREADBOX);\r\n        box.setExitEnable(enable);\r\n    }\r\n\r\n    /**\r\n     * The resetPushCount function resets the prellCount of the active breadbox to 0.\r\n     */\r\n    public void resetPrellCount() {\r\n        BreadBox box = ctx.getUserSession().get(Params.ACTIVE_BREADBOX);\r\n        box.resetPrellCount();\r\n    }\r\n\r\n    /**\r\n     * The reloadInfoBox function is used to reload the info box in the UI.\r\n     *\r\n     * @param UI ui Access the ui object of the current session\r\n     */\r\n    public void reloadInfoBox(UI ui) {\r\n        ui.access(() -> {\r\n            InfoBox detail = ctx.getUserSession().get(Params.ACTIVE_INFO_BOX);\r\n            detail.reload();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The getParameter function is a helper function that returns the value of a parameter\r\n     * from an AstFile object.  The parameter is specified by its name, and the file\r\n     * from which to retrieve it is also specified.  If no such parameter exists in the file,\r\n     * then null will be returned.  This function can be used to retrieve parameters of any type;\r\n     * however, if you know what type your parameter should have (e.g., String or Integer), then you should use one of the other getParameter functions instead (e.g., getParameter(String) or getParameter(Integer)).\r\n     *\r\n     * @param FileParam                      param Specify the parameter to be retrieved\r\n     * @param com.hom.ebmw.jpa.model.AstFile file Get the file name\r\n     * @return The value of the parameter\r\n     */\r\n    public <E> E getParameter(FileParam param, com.hom.ebmw.jpa.model.AstFile file) {\r\n        return CompUtils.getParameter(getCtx(), param, file);\r\n    }\r\n\r\n    /**\r\n     * The setParameter function is used to set the value of a parameter in an AstFile.\r\n     *\r\n     * @param FileParam                      param Specify the parameter to be set\r\n     * @param E                              value Pass in the value of the parameter\r\n     * @param com.hom.ebmw.jpa.model.AstFile file Identify the file to which the parameter belongs\r\n     */\r\n    public <E> void setParameter(FileParam param, E value, com.hom.ebmw.jpa.model.AstFile file) {\r\n        CompUtils.setParameter(getCtx(), param, value, file);\r\n    }\r\n\r\n    /**\r\n     * The getStorage function returns the storage object for a given file.\r\n     *\r\n     * @param AstFile astFile Get the storage of a specific file\r\n     * @return The storage object for the given file\r\n     */\r\n    public Storage getStorage(AstFile astFile) {\r\n        return CompUtils.getStorage(getCtx(), astFile);\r\n    }\r\n\r\n    /**\r\n     * The saveStorage function saves the storage of a given AST file to a given source file.\r\n     *\r\n     * @param AstFile astFile Store the ast file\r\n     * @param File    srcFile Save the file to a specific location\r\n     */\r\n    public void saveStorage(AstFile astFile, File srcFile) {\r\n        CompUtils.saveStorage(ctx, astFile, srcFile);\r\n    }\r\n\r\n    /**\r\n     * The cloneParameter function takes two Assortment objects as parameters.\r\n     * It then clones all of the parameters from the first assortment to the second.\r\n     *\r\n     * @param Assortment fromAst Get the parameters from\r\n     * @param Assortment toAst Clone the parameters from the assortment fromast to\r\n     */\r\n    public void cloneParameter(Assortment fromAst, Assortment toAst) {\r\n        CompUtils.cloneAllParameter(ctx, fromAst, toAst);\r\n    }\r\n\r\n    /**\r\n     * The getAstFileTypeFromAssortment function takes in an assortment and a class type, and returns a list of AstFiles that are associated with the given assortment.\r\n     *\r\n     * @param Assortment     assortment Find the assortment in the database\r\n     * @param Class&lt;?&gt; clazz Determine the type of file to be returned\r\n     * @return A list of astfile objects\r\n     */\r\n    public List<AstFile> getAstFileTypeFromAssortment(Assortment assortment, Class<?> clazz) {\r\n        List<AstFile> files = new ArrayList<>();\r\n        List<AssortmentDatafile> xFiles = getServices().getAssortmentDataFileService().findAllByAssortment(assortment);\r\n        xFiles.forEach(item -> {\r\n            if (item.getAstFile().getClass().equals(clazz)) {\r\n                files.add(item.getAstFile());\r\n            }\r\n        });\r\n        return files;\r\n    }\r\n\r\n    /**\r\n     * The getCurrentDate function is used to retrieve the current date from a DataFile object.\r\n     *\r\n     * @param FileParam param Identify the parameter to be retrieved from the datafile dfile\r\n     * @param LocalDate defaultDate Set the default date for a file\r\n     * @param DataFile  dFile Determine which file the parameter is being retrieved from\r\n     * @return The current date of the file\r\n     */\r\n    public LocalDate getCurrentDate(FileParam param, LocalDate defaultDate, DataFile dFile) {\r\n        LocalDate result = null;\r\n        Object object = getParameter(param, dFile);\r\n        if (Objects.nonNull(object) && object instanceof String) {\r\n            result = defaultDate;\r\n            setParameter(param, defaultDate, dFile);\r\n        } else if (Objects.nonNull(object) && object instanceof LocalDate) {\r\n            result = (LocalDate) object;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The box function creates a VerticalLayout with the given components.\r\n     * The layout has no margin and padding of 0.5em on all sides.\r\n     *\r\n     * @param Component... components Pass in a variable number of components to the box method\r\n     * @return A verticallayout with the components added to it\r\n     */\r\n    public VerticalLayout box(Component... components) {\r\n        VerticalLayout box = new VerticalLayout();\r\n        box.setMargin(false);\r\n        box.add(components);\r\n        box.getStyle().set(\"padding\", \"0.1em 0.1em\");\r\n        return box;\r\n    }\r\n\r\n    /**\r\n     * The buttons function creates a HorizontalLayout and adds the components passed to it.\r\n     *\r\n     * @param Component... components Pass in any number of components to the buttons function\r\n     * @return A horizontallayout with the given components\r\n     */\r\n    public HorizontalLayout buttons(Component... components) {\r\n        HorizontalLayout buttons = new HorizontalLayout();\r\n        CompUtils.removeMSP(buttons, \"MSP\");\r\n        buttons.add(components);\r\n        return buttons;\r\n    }\r\n\r\n    /**\r\n     * The getCustomerLanguage function is used to retrieve the language setting for a given customer.\r\n     *\r\n     * @param final LocalCustomer curCustomer Determine the customer language\r\n     * @return A settingparameter&lt;customerlanguage&gt; object\r\n     */\r\n    public SettingParameter<CustomerLanguage> getCustomerLanguage(final LocalCustomer curCustomer) {\r\n        SettingParameter<CustomerLanguage> lang = null;\r\n        Optional<Setting> optPreSetting = getCtx().getServices().getSettingServices()\r\n                .findByIdentifier(SettingType.CUSTOMER_LANGUAGE.name());\r\n        if (optPreSetting.isPresent()) {\r\n            Setting setting = optPreSetting.get();\r\n            Optional<SettingParameter<CustomerLanguage>> optCusLang = getCtx().getServices()\r\n                    .getSettingParameterService().findByParamAndSetting(curCustomer.getCustomerId(), setting);\r\n            if (optCusLang.isPresent()) {\r\n                lang = optCusLang.get();\r\n            }\r\n        }\r\n        return lang;\r\n    }\r\n\r\n    /**\r\n     * The setSettingLanguage function is used to set the language of a file.\r\n     *\r\n     * @param DataFile item Get the current customer language\r\n     * @param Language value Set the language of the current customer\r\n     */\r\n    public void setSettingLanguage(DataFile item, Language value) {\r\n        setParameter(FileParam.LANGUAGE, value, item);\r\n        LocalCustomer curCustomer = getCtx().getSession().get(SessionParams.ACTIVE_CUSTOMER);\r\n        SettingParameter<CustomerLanguage> current = getCustomerLanguage(curCustomer);\r\n        Language curCusLang = null;\r\n        if (Objects.nonNull(current)) {\r\n            curCusLang = current.getValue().getLanguage();\r\n            if (!curCusLang.getKey().equals(value.getKey())) {\r\n                final ConfirmDialog dialog = languageDialog(current, value);\r\n                Button cancelBtn = new Button(getTranslation(TMS.GLB_BUTTON_CANCEL, getLocale(), getCtx()));\r\n                cancelBtn.addClickListener(event -> dialog.close());\r\n                dialog.setCancelButton(cancelBtn);\r\n                dialog.open();\r\n            }\r\n        } else {\r\n            Optional<Setting> optSetting = getCtx().getServices().getSettingServices()\r\n                    .findByIdentifier(SettingType.CUSTOMER_LANGUAGE.name());\r\n            optSetting.ifPresent(setting -> {\r\n                CustomerLanguage object = new CustomerLanguage();\r\n                SettingParameter<CustomerLanguage> param = new SettingParameter<>();\r\n                object.setCustomer(curCustomer);\r\n                object.setLanguage(value);\r\n                param.setValue(object);\r\n                param.setDisplayOrder(-1);\r\n                param.setParam(curCustomer.getCustomerId());\r\n                param.setSetting(setting);\r\n                getCtx().getServices().getSettingParameterService().save(param);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The languageDialog function creates a ConfirmDialog object that is used to confirm the user's choice of language.\r\n     * The dialog has two buttons: one for accepting the change and another for cancelling it.\r\n     *\r\n     * @param final SettingParameter&lt;CustomerLanguage&gt; current Set the current language\r\n     * @param final Language value Set the current language\r\n     * @return A confirmdialog object\r\n     */\r\n    private ConfirmDialog languageDialog(final SettingParameter<CustomerLanguage> current,\r\n                                         final Language value) {\r\n        final String description = getTranslation(TMS.FILE_EDIT_SETTING_LANGUAGE_DESCRIPTION, getLocale(), getCtx());\r\n        final String accept = getTranslation(TMS.GLB_BUTTON_ACCEPT, getLocale(), getCtx());\r\n        final ConfirmDialog confirmDialog = new ConfirmDialog();\r\n        confirmDialog.setHeader(\"\");\r\n        confirmDialog.setText(description);\r\n        confirmDialog.setConfirmText(accept);\r\n        confirmDialog.addConfirmListener(event -> dialogAcceptEvent(current, value));\r\n        return confirmDialog;\r\n    }\r\n\r\n    /**\r\n     * The dialogAcceptEvent function is called when the user clicks on the &quot;OK&quot; button in a dialog.\r\n     * The function takes two parameters: current, which is an object of type SettingParameter&lt;CustomerLanguage&gt;, and value, which is an object of type Language.\r\n     * The function creates a new CustomerLanguage object and assigns it to the variable named &quot;object&quot;.  It then sets that variable's language property to be equal to value.\r\n     * Next, it calls setValue() on param (which was initialized as current) with parameter object (the newly created CustomerLanguage).  Finally, it calls save() on getCtx().getServices\r\n     *\r\n     * @param final SettingParameter&lt;CustomerLanguage&gt; current Get the current value of the setting parameter\r\n     * @param final Language value Set the language in the settingparameter object\r\n     */\r\n    private void dialogAcceptEvent(final SettingParameter<CustomerLanguage> current, final Language value) {\r\n        CustomerLanguage object = new CustomerLanguage();\r\n        SettingParameter<CustomerLanguage> param = new SettingParameter<>();\r\n        param = current;\r\n        object = param.getValue();\r\n        object.setLanguage(value);\r\n        param.setValue(object);\r\n        getCtx().getServices().getSettingParameterService().save(param);\r\n    }\r\n\r\n    /**\r\n     * The getPanelHeader function returns a Paragraph object with the given name,\r\n     * using the current locale and context.\r\n     *\r\n     * @param String name Set the name of the panel header\r\n     * @return A paragraph object\r\n     */\r\n    public Paragraph getPanelHeader(String name) {\r\n        return CompUtils.getPanelHeader(name, getLocale(), getCtx());\r\n    }\r\n\r\n    /**\r\n     * The setLanguageParamByCustomer function sets the language parameter of a file to the customer's preferred language.\r\n     *\r\n     * @param DataFile file Set the language parameter\r\n     */\r\n    public void setLanguageParamByCustomer(DataFile file) {\r\n        LocalCustomer customer = getCtx().getSession().get(SessionParams.ACTIVE_CUSTOMER);\r\n        SettingParameter<CustomerLanguage> customerLanguage = getCustomerLanguage(customer);\r\n        if (Objects.nonNull(customerLanguage)) {\r\n            setParameter(FileParam.LANGUAGE, customerLanguage.getValue().getLanguage(), file);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The checkFilter function is used to check if the filter structure tree is valid.\r\n     * If it isn't, a dialog box will appear with an error message explaining what's wrong.\r\n     * The user can then choose to either cancel or accept the changes and continue on with their work.\r\n     *\r\n     * @param Command    callable Execute the code in the checkfilter function\r\n     * @param Assortment fromCopy Get the assortment id and to check if it is valid\r\n     * @param String     type Determine the type of filter that is being used\r\n     */\r\n    protected void checkFilter(Command callable, Assortment fromCopy, String type) {\r\n        String error = FilterRunUtils.isFilterStructureTreeValid(getCtx(), fromCopy, type, getLocale());\r\n        if (!error.isEmpty()) {\r\n            ConfirmDialog dialog = new ConfirmDialog();\r\n            dialog.setHeader(getTranslation(TMS.DIALOG_STRUCTURE_NOT_VALID, getLocale(), getCtx()));\r\n            dialog.setText(error);\r\n\r\n            dialog.setCancelable(true);\r\n            dialog.setCancelText(getTranslation(TMS.GLB_BUTTON_CANCEL, getLocale(), getCtx()));\r\n            dialog.addCancelListener(event -> dialog.close());\r\n\r\n            dialog.setConfirmText(getTranslation(TMS.GLB_BUTTON_ACCEPT, getLocale(), getCtx()));\r\n            dialog.addConfirmListener(event -> {\r\n                try {\r\n                    callable.execute();\r\n                } catch (Exception e) {\r\n                    log.debug(e.getMessage(), e);\r\n                    log.error(e.getLocalizedMessage());\r\n                }\r\n            });\r\n            dialog.open();\r\n        } else {\r\n            callable.execute();\r\n        }\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\Crumb.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\CustomerFilterField.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.jpa.dao.CustomerFilterDAO;\r\nimport com.hom.ebmw.jpa.model.*;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.ObjectType;\r\nimport com.hom.ebmw.utilities.enums.Params;\r\nimport com.hom.ebmw.utilities.enums.SessionParams;\r\nimport com.vaadin.flow.component.checkbox.Checkbox;\r\nimport com.vaadin.flow.component.combobox.ComboBox;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\n\r\nimport java.time.LocalDateTime;\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Objects;\r\nimport java.util.Optional;\r\nimport java.util.stream.Collectors;\r\n\r\npublic class CustomerFilterField extends HorizontalLayout {\r\n\r\n    private static final long serialVersionUID = 1L;\r\n\r\n    private final ComboBox<Filter> filterCbx = new ComboBox<>();\r\n    private Checkbox active;\r\n    private ImageButton saveBtn;\r\n    private final Context ctx;\r\n    private LocalCustomer customer;\r\n    private Optional<CustomerFilter> current = Optional.empty();\r\n    private Role role;\r\n    private final ObjectType type;\r\n\r\n    /**\r\n     * The CustomerFilterField function is a constructor for the CustomerFilterField class.\r\n     * It creates a new instance of the CustomerFilterField class and initializes it with\r\n     * values from the context, customer, type, filterCbx (a ComboBox), saveBtn (a Button), active (a Checkbox) and role variables.\r\n     *\r\n     * @param Context       ctx Get the user session and to translate the strings in this class\r\n     * @param LocalCustomer customer Get the customer id, which is used to filter the customers\r\n     * @return A horizontallayout\r\n     */\r\n    public CustomerFilterField(Context ctx, LocalCustomer customer) {\r\n        this.ctx = ctx;\r\n        this.customer = customer;\r\n        type = ctx.getUserSession().get(Params.ACTIVE_TYPE);\r\n        filterCbx.setLabel(getTranslation(TMS.CUSTOMER_FILTER_SELECTION, getLocale(), ctx));\r\n        CompUtils.addToolTip(ctx, filterCbx, TMS.CUSTOMER_FILTER_SELECTION_TOOLTIP);\r\n        filterCbx.setAllowCustomValue(false);\r\n        filterCbx.setClearButtonVisible(true);\r\n        setSaveBtn();\r\n        setActiveCbx();\r\n        defineRole();\r\n        reload(role);\r\n\r\n        HorizontalLayout box = new HorizontalLayout();\r\n        CompUtils.removeMSP(box, \"MSP\");\r\n        CompUtils.removeMSP(this, \"MP\");\r\n        active.getStyle().set(\"font-size\", \"26px\");\r\n        box.add(filterCbx, active);\r\n        box.setDefaultVerticalComponentAlignment(Alignment.END);\r\n\r\n        add(box, saveBtn);\r\n        setDefaultVerticalComponentAlignment(Alignment.END);\r\n    }\r\n\r\n\r\n    /**\r\n     * The initCustomerFilter function is called by the initialize function.\r\n     * It initializes the customer filter combo box with a list of filters that are associated with the current user's role and type.\r\n     * The first item in this list is set as the current filter, which will be used to populate other controls on this page.\r\n     */\r\n    private void initCustomerFilter() {\r\n        if (Objects.nonNull(customer)) {\r\n            List<CustomerFilter> filters = ctx.getServices().getCustomerFilterService().findAllByCustomerNrAndRoleAndDeleteByIsNullAndType(customer.getCustomerId(), role, type.name());\r\n            current = filters.stream().findFirst();\r\n            current.ifPresent(item -> filterCbx.setValue(item.getFilter()));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The save function saves the current filter to the database.\r\n     * If there is no current filter, it will find all filters for this customer and role and type,\r\n     * then set the first one as current. Then it will delete that filter from the database by setting its deleteBy field to be equal to\r\n     * ctx.getSession().getCurrentUser(ctx) (the user currently logged in), and its deleteOn field to be equal to LocalDateTime.now() (the time at which this function was called).\r\n     * Finally, if a new value has been selected in the dropdown menu of filters, it\r\n     */\r\n    private void save() {\r\n        CustomerFilterDAO customerFilterService = ctx.getServices().getCustomerFilterService();\r\n        if (!current.isPresent()) {\r\n            List<CustomerFilter> filters = customerFilterService.findAllByCustomerNrAndRoleAndDeleteByIsNullAndType(customer.getCustomerId(), role, type.name());\r\n            current = filters.stream().findFirst();\r\n        }\r\n        current.ifPresent(item -> {\r\n            User user = ctx.getSession().getCurrentUser(ctx);\r\n            item.setDeleteBy(user);\r\n            item.setDeleteOn(LocalDateTime.now());\r\n            customerFilterService.save(item);\r\n        });\r\n\r\n        if (Objects.nonNull(filterCbx.getValue())) {\r\n            CustomerFilter filter = new CustomerFilter();\r\n            filter.setCustomerNr(customer.getCustomerId());\r\n            filter.setFilter(filterCbx.getValue());\r\n            filter.setRole(role);\r\n            filter.setType(type);\r\n            filter.setActive(active.getValue().booleanValue());\r\n            current = Optional.of(customerFilterService.save(filter));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The setActiveCbx function sets the active checkbox to a new Checkbox object.\r\n     * It also adds a tooltip to the checkbox using CompUtils.addToolTip().\r\n     */\r\n    private void setActiveCbx() {\r\n        active = new Checkbox();\r\n        CompUtils.addToolTip(ctx, active, TMS.CUSTOMER_FILTER_ACTIVE_TOOLTIP);\r\n    }\r\n\r\n    /**\r\n     * The setSaveBtn function sets the save button to a new ImageButton with two images, one for when it is enabled and one for when it is disabled.\r\n     * It also adds a click listener that calls the save function.\r\n     */\r\n    private void setSaveBtn() {\r\n        saveBtn = new ImageButton(CompUtils.getSaveFloppy(ctx), CompUtils.getDisableSaveFloppy(ctx));\r\n        saveBtn.addClickListener(event -> save());\r\n    }\r\n\r\n    /**\r\n     * The reload function is used to refresh the table with new data.\r\n     * It does this by clearing all rows from the table, then adding each row of data\r\n     * from the database into a new row in the table.  This function is called when:\r\n     * 1) The user clicks on a different role in the dropdown menu (the reload(Role role) function above calls this one).\r\n     * 2) The user adds or deletes an item from their inventory (the addItem and deleteItem functions below call this one).\r\n     *\r\n     * @param Role role Set the filter box to a specific role\r\n     */\r\n    public void reload(Role role) {\r\n        this.role = role;\r\n        setFilterBox(role);\r\n        reload();\r\n    }\r\n\r\n    /**\r\n     * The reload function is used to update the GUI with new information.\r\n     * It is called whenever a change in the customer's data occurs, such as\r\n     * when a new customer logs in or when an existing customer makes changes to their account.\r\n     *\r\n     * @param LocalCustomer customer Define the role of the user\r\n     */\r\n    public void reload(LocalCustomer customer) {\r\n        this.customer = customer;\r\n        defineRole();\r\n        reload();\r\n    }\r\n\r\n    /**\r\n     * The reload function is used to update the values of the fields in this view.\r\n     * It is called when a new item is selected from the list, or when an existing\r\n     * item has been edited and saved. The function first clears all fields by setting them to null, then it sets up a new filter for customers using initCustomerFilter(), and finally it checks if there are any items currently selected in the list (current). If so, it sets active to true if that item's active field is true; otherwise false. It also sets filterCbx equal to that same customer's filter value.\r\n     */\r\n    public void reload() {\r\n        filterCbx.setValue(null);\r\n        active.setValue(false);\r\n        initCustomerFilter();\r\n        current.ifPresent(item -> {\r\n            active.setValue(item.isActive());\r\n            filterCbx.setValue(item.getFilter());\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The setFilterBox function is used to set the filterCbx ComboBox with all of the filters that are associated with a given role.\r\n     *\r\n     * @param Role role Filter the list of filters to only those that are associated with the role\r\n     */\r\n    private void setFilterBox(Role role) {\r\n        filterCbx.setItems(new ArrayList<>());\r\n        List<Filter> filters = ctx.getServices().getFilterService().findAllByTeamAndDeleteByIsNull(role);\r\n        filters = filters.stream().filter(item -> item.getSortType().equals(type)).collect(Collectors.toList());\r\n        filterCbx.setItems(filters);\r\n        filterCbx.setItemLabelGenerator(Filter::getNameWithPrefix);\r\n    }\r\n\r\n    /**\r\n     * The defineRole function is used to set the role of the current user.\r\n     * If there is no active role, then it will be set to the default role of that user.\r\n     */\r\n    private void defineRole() {\r\n        Role cRole = ctx.getSession().get(SessionParams.ACTIVE_ROLE);\r\n        if (Objects.isNull(cRole)) {\r\n            User user = ctx.getSession().getCurrentUser(ctx);\r\n            cRole = user.getRole();\r\n        }\r\n        this.role = cRole;\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\CustomerFilterField.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\DownloadButton.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.dialog.Dialog;\r\nimport com.vaadin.flow.component.html.Div;\r\nimport com.vaadin.flow.component.html.Label;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.progressbar.ProgressBar;\r\nimport lombok.extern.slf4j.Slf4j;\r\nimport org.vaadin.stefan.LazyDownloadButton;\r\n\r\nimport java.io.File;\r\nimport java.io.IOException;\r\nimport java.io.InputStream;\r\nimport java.nio.file.Files;\r\nimport java.util.Objects;\r\nimport java.util.concurrent.Callable;\r\nimport java.util.function.Supplier;\r\n\r\n@Slf4j\r\n@SuppressWarnings(\"serial\")\r\npublic class DownloadButton extends Div {\r\n    private Button disable = null;\r\n    private LazyDownloadButton active = null;\r\n    private Dialog waiting = null;\r\n    private UI ui = null;\r\n    private String toolTipName = \"\";\r\n    private final Context ctx;\r\n\r\n    /**\r\n     * The DownloadButton function is a constructor for the DownloadButton class.\r\n     * It creates a button that can be used to download data from the database.\r\n     *\r\n     * @param Context ctx Get the current context\r\n     * @param String  tmsToolTipName Set the tooltip of the button\r\n     * @return A downloadbutton object\r\n     * @docauthor Trelent\r\n     */\r\n    public DownloadButton(Context ctx, String tmsToolTipName) {\r\n        this.ctx = ctx;\r\n        this.toolTipName = tmsToolTipName;\r\n        disable = new Button(VaadinIcon.DOWNLOAD.create());\r\n        CompUtils.addToolTip(ctx, disable, tmsToolTipName);\r\n        disable.setEnabled(false);\r\n        add(disable);\r\n        waiting = waitDialog(getTranslation(TMS.DOWNLOAD_PREPARE_EXPORT, getLocale(), ctx));\r\n        ui = UI.getCurrent();\r\n    }\r\n\r\n    /**\r\n     * The reloadAsStream function is used to reload the download button with a new file.\r\n     * It takes two parameters:\r\n     * fileNameCallback - A Supplier&lt;String&gt; that returns the name of the file to be downloaded.\r\n     * inputStream - A Callable&lt;InputStream&gt; that returns an InputStream for reading from a source, such as a FileInputStream or ByteArrayInputStream.\r\n     *\r\n     * @param Supplier&lt;String&gt;      fileNameCallback Get the name of the file to be downloaded\r\n     * @param Callable&lt;InputStream&gt; inputStream Get the input stream from the file\r\n     * @return A lazydownloadbutton\r\n     * @docauthor Trelent\r\n     */\r\n    public void reloadAsStream(Supplier<String> fileNameCallback, Callable<InputStream> inputStream) {\r\n        removeAll();\r\n        active = new LazyDownloadButton(VaadinIcon.DOWNLOAD.create(), fileNameCallback, () -> getAsStream(inputStream));\r\n        if (!toolTipName.isEmpty())\r\n            CompUtils.addToolTip(ctx, active, toolTipName);\r\n        active.addClickListener(event -> ui.access(() -> waiting.open()));\r\n        ui.access(() -> {\r\n            add(active);\r\n            active.setEnabled(true);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The reloadAsFile function is used to reload the file that is being downloaded.\r\n     * It takes in two parameters: a Supplier&lt;String&gt; and a Callable&lt;File&gt;. The first parameter,\r\n     * fileNameCallBack, returns the name of the file that will be downloaded. The second parameter,\r\n     * file, returns an instance of File which contains information about what type of data it holds (e.g., .pdf).\r\n     *\r\n     * @param Supplier&lt;String&gt; fileNameCallBack Get the file name\r\n     * @param Callable&lt;File&gt;   file Get the file to be downloaded\r\n     * @return A lazydownloadbutton\r\n     * @docauthor Trelent\r\n     */\r\n    public void reloadAsFile(Supplier<String> fileNameCallBack, Callable<File> file) {\r\n        removeAll();\r\n        final String fileName = fileNameCallBack.get().replaceAll(\"[/\\\\\\\\&:?! ]\", \"_\");\r\n        log.debug(\"FILENAME: \" + fileName);\r\n        active = new LazyDownloadButton(VaadinIcon.DOWNLOAD.create(), () -> fileName, () -> getAsFile(file));\r\n        active.setEnabled(true);\r\n        if (!toolTipName.isEmpty())\r\n            CompUtils.addToolTip(ctx, active, toolTipName);\r\n        active.addClickListener(event -> ui.access(() -> waiting.open()));\r\n        ui.access(() -> add(active));\r\n\r\n    }\r\n\r\n    /**\r\n     * The getAsStream function is a helper function that takes in an inputStream and returns the stream.\r\n     * It also closes the waiting window when it's done.\r\n     *\r\n     * @param Callable&lt;InputStream&gt; inputStream Create a new inputstream object\r\n     * @return An inputstream object\r\n     * @docauthor Trelent\r\n     */\r\n    private InputStream getAsStream(Callable<InputStream> inputStream) {\r\n        InputStream stream = null;\r\n        try {\r\n            stream = inputStream.call();\r\n        } catch (IOException e) {\r\n            log.error(e.getLocalizedMessage());\r\n        } catch (Exception e) {\r\n            log.error(e.getLocalizedMessage());\r\n        }\r\n        ui.access(() -> waiting.close());\r\n        return stream;\r\n    }\r\n\r\n    /**\r\n     * The getAsFile function is a helper function that takes in a Callable&lt;File&gt; object and returns an InputStream.\r\n     * The getAsFile function first tries to call the file object, which will return a File.\r\n     * Then it creates an InputStream from the File's path using Files.newInputStream(fi.toPath()).\r\n     * If there are any exceptions, they are caught and logged with log4j2 (logging library).\r\n     *\r\n     * @param Callable&lt;File&gt; file Get the file from a different thread\r\n     * @return A file\r\n     * @docauthor Trelent\r\n     */\r\n    private InputStream getAsFile(Callable<File> file) {\r\n        InputStream stream = null;\r\n        try {\r\n            File fi = file.call();\r\n            stream = Files.newInputStream(fi.toPath());\r\n        } catch (IOException e) {\r\n            log.error(e.getLocalizedMessage());\r\n        } catch (Exception e) {\r\n            log.error(e.getLocalizedMessage());\r\n        }\r\n        ui.access(() -> waiting.close());\r\n        return stream;\r\n    }\r\n\r\n    /**\r\n     * The waitDialog function creates a dialog box with the given label and an indeterminate progress bar.\r\n     *\r\n     * @param String label Set the title of the dialog\r\n     * @return A dialog object\r\n     * @docauthor Trelent\r\n     */\r\n    private Dialog waitDialog(String label) {\r\n        Dialog dialog = new Dialog();\r\n        Div body = new Div();\r\n        Label title = new Label(label);\r\n        ProgressBar progress = new ProgressBar();\r\n        progress.setIndeterminate(true);\r\n        body.add(title, progress);\r\n        dialog.add(body);\r\n        dialog.setCloseOnOutsideClick(false);\r\n        dialog.setCloseOnEsc(false);\r\n        return dialog;\r\n    }\r\n\r\n    /**\r\n     * The setEnabled function is used to enable or disable the button.\r\n     * If the active button is not null and enabled, then it will remove\r\n     * the active button and add a disabled one. Otherwise, if there is an\r\n     * active button, it will set that to be enabled or disabled depending on\r\n     * what was passed in as a parameter. Finally, if there isn't an active\r\n     * button (meaning that this function has been called before), then we just\r\n     * set the disable variable to be false because we don't want anything else happening.\r\n     *\r\n     * @param boolean enabled Determine if the button is enabled or not\r\n     * @return The value of the active\r\n     * @docauthor Trelent\r\n     */\r\n    @Override\r\n    public void setEnabled(boolean enabled) {\r\n        if (Objects.nonNull(active) && !enabled) {\r\n            remove(active);\r\n            add(disable);\r\n        } else if (Objects.nonNull(active)) {\r\n            active.setEnabled(enabled);\r\n        } else {\r\n            disable.setEnabled(false);\r\n        }\r\n    }\r\n\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\DownloadButton.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\ExportPanel.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.jpa.model.ArticleBase;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.ExcelUtils;\r\nimport com.hom.ebmw.utilities.constans.ASTConst;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.FilterStatus;\r\nimport com.vaadin.flow.component.Key;\r\nimport com.vaadin.flow.component.accordion.Accordion;\r\nimport com.vaadin.flow.component.accordion.AccordionPanel;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.checkbox.Checkbox;\r\nimport com.vaadin.flow.component.grid.Grid;\r\nimport com.vaadin.flow.component.html.Div;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.orderedlayout.FlexComponent.Alignment;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\n\r\nimport java.util.List;\r\nimport java.util.stream.Collectors;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class ExportPanel\r\n        extends\r\n        Div {\r\n    private Checkbox valid;\r\n    private Grid<ArticleBase> baseGrid;\r\n    private final FilterStatus status;\r\n    private String containsInComment = \"\";\r\n    private DownloadButton downloadBtn = null;\r\n    private Context ctx = new Context();\r\n\r\n    /**\r\n     * The ExportPanel function creates a panel that allows the user to export their filtered data.\r\n     * The ExportPanel function takes in three parameters:\r\n     *\r\n     * @param Context      ctx Access the resources of the application\r\n     * @param FilterStatus status Set the status of the filter\r\n     * @param String       containsInComment Filter the list of\r\n     * @return A jpanel\r\n     */\r\n    public ExportPanel(\r\n            Context ctx,\r\n            FilterStatus status,\r\n            String containsInComment) {\r\n        this.status = status;\r\n        this.containsInComment = containsInComment;\r\n        this.ctx = ctx;\r\n        initLayout();\r\n    }\r\n\r\n    /**\r\n     * The ExportPanel function creates a panel that allows the user to export their data in various formats.\r\n     * The ExportPanel function is called by the FilterStatus class, and it takes in a Context object and\r\n     * a FilterStatus object as parameters. It then initializes its layout using initLayout().\r\n     *\r\n     * @param Context      ctx Get the current context of the application\r\n     * @param FilterStatus status Get the current filter status\r\n     * @return A jpanel object\r\n     */\r\n    public ExportPanel(\r\n            Context ctx,\r\n            FilterStatus status) {\r\n        this.status = status;\r\n        this.ctx = ctx;\r\n\r\n        initLayout();\r\n    }\r\n\r\n\r\n    /**\r\n     * The getName function returns a string that is used to identify the panel.\r\n     * The name of the panel is set by the status and containsInComment variables.\r\n     * If containsInComment is empty, then only status will be used to determine\r\n     * what name should be returned. Otherwise, both variables are combined into\r\n     * one string with &quot;-&quot; separating them (e.g., &quot;export-panel-status-containsInComment&quot;).\r\n     *\r\n     * @return The name of the panel\r\n     */\r\n    private String getName() {\r\n        String result = TMS.setExportFilterStatus(status);\r\n        if (!containsInComment.isEmpty()) {\r\n            result = \"export-panel-\" + containsInComment.replace(\" \", \"-\").replace(\"_\", \"-\");\r\n        }\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The initLayout function is responsible for setting up the layout of the component.\r\n     * It creates a new Grid, and adds two columns to it: one for article numbers, and one\r\n     * for comments. The grid is then added to a VerticalLayout called body along with a\r\n     * Checkbox called valid that has an onClick listener attached to it that sets its value\r\n     * to true if it's not already true (and makes sure that the checkbox can't be unchecked).\r\n     */\r\n    private void initLayout() {\r\n        downloadBtn = new DownloadButton(ctx, getName() + \"-download-tooltip\");\r\n        VerticalLayout body = new VerticalLayout();\r\n\r\n        baseGrid = new Grid<>();\r\n        baseGrid.addColumn(ArticleBase::getArticleNr)\r\n                .setHeader(getTranslation(TMS.EXPORT_GRID_ARTICLE_NR, getLocale(), ctx))\r\n                .setFlexGrow(2)\r\n                .setResizable(true)\r\n                .setKey(\"articleNr\");\r\n        baseGrid.addColumn(ArticleBase::getComment)\r\n                .setHeader(getTranslation(TMS.EXPORT_GRID_COMMENT, getLocale(), ctx))\r\n                .setFlexGrow(4)\r\n                .setResizable(true)\r\n                .setKey(\"comment\");\r\n\r\n        valid = new Checkbox(getTranslation(TMS.EXPORT_ACCEPT, getLocale(), ctx));\r\n        valid.setValue(false);\r\n        valid.setId(\"cbx-\" + getName().toLowerCase() + \"-valid\");\r\n        CompUtils.addToolTip(ctx, valid, getName() + \"-valid-tooltip\");\r\n        valid.addClickShortcut(Key.KEY_A);\r\n        valid.addClickListener(event -> {\r\n            if (!event.getSource().getValue().booleanValue()) {\r\n                valid.setValue(true);\r\n                valid.setReadOnly(true);\r\n            }\r\n        });\r\n\r\n        HorizontalLayout header = new HorizontalLayout();\r\n        CompUtils.removeMSP(header, \"MP\");\r\n        header.setAlignItems(Alignment.CENTER);\r\n        header.add(downloadBtn, valid);\r\n\r\n\r\n        CompUtils.removeMSP(body, \"MP\");\r\n        body.add(header, baseGrid);\r\n        add(body);\r\n    }\r\n\r\n    /**\r\n     * The isValid function returns a boolean value that indicates whether or not the\r\n     * current state of the object is valid.  This function is used to determine if\r\n     * an object has been initialized properly and can be used for its intended purpose.\r\n     *\r\n     * @return A boolean value\r\n     */\r\n    public boolean isValid() {\r\n        return valid.getValue();\r\n    }\r\n\r\n    /**\r\n     * The setBoxVisible function is used to set the visibility of a box in an accordion.\r\n     *\r\n     * @param Accordion accordion Get the children of the accordion\r\n     * @param boolean   valid Determine whether the box is visible or not\r\n     */\r\n    public void setBoxVisible(Accordion accordion, boolean valid) {\r\n        accordion.getChildren().forEach(item -> {\r\n            if (item instanceof AccordionPanel) {\r\n                AccordionPanel panel = (AccordionPanel) item;\r\n                panel.getContent().forEach(child -> {\r\n                    if (child.equals(this)) {\r\n                        item.setVisible(valid);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The reloadArticles function is used to reload the articles in the grid.\r\n     *\r\n     * @param Accordion               accordion Set the visibility of the accordion\r\n     * @param List&lt;ArticleBase&gt; articles Set the data provider of the grid\r\n     */\r\n    public void reloadArticles(Accordion accordion, List<ArticleBase> articles) {\r\n        setBoxVisible(accordion, false);\r\n        Button result = new Button(VaadinIcon.DOWNLOAD.create());\r\n        if (!articles.isEmpty()) {\r\n            setBoxVisible(accordion, true);\r\n            baseGrid.setDataProvider(DataProvider.ofCollection(articles));\r\n            String filename = \"\";\r\n            if (containsInComment.length() > 0) {\r\n                filename = status.name() + \"_\" + containsInComment + \".xlsx\";\r\n            } else {\r\n                filename = status.name() + \".xlsx\";\r\n            }\r\n            String name = filename;\r\n            downloadBtn.reloadAsFile(() -> name,\r\n                    () -> ExcelUtils.writeExcelFileOfArticleListPlain(ctx, articles, ASTConst.DEFAULT, containsInComment.isEmpty() ? status.name() + \"_\" + containsInComment : status.name()));\r\n        } else {\r\n            result.setEnabled(false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The reload function is called when the user clicks on a tab in the accordion.\r\n     * It takes an Accordion object and a List of ArticleBase objects as parameters.\r\n     * The function first sets all boxes to invisible, then filters out all articles that do not have\r\n     * their foundArticleFilterStatus equal to this status (the status of this box). Then it creates a new button with an arrow icon, which will be used later if there are no articles in the list. If there are any articles left after filtering, it makes the box visible again and reloads its grid with these filtered-out article bases as data provider.\r\n     *\r\n     * @param Accordion               accordion Set the visibility of the accordion item\r\n     * @param List&lt;ArticleBase&gt; articles Filter the articles by status and containsincomment\r\n     */\r\n    public void reload(Accordion accordion, List<ArticleBase> articles) {\r\n        setBoxVisible(accordion, false);\r\n        List<ArticleBase> bases = articles.parallelStream()\r\n                .filter(article -> article.getFoundArticleFilterStatus().equals(status))\r\n                .collect(Collectors.toList());\r\n        Button result = new Button(VaadinIcon.DOWNLOAD.create());\r\n        if (!bases.isEmpty()) {\r\n            setBoxVisible(accordion, true);\r\n            baseGrid.setDataProvider(DataProvider.ofCollection(bases));\r\n            String filename = \"\";\r\n            if (containsInComment.length() > 0) {\r\n                filename = status.name() + \"_\" + containsInComment + \".xlsx\";\r\n            } else {\r\n                filename = status.name() + \".xlsx\";\r\n            }\r\n            String name = filename;\r\n            downloadBtn.reloadAsFile(() -> name,\r\n                    () -> ExcelUtils.writeExcelFileOfArticleListPlain(ctx, bases, ASTConst.DEFAULT, containsInComment.isEmpty() ? status.name() + \"_\" + containsInComment : status.name()));\r\n        } else {\r\n            result.setEnabled(false);\r\n        }\r\n    }\r\n}\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\ExportPanel.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\FilterCrumb.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.jpa.dao.impl.ArticleBaseRepository;\r\nimport com.hom.ebmw.jpa.dao.impl.FilterBaseGetRepository;\r\nimport com.hom.ebmw.jpa.model.ArticleBase;\r\nimport com.hom.ebmw.jpa.model.Assortment;\r\nimport com.hom.ebmw.jpa.model.Filterbase;\r\nimport com.hom.ebmw.jpa.model.Setting;\r\nimport com.hom.ebmw.pojo.Context;\r\nimport com.hom.ebmw.utilities.AstNotification;\r\nimport com.hom.ebmw.utilities.InfoReload;\r\nimport com.hom.ebmw.utilities.constans.TMS;\r\nimport com.hom.ebmw.utilities.enums.FilterStatus;\r\nimport com.hom.ebmw.utilities.enums.Params;\r\nimport com.hom.ebmw.view.components.interfaces.GridReloadService;\r\nimport com.hom.ebmw.view.filter.*;\r\nimport com.vaadin.flow.component.Component;\r\nimport com.vaadin.flow.component.UI;\r\nimport com.vaadin.flow.component.accordion.Accordion;\r\nimport com.vaadin.flow.component.accordion.AccordionPanel;\r\nimport com.vaadin.flow.data.provider.DataProvider;\r\nimport com.vaadin.flow.data.provider.ListDataProvider;\r\nimport lombok.Getter;\r\nimport lombok.Setter;\r\nimport lombok.extern.slf4j.Slf4j;\r\n\r\nimport java.util.*;\r\nimport java.util.stream.Collectors;\r\n\r\n@Slf4j\r\npublic class FilterCrumb extends Crumb {\r\n\r\n    /**\r\n     *\r\n     */\r\n    private static final long serialVersionUID = 1L;\r\n\r\n    private @Getter\r\n    @Setter Accordion accordion;\r\n\r\n    private @Getter FilterProgressLoader assigmnedPanel;\r\n    private @Getter FilterProgressLoader infoTypePanel;\r\n    private @Getter FilterProgressLoader structurePanel;\r\n    private @Getter FilterProgressLoader articleClassPanel;\r\n    private @Getter FilterProgressLoader ghsPanel;\r\n    private @Getter FilterProgressLoader configPanel;\r\n    private @Getter FilterProgressLoader brandsPanel;\r\n    private @Getter FilterProgressLoader s3CatalogPanel;\r\n    private @Getter FilterProgressLoader freePanel;\r\n    private @Getter FilterProgressLoader intrastatPanel;\r\n    private @Getter FilterProgressLoader eClassPanel;\r\n    private @Getter FilterProgressLoader individualPanel;\r\n    private @Getter FilterProgressLoader removePanel;\r\n    private @Getter FilterProgressLoader importPanel;\r\n\r\n    private @Getter ExportPanel notInPimPanel;\r\n    private @Getter ExportPanel notApprovePanel;\r\n    private @Getter ExportPanel invalidVtlStatusPanel;\r\n    private @Getter ExportPanel notInPositivPanel;\r\n    private @Getter ExportPanel removeByPositivPanel;\r\n\r\n    private @Getter FilterGrid assigmendGrid;\r\n    private @Getter FilterGrid infoTypeGrid;\r\n    private @Getter StructureTreeFilterGrid structureGrid;\r\n    private @Getter FilterGrid articleClassGrid;\r\n    private @Getter FilterGrid ghsGrid;\r\n    private @Getter FilterGrid configGrid;\r\n    private @Getter FilterGrid brandsGrid;\r\n    private @Getter FilterGrid s3CatalogGrid;\r\n    private @Getter FilterGrid freeGrid;\r\n    private @Getter FilterGrid intrastatGrid;\r\n    private @Getter FilterStructureGrid eClassGrid;\r\n    private @Getter FilterZinfoGrid zinfoGrid;\r\n    private @Getter FilterIndividualGrid individualGrid;\r\n    private @Getter FilterRemoveGrid removeGrid;\r\n    private @Getter FilterImportGrid importGrid;\r\n    private Locale locale = null;\r\n\r\n    private @Getter UI crumbUI;\r\n\r\n    /**\r\n     * The FilterCrumb function is used to create a filter crumb that can be added to the accordion.\r\n     * The function takes in a string parameter, which is the name of the filter, and returns an AccordionItem object.\r\n     *\r\n     * @param Context   ctx Get the usersession from the context\r\n     * @param Accordion accordion Set the accordion to full width\r\n     * @return A filtercrumb object\r\n     * @docauthor Trelent\r\n     */\r\n    public FilterCrumb(Context ctx, Accordion accordion) {\r\n        super(ctx);\r\n        this.accordion = accordion;\r\n        accordion.setWidthFull();\r\n        crumbUI = UI.getCurrent();\r\n        if (Objects.isNull(crumbUI)) {\r\n            crumbUI = ctx.getUserSession().get(Params.ACTIVE_UI);\r\n        }\r\n        locale = getSession().getLocale(ctx);\r\n\r\n    }\r\n\r\n    /**\r\n     * The buildStructurePanel function creates a new AccordionPanel, which is a type of panel that can be expanded and collapsed.\r\n     * It then creates the structurePanel, which is an instance of FilterProgressLoader. This class allows for the loading of data into\r\n     * the grid to be displayed in stages rather than all at once. The structureGrid variable is created as an instance of StructureTreeFilterGrid,\r\n     * which extends from TreeFilterGrid and implements IReloadableInfoProvider (which provides information about how to reload data).\r\n     * The InfoReload function reloads the grid with new information based on context variables (such as locale\r\n     *\r\n     * @return A panel that contains a grid\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildStructurePanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        structurePanel = new FilterProgressLoader();\r\n        structureGrid = new StructureTreeFilterGrid(getCtx());\r\n        InfoReload.reload(getCtx(), structureGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_STRUCTURE, locale, getCtx()));\r\n\r\n        structurePanel.add(structureGrid);\r\n        panel.addContent(structurePanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildArticleClassPanel function creates a new AccordionPanel, which is a container for the article class filter.\r\n     * It also creates an instance of FilterProgressLoader and FilterGrid, which are used to display the article class filter.\r\n     * The function then adds these components to the panel and returns it.\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildArticleClassPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        articleClassPanel = new FilterProgressLoader();\r\n        articleClassGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), articleClassGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_ARTICLE_CLASS, locale, getCtx()));\r\n\r\n        articleClassPanel.add(articleClassGrid);\r\n        panel.addContent(articleClassPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildInfoTypePanel function creates a new AccordionPanel, which is a container for the FilterProgressLoader and\r\n     * FilterGrid. The InfoReload class is used to reload the grid with data from the database. The panel's summary text\r\n     * is set to &quot;Info Type&quot; in English or whatever translation exists for that string in other languages. Finally, the\r\n     * panel's content (the FilterProgressLoader) has its child component (the FilterGrid) added to it before being returned\r\n     *\r\n     * @return An accordionpanel object\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildInfoTypePanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        infoTypePanel = new FilterProgressLoader();\r\n        infoTypeGrid = new FilterGrid(getCtx(), true);\r\n        InfoReload.reload(getCtx(), infoTypeGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_INFO_TYPE, locale, getCtx()));\r\n\r\n        infoTypePanel.add(infoTypeGrid);\r\n        panel.addContent(infoTypePanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildGHSCodePanel function creates a new AccordionPanel object, which is used to create the GHS Code panel.\r\n     * The function then creates a FilterProgressLoader object and assigns it to the ghsPanel variable.\r\n     * It also creates a FilterGrid object and assigns it to the ghsGrid variable.  The InfoReload class is called on this grid, passing in getCtx() as an argument for both parameters of its reload method.\r\n     * Then, setSummaryText is called on panel with TMS_FILTER_GHS_CODES as an argument (which will be translated into English).  This sets the\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildGHSCodePanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        ghsPanel = new FilterProgressLoader();\r\n        ghsGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), ghsGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_GHS_CODES, locale, getCtx()));\r\n\r\n        ghsPanel.add(ghsGrid);\r\n        panel.addContent(ghsPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildConfigPanel function creates a new AccordionPanel, which is a panel that can be expanded and collapsed.\r\n     * It then creates the FilterProgressLoader configPanel, which is used to display the progress of loading data into\r\n     * the grid. The function then creates a new FilterGrid object called configGrid, passing in two parameters: getCtx()\r\n     * and false (the second parameter indicates whether or not this grid will be editable). The InfoReload class's reload\r\n     * method is called on this grid with two parameters: getCtx() and configGrid's Grid object. This causes an asynchronous\r\n     * call to\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildConfigPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        configPanel = new FilterProgressLoader();\r\n        configGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), configGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_CONFIGURABLE_ARTICLES, locale, getCtx()));\r\n\r\n        configPanel.add(configGrid);\r\n        panel.addContent(configPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildBrandsPanel function creates a new AccordionPanel, which is a container for the FilterProgressLoader and\r\n     * FilterGrid objects. The AccordionPanel object is then returned to the caller of this function.\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildBrandsPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        brandsPanel = new FilterProgressLoader();\r\n        brandsGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), brandsGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_BRANDS, locale, getCtx()));\r\n\r\n        brandsPanel.add(brandsGrid);\r\n        panel.addContent(brandsPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The builds3CatalogPanel function creates a new AccordionPanel, which is a container for the FilterProgressLoader and\r\n     * FilterGrid objects. The function then sets the summary text of the panel to be &quot;S3 Catalogs&quot; in English or whatever\r\n     * translation is available in other languages. It then adds the s3CatalogPanel object to itself, and returns it as an\r\n     * AccordionPanel object. This function will be called by buildAccordionPanels() when building up all of its panels into\r\n     * one accordian-style menu on screen.  \t\t\t\t&lt;br&gt; &lt;br&gt; &lt;b&gt;Note\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel builds3CatalogPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        s3CatalogPanel = new FilterProgressLoader();\r\n        s3CatalogGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), s3CatalogGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_S3_CATALOGS, locale, getCtx()));\r\n        s3CatalogPanel.add(s3CatalogGrid);\r\n        panel.addContent(s3CatalogPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildNotFreePanel function creates a new AccordionPanel object, which is used to create the\r\n     * accordion panel that will contain the not free filter grid. The function then creates a new FilterProgressLoader\r\n     * object and assigns it to the freePanel variable. It also creates a new FilterGrid object with false as its parameter,\r\n     * and assigns it to the freeGrid variable. The InfoReload class's reload method is called on this grid using getCtx() as its first parameter,\r\n     * and passing in getGrid() from this same grid as its second parameter (this allows for reloading of data).\r\n     *\r\n     * @return An accordionpanel object\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildNotFreePanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        freePanel = new FilterProgressLoader();\r\n        freeGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), freeGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_NOT_FREE, locale, getCtx()));\r\n\r\n        freePanel.add(freeGrid);\r\n        panel.addContent(freePanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildIntraStatPanel function creates a new AccordionPanel, which is a container for the Intrastat grid.\r\n     * The panel has an accordion-style header that can be clicked to expand or collapse the panel's contents.\r\n     * The function also creates a FilterProgressLoader and adds it to the AccordionPanel, then adds an InfoReload object\r\n     * (which reloads data from the database) to this loader. Finally, it returns its newly created AccordionPanel object.\r\n     *\r\n     * @return A panel, which is then added to the accordion\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildIntraStatPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        intrastatPanel = new FilterProgressLoader();\r\n        intrastatGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), intrastatGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_INTRA_STAT, locale, getCtx()));\r\n\r\n        intrastatPanel.add(intrastatGrid);\r\n        panel.addContent(intrastatPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildEClassPanel function creates a new AccordionPanel, which is a type of panel that can be expanded and collapsed.\r\n     * It then creates an instance of the FilterProgressLoader class, which is used to display progress bars for loading data.\r\n     * The eClassGrid variable is assigned an instance of the FilterStructureGrid class with parameters: getCtx(), locale, and\r\n     * FilterStatus.DEFAULT.getId(). This grid will be used to display E-Classes in the filter structure tab on the left side\r\n     * of the screen when this page loads (the default status). The InfoReload function reloads\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildEClassPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        eClassPanel = new FilterProgressLoader();\r\n        eClassGrid = new FilterStructureGrid(getCtx(), locale, FilterStatus.DEFAULT.getId());\r\n        InfoReload.reload(getCtx(), eClassGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_E_CLASS, locale, getCtx()));\r\n\r\n        eClassPanel.add(eClassGrid);\r\n        panel.addContent(eClassPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildMaterialAssigmentPanel function creates a new AccordionPanel, which is a panel that can be expanded and collapsed.\r\n     * It then creates a FilterProgressLoader, which is used to display the progress of an operation in the background.\r\n     * It then creates a FilterGrid object with two parameters: getCtx() and false (which I assume means &quot;don't show any filters&quot;).\r\n     * The InfoReload class has its reload function called on it with two parameters: getCtx() and assigmendGrid's grid property.  This causes some sort of information to be reloaded into assigmendGrid's grid property from somewhere else in\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildMaterialAssigmentPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        assigmnedPanel = new FilterProgressLoader();\r\n        assigmendGrid = new FilterGrid(getCtx(), false);\r\n        InfoReload.reload(getCtx(), assigmendGrid.getGrid());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_ASSIGMEND_MATERIAL, locale, getCtx()));\r\n\r\n        assigmnedPanel.add(assigmendGrid);\r\n        panel.addContent(assigmnedPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildRemovePanel function creates a new AccordionPanel, which is a container for the FilterProgressLoader and\r\n     * FilterRemoveGrid. The AccordionPanel is used to display the contents of the FilterProgressLoader and\r\n     * FilterRemoveGrid in an accordion style. This means that only one panel can be open at any given time, but all panels\r\n     * are visible on screen at once. The buildRemovePanel function also sets up some basic properties of this panel such as:\r\n     * - A summary text (the title) for this panel using getTranslation(TMS.FILTER_REMOVED). This will translate into &quot;Removed&quot;\r\n     *\r\n     * @return An accordionpanel object\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildRemovePanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        removePanel = new FilterProgressLoader();\r\n        removeGrid = new FilterRemoveGrid(getCtx());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_REMOVED, locale, getCtx()));\r\n        removePanel.add(removeGrid);\r\n        panel.addContent(removePanel);\r\n\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildImportPanel function creates a new AccordionPanel object, which is used to create the\r\n     * import panel. The import panel contains a FilterProgressLoader object and a FilterImportGrid\r\n     * object. The function then adds the two objects to the accordion panel and returns it.\r\n     *\r\n     * @return An accordionpanel object\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildImportPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        importPanel = new FilterProgressLoader();\r\n        importGrid = new FilterImportGrid(getCtx());\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_IMPORT, locale, getCtx()));\r\n        importPanel.add(importGrid);\r\n        panel.addContent(importPanel);\r\n\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildIndividualPanel function creates a new AccordionPanel, which is a type of panel that can be expanded and collapsed.\r\n     * It then creates an instance of the FilterIndividualGrid class, which is used to display all the individuals in the database.\r\n     * The InfoReload function reloads this grid with any changes made to it by other users since it was last loaded.\r\n     * The individualPanel variable is set equal to a new FilterProgressLoader object, which displays loading progress when data from\r\n     * another user's session needs to be loaded into this grid. This panel contains the individualGrid object created earlier in its code block.\r\n     *\r\n     * @param GridReloadService&lt;ArticleBase&gt; gridService Reload the grid\r\n     * @return An accordionpanel, which is an extension of a panel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildIndividualPanel(GridReloadService<ArticleBase> gridService) {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        individualGrid = new FilterIndividualGrid(getCtx(), gridService);\r\n\r\n        InfoReload.reload(getCtx(), individualGrid.getGrid());\r\n        individualPanel = new FilterProgressLoader();\r\n        panel.setSummaryText(getTranslation(TMS.FILTER_INDIVIDUAL, locale, getCtx()));\r\n        individualPanel.add(individualGrid);\r\n        panel.addContent(individualPanel);\r\n\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildNotInPimPanel function creates an accordion panel that contains the ExportPanel for products not in PIM.\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildNotInPimPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        notInPimPanel = new ExportPanel(getCtx(), FilterStatus.NOTPIM);\r\n        panel.setSummaryText(getTranslation(TMS.setExportFilterStatus(FilterStatus.NOTPIM), locale, getCtx()));\r\n        panel.addContent(notInPimPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildNotApprovalPanel function creates a new AccordionPanel object,\r\n     * and then adds the notApprovePanel to it. The function returns the panel.\r\n     *\r\n     * @return An accordionpanel object\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildNotApprovalPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        notApprovePanel = new ExportPanel(getCtx(), FilterStatus.NOTAPPROVAL);\r\n        panel.setSummaryText(getTranslation(TMS.setExportFilterStatus(FilterStatus.NOTAPPROVAL), locale, getCtx()));\r\n        panel.addContent(notApprovePanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildInvalidVtlStatusPanel function creates an accordion panel that contains a single export panel.\r\n     * The export panel is created with the context and filter status of VTL_STATUS, which means it will display all\r\n     * records in the database that have a VTL Status of &quot;Invalid&quot;.  This function returns the accordion panel.\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildInvalidVtlStatusPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        invalidVtlStatusPanel = new ExportPanel(getCtx(), FilterStatus.VTL_STATUS);\r\n        panel.setSummaryText(getTranslation(TMS.setExportFilterStatus(FilterStatus.VTL_STATUS), locale, getCtx()));\r\n        panel.addContent(invalidVtlStatusPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildRemoveByPositivPanel function creates a new AccordionPanel object,\r\n     * and then creates a new ExportPanel object called removeByPositivPanel.\r\n     * The panel is given the title &quot;Removed by Positiv&quot; in the language of the user's locale.\r\n     * The content of this panel is set to be removeByPositivPanel, which contains all items that have been removed from export by Positiv.\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildRemoveByPositivPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        removeByPositivPanel = new ExportPanel(getCtx(), FilterStatus.REMOVEBYFILTER,\r\n                FilterStatus.REMOVEBYFILTER_REMOVEDBYPOSITIV.name());\r\n        panel.setSummaryText(getTranslation(TMS.setExportFilterStatus(FilterStatus.REMOVEBYFILTER_REMOVEDBYPOSITIV),\r\n                locale, getCtx()));\r\n        panel.addContent(removeByPositivPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The buildNotInPositivPanel function creates a new AccordionPanel object,\r\n     * and then creates a new ExportPanel object called notInPositivPanel.\r\n     * The panel is given the title &quot;Remove by Filter: Not Found in Positiv&quot; (in English).\r\n     * The panel is added to the Accordion Panel, and then returned.\r\n     *\r\n     * @return An accordionpanel\r\n     * @docauthor Trelent\r\n     */\r\n    protected AccordionPanel buildNotInPositivPanel() {\r\n        AccordionPanel panel = new AccordionPanel();\r\n        notInPositivPanel = new ExportPanel(getCtx(), FilterStatus.REMOVEBYFILTER,\r\n                FilterStatus.REMOVEBYFILTER_NOTFOUNDINPOSITIV.name());\r\n        panel.setSummaryText(getTranslation(TMS.setExportFilterStatus(FilterStatus.REMOVEBYFILTER_NOTFOUNDINPOSITIV),\r\n                locale, getCtx()));\r\n        panel.addContent(notInPositivPanel);\r\n        return panel;\r\n    }\r\n\r\n    /**\r\n     * The loadZinfo function is called when the user clicks on a row in the assortment grid.\r\n     * It loads all of the zinfo data for that particular assortment into a new FilterZinfoGrid object,\r\n     * and then calls crumbUI.access to update the UI with this new information.\r\n     *\r\n     * @param Assortment assortment Filter the data in the grid\r\n     * @return A filterzinfogrid object\r\n     * @docauthor Trelent\r\n     */\r\n    protected FilterZinfoGrid loadZinfo(Assortment assortment) {\r\n        if (Objects.isNull(zinfoGrid)) {\r\n            zinfoGrid = new FilterZinfoGrid(getCtx(), assortment);\r\n        }\r\n\r\n        crumbUI.access(() -> new Thread(zinfoGrid::reload).start());\r\n        return zinfoGrid;\r\n    }\r\n\r\n    /**\r\n     * The loadIndividual function is called when the user clicks on the &quot;Individual&quot; tab.\r\n     * It loads all of the individuals from the database into a grid, which is displayed to\r\n     * the user. The function also adds a button to each row in this grid that allows users\r\n     * to delete an individual from this list. This function uses FilterBaseGetRepository's getArticleIndividual() method, which returns all of\r\n     * an article's individuals as a list of strings (the names). The loadIndividual() method then creates and displays these rows in its grid using addRow().\r\n     *\r\n     * @return A list of articleindividual objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadIndividual() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            individualPanel.reload(individualGrid, () -> service.getArticleIndividual(getCtx()));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadRemoved function is called when the user clicks on the &quot;Removed&quot; tab.\r\n     * It loads all of the articles that have been removed from their respective categories,\r\n     * and displays them in a grid. The function also adds a button to each article's row, which allows\r\n     * users to restore an article back into its original category.\r\n     *\r\n     * @return A completablefuture&lt;void&gt;\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadRemoved() {\r\n        crumbUI.access(() -> {\r\n            final ArticleBaseRepository articleService = getCtx().getServices().getArticleBaseService();\r\n            removePanel.reload(removeGrid,\r\n                    () -> articleService.findAllByFilterStatus(getCtx(), \"NOT IN\", FilterStatus.DEFAULT));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadAssigned function is used to load the assigned panel with all of the articles that are currently assigned.\r\n     * It does this by calling a function in FilterBaseGetRepository, which returns a list of filterbases.\r\n     * The first part of the switch statement determines whether or not we are dealing with an ECAT file or an IMPEX file, and then calls one of two functions based on that determination.\r\n     * These functions return lists containing all articles that have been assigned to basic assortment for either ECAT files or IMPEX files respectively.  If there are no such articles, it clears out any existing data from assigmend (\r\n     *\r\n     * @return A list of filterbase objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadAssigned() {\r\n        crumbUI.access(() -> assigmnedPanel.reload(assigmendGrid, () -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            List<Filterbase> assigned = new ArrayList<>(service.getArticleAssignedMaterialInBasicAssortment(getCtx(), locale,\r\n                    FilterStatus.DEFAULT.getId()));\r\n\r\n            if (assigned.get(0).getChildCount() == 0)\r\n                assigned.clear();\r\n            assigned.addAll(sortByLabel(service.getArticleAssignedMaterialNotInBasicAssortment(getCtx(), locale,\r\n                    FilterStatus.DEFAULT.getId())));\r\n\r\n\r\n            return assigned;\r\n        }));\r\n    }\r\n\r\n    /**\r\n     * The loadEClass function is called when the user clicks on a breadcrumb.\r\n     * It loads the EClasses that are children of the selected EPackage.\r\n     *\r\n     * @return A list of eclass objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadEClass() {\r\n        crumbUI.access(() -> eClassPanel.reload(eClassGrid));\r\n    }\r\n\r\n    /**\r\n     * The loadIntraStat function is called when the user clicks on the &quot;Intrastat&quot; button in the\r\n     * navigation bar. It loads all of the Intrastat articles from a database and displays them in a grid.\r\n     *\r\n     * @return A list of articleintrastat objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadIntraStat() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            intrastatPanel.reload(intrastatGrid,\r\n                    () -> sortByLabel(service.getArticleIntraStat(getCtx(), locale, FilterStatus.DEFAULT.getId())));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadNotFree function is called when the user clicks on the &quot;Not Free&quot; tab.\r\n     * It loads all of the articles that are not free into a grid, and sorts them by label.\r\n     *\r\n     * @return A list of articles\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadNotFree() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            freePanel.reload(freeGrid,\r\n                    () -> sortByLabel(service.getArticleNotFree(getCtx(), locale, FilterStatus.DEFAULT.getId())));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadBrands function is called when the user clicks on a brand in the brandsPanel.\r\n     * It loads all of the articles that are associated with that brand into an articleGrid.\r\n     *\r\n     * @return A list of articlebrand objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadBrands() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            brandsPanel.reload(brandsGrid,\r\n                    () -> service.getArticleBrand(getCtx(), locale, FilterStatus.DEFAULT.getId()));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadS3Catalogs function is called when the user clicks on the &quot;S3 Catalog&quot; tab.\r\n     * It loads all of the S3 catalogs from a database and displays them in a grid.\r\n     *\r\n     * @return A list of articles3catalog objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadS3Catalogs() {\r\n        crumbUI.access(() -> {\r\n            if (Objects.nonNull(s3CatalogPanel)) {\r\n                final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n                s3CatalogPanel.reload(s3CatalogGrid,\r\n                        () -> service.getArticleS3Catalog(getCtx(), locale, FilterStatus.DEFAULT.getId()));\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadGHSCode function is called when the user clicks on the &quot;GHS&quot; button in the filter panel.\r\n     * It loads all of the GHS codes from a database and displays them in a grid.\r\n     *\r\n     * @return A list of articleghscode objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadGHSCode() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            ghsPanel.reload(ghsGrid,\r\n                    () -> sortByLabel(service.getArticleGHSCode(getCtx(), locale, FilterStatus.DEFAULT.getId())));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadConfig function is called when the user clicks on the &quot;Load Config&quot; button.\r\n     * It loads a default configuration from the database and displays it in a grid.\r\n     *\r\n     * @return A list of articleconfigs\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadConfig() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            configPanel.reload(configGrid,\r\n                    () -> sortByLabel(service.getArticleConfig(getCtx(), locale, FilterStatus.DEFAULT.getId())));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadInfoType function is called when the user clicks on the &quot;Info Type&quot; button in the left-hand menu.\r\n     * It loads all of the Info Types from a database and displays them in a grid.\r\n     *\r\n     * @return A list of articleinfotype objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadInfoType() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            infoTypePanel.reload(infoTypeGrid,\r\n                    () -> sortByLabel(service.getArticleInfoType(getCtx(), locale, FilterStatus.DEFAULT.getId())));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadArticleClass function is called when the user clicks on the &quot;Article Class&quot; button in\r\n     * the filter panel. It loads all of the article classes from a database and displays them in a grid.\r\n     *\r\n     * @return A list of articleclass objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadArticleClass() {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            articleClassPanel.reload(articleClassGrid,\r\n                    () -> sortByLabel(service.getArticleClass(getCtx(), locale, FilterStatus.DEFAULT.getId())));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The loadStructure function is called when the user clicks on a filter in the FilterBase.\r\n     * It loads all of the articles that are associated with that filter into a grid, which is displayed to the user.\r\n     *\r\n     * @param Setting setting Filter the data\r\n     * @return A list&lt;articlestructure&gt;\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadStructure(Setting setting) {\r\n        crumbUI.access(() -> {\r\n            final FilterBaseGetRepository service = getCtx().getServices().getFilterBaseDBService();\r\n            structurePanel.reload(structureGrid,\r\n                    () -> service.getArticleStructure(getCtx(), setting, locale, FilterStatus.DEFAULT.getId()));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The sortByLabel function takes a list of Filterbase objects and sorts them by their label.\r\n     *\r\n     * @param List&lt;Filterbase&gt; list Sort the list\r\n     * @return A sorted list\r\n     * @docauthor Trelent\r\n     */\r\n    private List<Filterbase> sortByLabel(List<Filterbase> list) {\r\n        list.sort((o1, o2) -> {\r\n            String label1 = Objects.nonNull(o1.getLabel()) ? o1.getLabel() : \"\";\r\n            String label2 = Objects.nonNull(o2.getLabel()) ? o1.getLabel() : \"\";\r\n\r\n            return label1.compareTo(label2);\r\n        });\r\n        return list;\r\n    }\r\n\r\n    /**\r\n     * The loadImport function is called when the user clicks on the &quot;Import&quot; button in the\r\n     * navigation bar. It loads a new ImportPanel into crumbUI, which contains an ImportGrid\r\n     * that displays all of the imports currently stored in our database. The function also\r\n     * sets up a listener for changes to this grid, so that if any of its contents are changed,\r\n     * it will automatically reload itself with those changes reflected. This allows us to update\r\n     * our UI without having to refresh or navigate away from it manually. Finally, we set up a\r\n     * listener for when an import is selected from this\r\n     *\r\n     * @return A list of objects\r\n     * @docauthor Trelent\r\n     */\r\n    protected void loadImport() {\r\n        crumbUI.access(() -> importPanel.reload(importGrid));\r\n    }\r\n\r\n    /**\r\n     * The isFilterSet function is used to determine whether or not the filter\r\n     * should be displayed. The function returns true if the filter should be\r\n     * displayed, and false otherwise. The function takes a DataProvider as an\r\n     * argument, which it uses to determine whether or not there are any items in\r\n     * the grid that would match a search query. If there are no items in the grid,\r\n     * then we know that displaying a filter would be pointless because nothing\r\n     * could possibly match it's query (and thus nothing will show up). In this case,\r\n     * we return false so that no filter is shown on screen\r\n     *\r\n     * @param DataProvider dataProvider Get the data from the\r\n     * @return True if the filter is set\r\n     * @docauthor Trelent\r\n     */\r\n    @SuppressWarnings(\"rawtypes\")\r\n    protected boolean isFilterSet(DataProvider dataProvider) {\r\n        ListDataProvider provider = (ListDataProvider) dataProvider;\r\n\r\n        BreadBox box = getCtx().getUserSession().get(Params.ACTIVE_BREADBOX);\r\n        boolean result = false;\r\n        String classSimpleName = box.getCurrent().getClass().getSimpleName();\r\n\r\n        switch (classSimpleName) {\r\n\r\n            default:\r\n            case \"FilterRemoveCrumb\":\r\n            case \"FilterIndividualCrumb\":\r\n                result = true;\r\n                break;\r\n            case \"FilterAddCrumb\":\r\n                result = !provider.getItems().isEmpty();\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * The areAllCheckboxTrue function checks if all the checkboxes are true.\r\n     *\r\n     * @return True if all checkboxes are true\r\n     * @docauthor Trelent\r\n     */\r\n    private boolean areAllCheckboxTrue() {\r\n        List<ExportPanel> list = Arrays.asList(notInPimPanel, notApprovePanel, invalidVtlStatusPanel, notInPositivPanel,\r\n                removeByPositivPanel);\r\n        int countValidBox = 0;\r\n        int coundIsValid = 0;\r\n\r\n        for (ExportPanel export : list) {\r\n            countValidBox++;\r\n            Boolean valid = isValid(export);\r\n            if (Objects.nonNull(valid) && valid.equals(Boolean.TRUE)) {\r\n                coundIsValid++;\r\n            }\r\n        }\r\n\r\n        return (coundIsValid == countValidBox);\r\n    }\r\n\r\n    /**\r\n     * The checkBefore function is used to check if the user has set a filter and checked all of the checkboxes.\r\n     * If both of these conditions are met, then it will execute the CheckBeforeListner function that was passed in as an argument.\r\n     *\r\n     * @param CheckBeforeListner check Execute the checkbefore function\r\n     * @param DataProvider       dataProvider Get the filter values\r\n     * @return A boolean value, which is true if the filter is set and all checkboxes are checked\r\n     * @docauthor Trelent\r\n     */\r\n    @SuppressWarnings(\"rawtypes\")\r\n    protected void checkBefore(CheckBeforeListner check, DataProvider dataProvider) {\r\n        if (isFilterSet(dataProvider) && areAllCheckboxTrue()) {\r\n            getCtx().getUserSession().remove(Params.HAS_NOTINPIM);\r\n            getCtx().getUserSession().remove(Params.HAS_NOTAPPROVAL);\r\n            getCtx().getUserSession().remove(Params.HAS_INVALID_VTL_STATUS);\r\n            getCtx().getUserSession().remove(Params.HAS_NOTFOUND);\r\n            getCtx().getUserSession().remove(Params.HAS_NOTPOSITIV);\r\n            check.execute();\r\n        }\r\n        boolean isFilter = !isFilterSet(dataProvider);\r\n        boolean areAllCheckBoxValid = !areAllCheckboxTrue();\r\n\r\n        log.info(\"Valid1: \" + isFilter + \"Valid2: \" + areAllCheckBoxValid);\r\n\r\n        if (isFilter || areAllCheckBoxValid) {\r\n            resetPrellCount();\r\n            AstNotification notify = new AstNotification(getCtx());\r\n            if (isFilter)\r\n                notify.errorMessage(\r\n                        getTranslation(TMS.ERROR_MSG_PLEASE_ADD_SOMETHING_TO_FILTERBASE, locale, getCtx()));\r\n            else\r\n                notify.errorMessage(getTranslation(TMS.ERROR_MSG_PLEASE_SET_CHECKBOX_FIRST, locale, getCtx()));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The setBoxVisible function is used to set the visibility of a FilterProgressLoader object.\r\n     *\r\n     * @param FilterProgressLoader progressLoader Determine which accordion panel to set visible\r\n     * @param boolean              valid Determine whether the progress loader is visible or not\r\n     * @return True if the progressloader is visible, and false if it isn't\r\n     * @docauthor Trelent\r\n     */\r\n    public void setBoxVisible(FilterProgressLoader progressLoader, boolean valid) {\r\n        accordion.getChildren().forEach(item -> {\r\n            if (item instanceof AccordionPanel) {\r\n                AccordionPanel panel = (AccordionPanel) item;\r\n                panel.getContent().forEach(child -> {\r\n                    if (child.equals(progressLoader)) {\r\n                        item.setVisible(valid);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The setBoxVisible function is used to set the visibility of an accordion panel.\r\n     *\r\n     * @param ExportPanel export Find the panel in the accordion\r\n     * @param boolean     valid Determine if the panel is visible or not\r\n     * @return A boolean\r\n     * @docauthor Trelent\r\n     */\r\n    public void setBoxVisible(ExportPanel export, boolean valid) {\r\n        accordion.getChildren().forEach(item -> {\r\n            if (item instanceof AccordionPanel) {\r\n                AccordionPanel panel = (AccordionPanel) item;\r\n                panel.getContent().forEach(child -> {\r\n                    if (child.equals(export)) {\r\n                        item.setVisible(valid);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The open function is used to open the accordion panel that contains the\r\n     * FilterProgressLoader. This function is called when a filter has been applied\r\n     * and it needs to be displayed in the accordion panel. The progress loader will\r\n     * then display how much of each filter has been completed, as well as an overall\r\n     * percentage of completion for all filters combined.\r\n     *\r\n     * @param FilterProgressLoader progressLoader Open the accordion panel that contains it\r\n     * @return The accordion\r\n     * @docauthor Trelent\r\n     */\r\n    public void open(FilterProgressLoader progressLoader) {\r\n        accordion.getChildren().forEach(item -> {\r\n            if (item instanceof AccordionPanel) {\r\n                AccordionPanel panel = (AccordionPanel) item;\r\n                panel.getContent().forEach(child -> {\r\n                    if (child.equals(progressLoader)) {\r\n                        accordion.open(panel);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * The isValid function is used to determine whether or not the ExportPanel\r\n     * that is passed in as a parameter has been filled out correctly. If it has,\r\n     * then the function returns true. Otherwise, it returns false. This function\r\n     * also checks if the panel that contains this ExportPanel is visible or not;\r\n     * if it isn't visible, then we know that this particular export option hasn't\r\n     * been selected by the user and therefore doesn't need to be validated (so we\r\n     * return true). The reason for doing this check here instead of in each individual\r\n     * ExportPanel's validate method is\r\n     *\r\n     * @param ExportPanel export Identify the current panel\r\n     * @return A boolean, but i don't know how to get the value of it\r\n     * @docauthor Trelent\r\n     */\r\n    public Boolean isValid(ExportPanel export) {\r\n        Boolean valid = null;\r\n        List<Component> comps = accordion.getChildren().collect(Collectors.toList());\r\n        for (Component component : comps) {\r\n            if (component instanceof AccordionPanel) {\r\n                AccordionPanel panel = (AccordionPanel) component;\r\n                List<Component> childs = panel.getContent().collect(Collectors.toList());\r\n                for (Component child : childs) {\r\n                    if (child.equals(export)) {\r\n                        if (panel.isVisible())\r\n                            valid = Boolean.valueOf(((ExportPanel) child).isValid());\r\n                        else\r\n                            valid = Boolean.TRUE;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return valid;\r\n    }\r\n\r\n    /**\r\n     * The showExportPanels function is used to display the export panels in the accordion.\r\n     *\r\n     * @param Accordion accordion Add the panels to it\r\n     * @return A boolean value\r\n     * @docauthor Trelent\r\n     */\r\n    protected void showExportPanels(Accordion accordion) {\r\n\r\n        if (getCtx().getUserSession().exists(Params.HAS_NOTINPIM))\r\n            getNotInPimPanel().reloadArticles(accordion, getCtx().getUserSession().get(Params.HAS_NOTINPIM));\r\n        else\r\n            setBoxVisible(getNotInPimPanel(), false);\r\n\r\n        if (getCtx().getUserSession().exists(Params.HAS_NOTAPPROVAL))\r\n            getNotApprovePanel().reloadArticles(accordion, getCtx().getUserSession().get(Params.HAS_NOTAPPROVAL));\r\n        else\r\n            setBoxVisible(getNotApprovePanel(), false);\r\n\r\n        if (getCtx().getUserSession().exists(Params.HAS_INVALID_VTL_STATUS))\r\n            getInvalidVtlStatusPanel().reloadArticles(accordion,\r\n                    getCtx().getUserSession().get(Params.HAS_INVALID_VTL_STATUS));\r\n        else\r\n            setBoxVisible(getInvalidVtlStatusPanel(), false);\r\n\r\n        if (getCtx().getUserSession().exists(Params.HAS_NOTPOSITIV))\r\n            getRemoveByPositivPanel().reloadArticles(accordion, getCtx().getUserSession().get(Params.HAS_NOTPOSITIV));\r\n        else\r\n            setBoxVisible(getRemoveByPositivPanel(), false);\r\n\r\n        if (getCtx().getUserSession().exists(Params.HAS_NOTFOUND))\r\n            getNotInPositivPanel().reloadArticles(accordion, getCtx().getUserSession().get(Params.HAS_NOTFOUND));\r\n        else\r\n            setBoxVisible(getNotInPositivPanel(), false);\r\n    }\r\n\r\n    protected interface CheckBeforeListner {\r\n        void execute();\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\FilterCrumb.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\HomLang.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.pojo.MultiLanguage;\r\nimport com.hom.ebmw.utilities.CompUtils;\r\nimport com.hom.ebmw.utilities.Parse;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.customfield.CustomField;\r\nimport com.vaadin.flow.component.html.Div;\r\nimport com.vaadin.flow.component.html.Label;\r\nimport com.vaadin.flow.component.icon.VaadinIcon;\r\nimport com.vaadin.flow.component.orderedlayout.FlexComponent.Alignment;\r\nimport com.vaadin.flow.component.orderedlayout.HorizontalLayout;\r\nimport com.vaadin.flow.component.orderedlayout.Scroller;\r\nimport com.vaadin.flow.component.orderedlayout.VerticalLayout;\r\nimport com.vaadin.flow.component.textfield.TextField;\r\nimport com.vaadin.flow.dom.Style;\r\nimport lombok.Getter;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\nimport java.util.Optional;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class HomLang extends CustomField<List<MultiLanguage>> {\r\n    private @Getter List<MultiLanguage> items = new ArrayList<MultiLanguage>();\r\n    private MultiLanguage selected;\r\n    private final TextField textfield = new TextField();\r\n    private final VerticalLayout containers = new VerticalLayout();\r\n    private final @Getter Button globe = new Button(VaadinIcon.GLOBE.create());\r\n    private final Scroller scroller;\r\n\r\n    private boolean visible = false;\r\n\r\n    /**\r\n     * The HomLang function is a component that allows the user to input text in multiple languages.\r\n     * The HomLang function has two parts: a textfield and a globe icon. When the user clicks on the globe,\r\n     * they are presented with an overlay of all available languages for which they can enter text.\r\n     *\r\n     * @return A homlang object\r\n     */\r\n    public HomLang() {\r\n\r\n        containers.setId(\"containers\");\r\n        CompUtils.removeMSP(containers, \"MSP\");\r\n        textfield.addValueChangeListener(event -> {\r\n            selected.setValue(textfield.getValue());\r\n        });\r\n        this.setId(\"hom-lang\");\r\n        Div overlay = new Div();\r\n        overlay.setId(\"overlayout\");\r\n        Style overStyle = overlay.getStyle();\r\n        overStyle.set(\"position\", \"absolute\");\r\n        overStyle.set(\"display\", \"none\");\r\n        overStyle.set(\"background\", \"var(--lumo-base-color)\");\r\n        overStyle.set(\"border-radius\", \"4px\");\r\n        overStyle.set(\"z-index\", \"200\");\r\n        overStyle.set(\"width\", \"250px\");\r\n        overStyle.set(\"height\", \"220px\");\r\n        overStyle.set(\"box-shadow\", \"0 2px 6px -1px lightgray, 0 8px 24px -4px gray\");\r\n        overStyle.set(\"top\", \"0px\");\r\n        overStyle.set(\"transition\", \"all 0.4s\");\r\n\r\n        scroller = new Scroller(containers);\r\n\r\n        globe.addClickListener(event -> {\r\n            visible = !visible;\r\n            containers.removeAll();\r\n            CompUtils.getComponentBoundingBox(textfield, e -> {\r\n                overStyle.set(\"top\", (Parse.toDouble(e.getBottom()) + 4) + \"px\");\r\n                overStyle.set(\"display\", visible ? \"block\" : \"none\");\r\n            });\r\n\r\n            if (visible) {\r\n                items.forEach(item -> {\r\n                    String language = item.getKey().getLabel().split(\"-\")[0];\r\n                    Label key = new Label(language);\r\n                    key.getStyle().set(\"font-family\", \"monospace,monospace\");\r\n                    key.getStyle().set(\"padding-left\", \"3px\");\r\n                    key.setWidth(\"20px\");\r\n                    TextField value = new TextField();\r\n                    value.setValue(item.getValue());\r\n                    value.setPlaceholder(language + \"-title\");\r\n                    HorizontalLayout row = new HorizontalLayout();\r\n                    CompUtils.removeMSP(row, \"MP\");\r\n                    row.add(key, value);\r\n                    row.setAlignItems(Alignment.CENTER);\r\n                    value.addValueChangeListener(valueEvent -> item.setValue(value.getValue()));\r\n                    containers.add(row);\r\n                });\r\n            } else {\r\n                refresh();\r\n            }\r\n        });\r\n\r\n        scroller.setScrollDirection(Scroller.ScrollDirection.VERTICAL);\r\n        scroller.setHeight(\"220px\");\r\n\r\n        HorizontalLayout head = new HorizontalLayout();\r\n        CompUtils.removeMSP(head, \"MSP\");\r\n        head.add(textfield, globe);\r\n        overlay.add(scroller);\r\n        add(head, overlay);\r\n    }\r\n\r\n    /**\r\n     * The setItems function is used to set the items of a ComboBox.\r\n     *\r\n     * @param List&lt;MultiLanguage&gt; items Set the items in the list\r\n     */\r\n    public void setItems(List<MultiLanguage> items) {\r\n        this.items = items;\r\n        refresh();\r\n    }\r\n\r\n    /**\r\n     * The refresh function is called when the user changes the language in the dropdown menu.\r\n     * It searches for a MultiLanguage object with a key that matches the current locale, and if it finds one,\r\n     * sets it as selected and updates its value to match what's in textfield.\r\n     */\r\n    public void refresh() {\r\n        Optional<MultiLanguage> optLang = items.stream()\r\n                .filter(item -> item.getKey().getLabel().equals(getLocale().toLanguageTag())).findFirst();\r\n        if (optLang.isPresent()) {\r\n            selected = optLang.get();\r\n            textfield.setValue(selected.getValue());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The generateModelValue function is used to generate a list of MultiLanguage objects from the\r\n     * values in the table. This function is called when the user clicks on &quot;Save&quot; or &quot;Cancel&quot;.\r\n     *\r\n     * @return A list of multilanguage objects\r\n     */\r\n    @Override\r\n    protected List<MultiLanguage> generateModelValue() {\r\n        return items;\r\n    }\r\n\r\n    /**\r\n     * The setPresentationValue function is used to set the value of the presentation model.\r\n     * The function takes in a List&lt;MultiLanguage&gt; object, which is then converted into an ObservableList&lt;String&gt;.\r\n     * This conversion allows for easier manipulation of the data within JavaFX.\r\n     *\r\n     * @param List&lt;MultiLanguage&gt; newPresentationValue Set the items in the list box\r\n     */\r\n    @Override\r\n    protected void setPresentationValue(List<MultiLanguage> newPresentationValue) {\r\n        setItems(newPresentationValue);\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\HomLang.java =====\n\n===== BEGIN FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\ImageButton.java =====\n```\npackage com.hom.ebmw.view.components;\r\n\r\nimport com.hom.ebmw.utilities.enums.IconImage;\r\nimport com.vaadin.flow.component.HasHelper;\r\nimport com.vaadin.flow.component.button.Button;\r\nimport com.vaadin.flow.component.html.Image;\r\nimport com.vaadin.flow.dom.Style;\r\nimport dev.mett.vaadin.tooltip.mixin.HasTooltip;\r\n\r\n@SuppressWarnings(\"serial\")\r\npublic class ImageButton extends Button implements HasTooltip, HasHelper {\r\n\r\n    private final Image logo = new Image();\r\n    private final Image deLogo = new Image();\r\n\r\n    /**\r\n     * The ImageButton function is a constructor for the ImageButton class.\r\n     * It sets the style of both logos to be used in this class, and then sets\r\n     * the icon to be displayed as logo.png by default.\r\n     *\r\n     * @return An imagebutton object\r\n     */\r\n    public ImageButton() {\r\n        setStyle(logo);\r\n        setStyle(deLogo);\r\n\r\n        setIcon(logo);\r\n    }\r\n\r\n    /**\r\n     * The ImageButton function is a constructor for the ImageButton class.\r\n     * It takes in two IconImage objects, one for the normal state and one for the depressed state.\r\n     * The function sets up an HTML image element with its source set to that of img's path and alt text set to img's name.\r\n     * It also sets up another HTML image element with its source set to that of deImg's path and alt text set to deImg's name.\r\n     *\r\n     * @param IconImage img Set the source and alt of the logo\r\n     * @param IconImage deImg Set the default image of the button\r\n     * @return An imagebutton object\r\n     */\r\n    public ImageButton(IconImage img, IconImage deImg) {\r\n        this();\r\n        logo.setSrc(img.getPath());\r\n        logo.setAlt(img.getName());\r\n\r\n        deLogo.setSrc(deImg.getPath());\r\n        deLogo.setAlt(deImg.getName());\r\n    }\r\n\r\n    /**\r\n     * The ImageButton function is a constructor that creates an ImageButton object.\r\n     *\r\n     * @param Image logo Set the logo image of the imagebutton\r\n     * @param Image deLogo Set the image when the mouse is not over it\r\n     * @return An imagebutton object\r\n     */\r\n    public ImageButton(Image logo, Image deLogo) {\r\n        this();\r\n        this.logo.setSrc(logo.getSrc());\r\n        this.deLogo.setSrc(deLogo.getSrc());\r\n\r\n        logo.getAlt().ifPresent(item -> this.logo.setAlt(item));\r\n        deLogo.getAlt().ifPresent(item -> this.deLogo.setAlt(item));\r\n    }\r\n\r\n    /**\r\n     * The setImgSize function takes in a string and an image as parameters.\r\n     * The function then sets the size of the image to be equal to that of the string.\r\n     *\r\n     * @param String size Set the size of the logo\r\n     * @param Image  logo Set the size of the image\r\n     */\r\n    public void setImgSize(String size, Image logo) {\r\n        Style style = logo.getStyle();\r\n        style.remove(\"--lumo-button-size\");\r\n        style.set(\"--lumo-button-size\", size);\r\n    }\r\n\r\n    /**\r\n     * The setImgSize function sets the size of the logo and deLogo images.\r\n     *\r\n     * @param String size Set the size of the image\r\n     */\r\n    public void setImgSize(String size) {\r\n        setImgSize(size, logo);\r\n        setImgSize(size, deLogo);\r\n    }\r\n\r\n    /**\r\n     * The setImgWidth function sets the width of the image to a specified size.\r\n     *\r\n     * @param String size Set the width of the image\r\n     */\r\n    public void setImgWidth(String size) {\r\n        setImgWidth(size, logo);\r\n        setImgWidth(size, deLogo);\r\n    }\r\n\r\n    /**\r\n     * The setImgWidth function sets the width of an image to a specified size.\r\n     *\r\n     * @param String size Set the width of the image\r\n     * @param Image  logo Set the width of the image\r\n     */\r\n    public void setImgWidth(String size, Image logo) {\r\n        Style style = logo.getStyle();\r\n        style.remove(\"width\");\r\n        style.set(\"width\", size);\r\n    }\r\n\r\n    /**\r\n     * The setImgHeight function sets the height of the logo and deLogo images to a specified size.\r\n     *\r\n     * @param String size Set the height of the logo and delogo\r\n     */\r\n    public void setImgHeight(String size) {\r\n        setImgHeight(size, logo);\r\n        setImgHeight(size, deLogo);\r\n    }\r\n\r\n    /**\r\n     * The setImgHeight function sets the height of an image to a specified size.\r\n     *\r\n     * @param String size Set the height of the image\r\n     * @param Image  logo Set the height of the image\r\n     */\r\n    public void setImgHeight(String size, Image logo) {\r\n        Style style = logo.getStyle();\r\n        style.remove(\"height\");\r\n        style.set(\"height\", size);\r\n    }\r\n\r\n    /**\r\n     * The setStyle function sets the style of the logo image.\r\n     *\r\n     * @param Image logo Set the style of the logo\r\n     */\r\n    private void setStyle(Image logo) {\r\n        Style style = logo.getStyle();\r\n        style.set(\"display\", \"inline-block\");\r\n        style.set(\"--lumo-button-size\", \"var(--lumo-size-xs)\");\r\n        style.set(\"width\", \"var(--lumo-button-size)\");\r\n        style.set(\"height\", \"var(--lumo-button-size)\");\r\n        style.set(\"padding-top\", \"5px\");\r\n    }\r\n\r\n    /**\r\n     * The setEnabled function is a function that allows the user to enable or disable\r\n     * the button. If enabled, it will display the logo of the company. If disabled,\r\n     * it will display a greyed out version of said logo. This is done by using an if statement\r\n     * and setting an icon depending on whether or not it's enabled or disabled.\r\n     *\r\n     * @param boolean enabled Determine if the button is enabled or not\r\n     */\r\n    @Override\r\n    public void setEnabled(boolean enabled) {\r\n        super.setEnabled(enabled);\r\n        if (enabled) {\r\n            setIcon(logo);\r\n        } else {\r\n            setIcon(deLogo);\r\n        }\r\n    }\r\n}\r\n\n```\n===== END FILE: C:\\Users\\mtheele\\IdeaProjects\\TIP - Assortmenttool_2\\src\\main\\java\\com\\hom\\ebmw\\view\\components\\ImageButton.java =====\n\n"
  },
  "response" : {
    "id" : "chatcmpl-lx5vCZaBCNOzuOoaRNrAvfC2C8wXv2Cf",
    "created" : 1762171364,
    "model" : "gpt-oss:120b",
    "object" : "chat.completion",
    "system_fingerprint" : "b1-b0d5299",
    "choices" : [ {
      "finish_reason" : "stop",
      "index" : 0,
      "message" : {
        "content" : "{\n  \"file\": \"multiple\",\n  \"issues\": [\n    {\n      \"severity\": \"High\",\n      \"problem\": \"Potential NullPointerException in BreadBox.getActive() when activeComp is not a Crumb.\",\n      \"justification\": \"The method casts activeComp to Crumb without checking its type; if a different component is set, a ClassCastException occurs, breaking navigation.\",\n      \"action\": \"Add instanceof check before casting; return Optional<Crumb> or null if not a Crumb; update callers to handle the optional.\",\n      \"source\": \"BreadBox.getActive(), line 112\",\n      \"component\": \"breadbox-navigation\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": \"activeComp is set via setContent(Component) which may receive any Component.\"\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"IndexOutOfBounds risk in Crumb.setLastEnable() when calculating nextIdx.\",\n      \"justification\": \"If the current crumb is the last in the list, nextIdx equals list size, and get(nextIdx) throws IndexOutOfBoundsException, causing UI crash.\",\n      \"action\": \"Validate nextIdx < box.getButtonCrumbs().size() before accessing; disable last button when at end of list.\",\n      \"source\": \"Crumb.setLastEnable(), lines 115-122\",\n      \"component\": \"breadbox-controls\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": \"nextIdx = box.getCrumbs().indexOf(current) + 1\"\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"Incorrect comparator in FilterCrumb.sortByLabel(): both label1 and label2 use o1, causing unsorted results.\",\n      \"justification\": \"Sorting never compares o2, leading to unpredictable UI order and possible user confusion.\",\n      \"action\": \"Replace second label extraction with o2.getLabel(); add unit test verifying correct alphabetical order.\",\n      \"source\": \"FilterCrumb.sortByLabel(), lines 823-830\",\n      \"component\": \"filter-ui\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": \"String label2 = Objects.nonNull(o2.getLabel()) ? o1.getLabel() : \\\"\\\";\"\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"Potential IndexOutOfBounds in FilterCrumb.loadAssigned() when assigned list is empty.\",\n      \"justification\": \"Code accesses assigned.get(0) without checking list size, which throws an exception if no assigned items exist.\",\n      \"action\": \"Check assigned.isEmpty() before accessing element; handle empty case gracefully (e.g., skip childCount check).\",\n      \"source\": \"FilterCrumb.loadAssigned(), lines 692-697\",\n      \"component\": \"filter-assigned-panel\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": \"if (assigned.get(0).getChildCount() == 0) ...\"\n    },\n    {\n      \"severity\": \"High\",\n      \"problem\": \"Resource leak in DownloadButton.getAsStream()/getAsFile(): InputStream is not closed after use.\",\n      \"justification\": \"Leaving streams open can exhaust file descriptors and cause memory pressure, especially for large files.\",\n      \"action\": \"Wrap stream handling in try-with-resources and ensure the stream is closed after download completes; add tests for proper closure.\",\n      \"source\": \"DownloadButton.getAsStream() and getAsFile(), lines 172-195\",\n      \"component\": \"download-button\",\n      \"impact_scope\": \"performance-critical\",\n      \"relations\": null,\n      \"evidence\": \"return stream; // never closed\"\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"Race condition on prellCount in BreadBox (debounce flag) when accessed from multiple UI threads.\",\n      \"justification\": \"Concurrent clicks could bypass the guard, leading to multiple executions of navigation logic and inconsistent state.\",\n      \"action\": \"Synchronize access to prellCount or replace with AtomicInteger; reset after UI task completes.\",\n      \"source\": \"BreadBox.exit, next, last click listeners, lines 44-78\",\n      \"component\": \"breadbox-debounce\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": \"if (prellCount == 0) { prellCount++; ... }\"\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"Incorrect width calculation in BreadBox.addCrump(): integer division may yield 0 and uses wrong variable.\",\n      \"justification\": \"Using (100 / crumbs.size()) with integer division can produce 0 for many crumbs, resulting in invisible buttons; also sets width on the last created button only.\",\n      \"action\": \"Calculate width using double arithmetic and apply to each button; replace crump.setWidth with each button's setWidth.\",\n      \"source\": \"BreadBox.addCrump(), lines 158-165\",\n      \"component\": \"breadbox-ui\",\n      \"impact_scope\": \"ui/UX\",\n      \"relations\": null,\n      \"evidence\": \"buttonCrumbs.forEach(crumpy -> crump.setWidth((100 / crumbs.size()) + \\\"%\\\"));\"\n    },\n    {\n      \"severity\": \"Med\",\n      \"problem\": \"NullPointerException risk in HomLang.textfield listener when selected is null.\",\n      \"justification\": \"If setItems is never called before user types, selected remains null and selected.setValue(...) throws NPE.\",\n      \"action\": \"Initialize selected with a placeholder MultiLanguage or guard the listener with null check; add unit test for empty items list.\",\n      \"source\": \"HomLang constructor, line 38\",\n      \"component\": \"multilingual-input\",\n      \"impact_scope\": \"prod-relevant\",\n      \"relations\": null,\n      \"evidence\": \"selected.setValue(textfield.getValue());\"\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"Stale UI reference in DownloadButton: UI captured at construction may become invalid after navigation.\",\n      \"justification\": \"If the component is moved to a different UI, ui.getCurrent() should be used at the time of click to avoid IllegalStateException.\",\n      \"action\": \"Replace field ui with UI.getCurrent() inside click listeners; add test verifying button works after view change.\",\n      \"source\": \"DownloadButton constructor, line 45 and click listeners\",\n      \"component\": \"download-button\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": \"ui = UI.getCurrent();\"\n    },\n    {\n      \"severity\": \"Low\",\n      \"problem\": \"Potential IndexOutOfBounds in BreadBox.reset(): adds defaultCrumb without null check.\",\n      \"justification\": \"If defaultCrumb was never set, crumbs.add(defaultCrumb) throws NPE, breaking reset flow.\",\n      \"action\": \"Check defaultCrumb != null before adding; if null, log warning or keep crumbs empty.\",\n      \"source\": \"BreadBox.reset(UI ui), lines 241-247\",\n      \"component\": \"breadbox-reset\",\n      \"impact_scope\": null,\n      \"relations\": null,\n      \"evidence\": \"crumbs.add(defaultCrumb);\"\n    }\n  ],\n  \"summary\": {\n    \"overall_rating\": \"2\",\n    \"top_todos\": [\n      \"Fix NPEs and IndexOutOfBounds in BreadBox and Crumb (add null/size checks).\",\n      \"Correct sortByLabel comparator and width calculation logic.\",\n      \"Close InputStreams in DownloadButton to avoid resource leaks.\"\n    ]\n  }\n}",
        "role" : "assistant",
        "reasoning_content" : "We need to produce JSON with issues for each file? The prompt: \"Your task: analyze each code chunk.\" Likely need to output one JSON per file? The schema includes \"file\" string and issues array. Probably combine all files into one JSON? Might need separate JSON objects? The instruction says \"return valid JSON\". Could be an array of objects? But schema expects a single object with fields file, issues, summary. So need to pick a chunk? Probably we need to review each file individually, but output one JSON per file? The spec doesn't allow multiple top-level objects. Could embed multiple in array under key? Not allowed. Probably we need to output one JSON per file? But only one JSON allowed. Maybe we need to output combined analysis for all files? Use file field as \"multiple\" or a generic ID. Could list issues referencing each file in source field.\n\nI'll create single JSON summarizing all issues across provided files, with file field maybe \"multiple\". Provide up to 10 issues total. Prioritize high severity.\n\nLet's identify issues:\n\nBreadBox.java:\n- prellCount used as debounce but not thread-safe; possible race condition if multiple clicks concurrently.\n- In addCrump, buttonCrumbs.forEach(crumpy -> crump.setWidth((100 / crumbs.size()) + \"%\")); uses crump variable not crumpy, sets width repeatedly incorrectly; also integer division may produce 0 for many crumbs.\n- getActive returns Crumb cast from Component; may cause ClassCastException if activeComp not Crumb.\n- reset() clears crumbs and adds defaultCrumb but defaultCrumb may be null leading to NPE.\n- initial() creates new HorizontalLayout controle twice, redundant, potential memory leak? Not critical.\n- Use of getTranslation with ctx but ctx may be null if not set; constructors set ctx but default constructor not present; maybe fine.\n\nCrumb.java:\n- getActiveEnable methods may cause NPE if ctx.getUserSession().get returns null.\n- setLastEnable: checks nextBtn.isEnabled() but may cause IndexOutOfBounds if nextIdx beyond size.\n- sortByLabel comparator uses o1.getLabel() for both, second should be o2.getLabel(); bug leads to always equal.\n- loadAssigned: assumes assigned list not empty before checking assigned.get(0); may cause IndexOutOfBounds when list empty.\n- loadAssigned: after clearing if childCount zero, still addAll from other list; may cause duplicate.\n- In sortByLabel, uses o1 for both label2 retrieval.\n\nCustomerFilterField.java:\n- save(): if current not present, selects first filter but may be empty -> NPE when filterCbx.getValue() later? Also active may be null.\n- In save(), setActive.setValue(active.getValue().booleanValue()) may cause NPE if active null (but initialized).\n- No validation for role being null, could NPE.\n- No CSRF or security concerns, fine.\n\nDownloadButton.java:\n- UI ui captured at construction may become stale if UI detached; should fetch UI in each call.\n- getAsStream/getAsFile close streams? Not closed, potential resource leak.\n- In reloadAsFile, fileName sanitized but replaceAll may produce empty name.\n\nExportPanel.java:\n- downloadBtn reload called with getName() each time; getName may generate same ID but fine.\n- isValid uses valid Checkbox but setReadOnly true; could still be toggled via script? Not major.\n- setBoxVisible uses iteration each time, could be heavy but ok.\n\nImageButton.java:\n- setImgSize removes \"--lumo-button-size\" but not set for deLogo maybe fine.\n- setEnabled overrides icon but does not change tooltip maybe fine.\n\nHomLang.java:\n- selected may be null before any items, textfield listener will NPE when selected.setValue.\n- visible flag not synchronized, race conditions unlikely.\n- refresh may not update UI when locale changes.\n\nNow pick top 10 issues across files, prioritize high severity: NPEs, race conditions, bug in sort comparator, IndexOutOfBounds, resource leak.\n\nCompose JSON."
      },
      "provider_specific_fields" : { }
    } ],
    "usage" : {
      "completion_tokens" : 2481,
      "prompt_tokens" : 26397,
      "total_tokens" : 28878
    },
    "timings" : {
      "cache_n" : 527,
      "prompt_n" : 25870,
      "prompt_ms" : 19452.359,
      "prompt_per_token_ms" : 0.751927290297642,
      "prompt_per_second" : 1329.91582152067,
      "predicted_n" : 2481,
      "predicted_ms" : 30071.012,
      "predicted_per_token_ms" : 12.120520757758968,
      "predicted_per_second" : 82.50470586091349
    }
  }
}